// DVSL Time Chart library. Version 0.2.3
// (c) 2013 - 2013 Data Visualization Software Lab
//
// http://datavisualizationsoftwarelab.com http://dvsl.co
//
//
// 3rd party software license acknowledgement:
// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

(function(){var Piechart_images_back="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAA1CAYAAADRarJRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAgFJREFUeNrUmc8rBGEYx9/dUbTkoIhCcXSQLUV74szRH6C9uConJy9HZwdylisnjsuNxE2ituS0tChx8eP1fXmnpm1mza/X7vepT00708znfd/Z533fZ4RIP1YEaWhxxSyumMUVs7hiFlfM4opZXDGLK2ZxxSyumMUVs/i/yWdCiMuY99aNeDbHL+AePIAKuAHX4BJcga9m6PE46AYegCUwzCTuxymYB21s4l7uQBFk2cS9HIMhRnGXKigwiru8gglGcRedbvtd8WyIXN9M0Q22an+URL2vmdbSjpEvmRGYIhmBHrDDOgLv+hVyauRZRkD/Vy8cnxMsDSg7AScYGlBx6pxM0oAn8AFaLcpXW/64QMYsnnZ5jjvBABgEo2DS0JtQ3gl7YdQsFCbyYN1sUOJknFKUlkphZxvYZjYijxHl96MOlRT29rB94DCC/Each0hhbwPumLVLGPnFuA+Rwl71QGe43RDyidK4tFj6yJnqQtD9dRruSPoQabFuM1tH/iStyUJaks+Ymo6f/Fqas520VDFbDpAfT3u6lhbkCz7iZVvrDZmyfM5HftXmak+mfD/vzPsZpobTVOt2j/yeIIvbtCamRoT72pyxibd7en2OTT5vxM/JimM/UTTyM4IwtsGRIA397WqMUXwEbLL2+kJNFSJ++aAB8SZ+v0sFxrcAAwAU8YKsEeepXgAAAABJRU5ErkJggg==";var Piechart_Selection;Piechart_Selection=(function(){Piechart_Selection.prototype.scene=null;Piechart_Selection.prototype.events=null;Piechart_Selection.prototype.currentSlice=null;Piechart_Selection.prototype.currentPie=null;Piechart_Selection.prototype.draggedLabelSlice=null;Piechart_Selection.prototype.draggedLabel=null;Piechart_Selection.prototype.hoverEvent=null;function Piechart_Selection(chart){this.chart=chart;this.scene=chart.scene;this.events=chart.events;this.dragPointers={}}Piechart_Selection.prototype.doAnimations=function(event){if(this.hoverEvent){return this.onPointerMove(this.hoverEvent)}};Piechart_Selection.prototype.previewPointerDrag=function(event){return this.hoverEvent=event};Piechart_Selection.prototype.onPointerMove=function(event){var pie,slice;this.hoverEvent=event;slice=this.scene.findSliceAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);if(slice){event.cursor="pointer"}this.switchCurrentSlice(slice,event);pie=this.scene.findPieAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);if(pie&&pie.background&&!slice){event.cursor="pointer";return this.switchCurrentPie(pie,event)}else{return this.switchCurrentPie(null,event)}};Piechart_Selection.prototype.onPointerOut=function(event){return this.switchCurrentSlice(null,event)};Piechart_Selection.prototype.onPointerDown=function(event){var _ref;_ref=this.scene.findLabelAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance),this.draggedLabelSlice=_ref[0],this.draggedLabel=_ref[1];if(this.draggedLabel){return event.consumed=true}};Piechart_Selection.prototype.onPointerUp=function(event){if(this.draggedLabel){this.draggedLabel=null;return event.consumed=true}};Piechart_Selection.prototype.onPointerDrag=function(event){var label;if(this.draggedLabel){label=this.draggedLabel;label.userPlaced=true;label.x+=event.dx;label.y+=event.dy;event.consumed=true;return event.changes.pie=true}};Piechart_Selection.prototype.onClick=function(event){var n,p,userEvent;n=this.scene.findSliceAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);p=this.scene.findPieAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);event.clickSlice=n;event.clickPie=n?n.pie:p;event.consumed=true;userEvent=this.chart.notifyClick(event);if(!userEvent.defaultPrevented){return this.updateSelection(event,n,false)}};Piechart_Selection.prototype.onDoubleClick=function(event){var n;n=this.scene.findSliceAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);event.clickSlice=n;this.chart.notifyDoubleClick(event);return event.consumed=true};Piechart_Selection.prototype.updateSelection=function(event,target,softDeselect){if(!this.scene.settings.interaction.selection.enabled){return}if(!event.shiftKey&&(!target||Base_Helpers.arrayContains(this.scene.selection,target))){return this.setSelection([])}else{if(target&&event.shiftKey||(softDeselect&&Base_Helpers.arrayContains(this.scene.selection,target))){if(!Base_Helpers.arrayContains(this.scene.selection,target)){this.scene.selection.push(target);return this.setSelection(this.scene.selection,this.scene.selectionIds,true)}}else{if(target){return this.setSelection([target])}}}};Piechart_Selection.prototype.switchCurrentSlice=function(obj,event){if(obj===this.currentSlice){return}event.changes.current=true;if(this.scene.activeSlice){this.scene.activeSlice.active=false}if(this.scene.activePie){this.scene.activePie.active=false}this.scene.activeSlice=obj;this.scene.activePie=null;this.currentSlice=obj;this.currentPie=null;if(this.currentSlice){this.scene.activeSlice.active=true;event.hoverSlice=this.currentSlice}this.events.notifySceneChanges({pie:true});return this.chart.notifyHoverChanged(event)};Piechart_Selection.prototype.switchCurrentPie=function(obj,event){if(obj===this.currentPie){return}event.changes.current=true;if(this.scene.activeSlice){this.scene.activeSlice.active=false}if(this.scene.activePie){this.scene.activePie.active=false}this.scene.activePie=obj;this.scene.activeSlice=null;this.currentSlice=null;this.currentPie=obj;if(this.currentPie){this.scene.activePie.active=true;event.hoverPie=this.currentPie}this.events.notifySceneChanges({pie:true});return this.chart.notifyHoverChanged(event)};Piechart_Selection.prototype.onSceneChange=function(event){var s1;if(event.changes.pie){s1=this.updateSelectionIds(this.scene.selection);if(s1!=null){return this.setSelection(s1,this.scene.selectionIds,true,"data")}}};Piechart_Selection.prototype.updateSelectionIds=function(curSelection){var changes,id,pie,selection,slice,slicesToSelect,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2;slicesToSelect=[];_ref=this.scene.selectionIds;for(_i=0,_len=_ref.length;_i<_len;_i++){id=_ref[_i];_ref1=this.scene.pies;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){pie=_ref1[_j];if(pie.background){continue}_ref2=pie.slices;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){slice=_ref2[_k];if(slice.id===id){slicesToSelect.push(slice);break}}}}selection=null;if(slicesToSelect.length>0){selection=curSelection.slice(0);for(_l=0,_len3=slicesToSelect.length;_l<_len3;_l++){slice=slicesToSelect[_l];if(!Base_Helpers.arrayContains(selection,slice)){changes=true;selection.push(slice)}Base_Helpers.removeFromArray(this.scene.selectionIds,slice.id)}}return selection};Piechart_Selection.prototype.setSelection=function(selection,selectionIds,alreadyChanged,origin){var hasChanges,s,s1,_i,_j,_len,_len1,_ref,_ref1;if(selectionIds==null){selectionIds=[]}if(alreadyChanged==null){alreadyChanged=false}if(origin==null){origin="user"}this.scene.selectionIds=selectionIds;hasChanges=alreadyChanged||this.scene.selection.length!==selection.length;if(selection.length===1&&!hasChanges){hasChanges=this.scene.selection[0]!==selection[0]}s1=this.updateSelectionIds(selection);if(s1!=null){selection=s1;hasChanges=true}if(hasChanges){_ref=this.scene.selection;for(_i=0,_len=_ref.length;_i<_len;_i++){s=_ref[_i];s.cutoutDistance=0}this.scene.selection=selection;_ref1=this.scene.selection;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){s=_ref1[_j];s.cutoutDistance=this.scene.settings.interaction.selection.cutoutDistance}this.events.notifySceneChanges({selection:true});return this.chart.notifySelectionChanged(origin)}};return Piechart_Selection})();var Piechart_Scrolling;Piechart_Scrolling=(function(){Piechart_Scrolling.prototype.animationPriority=1002;function Piechart_Scrolling(chart,view){this.chart=chart;this.view=view;this.scene=chart.scene;this.events=chart.events;this.pie=null;this.slice=null;this.fraction=null;this.offset=null}Piechart_Scrolling.prototype.doAnimations=function(event){};Piechart_Scrolling.prototype.onPointerDown=function(event){this.pie=this.scene.view.findPieAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);this.slice=this.scene.view.findSliceAt(event.x,event.y,this.scene.settings.interaction.selection.tolerance);if(this.slice){this.pie=this.slice.pie}return this.mode=null};Piechart_Scrolling.prototype.onPointerDrag=function(event){var dfraction,doffset,newDist,_ref;if(!(this.pie||this.slice)){return}if(this.mode===null){if(this.pie&&this.scene.settings.interaction.scrolling.enabled){this.mode="scroll"}else{if(this.slice&&this.scene.settings.interaction.dragging.enabled){this.mode="drag"}}}_ref=this.scene.view.getMovement(this.pie,event),dfraction=_ref[0],doffset=_ref[1];if(this.mode==="scroll"){this.pie.scrollOffset+=dfraction;this.updatePieAfterScroll(this.pie);event.consumed=true;return event.changes.pie=true}else{if(this.mode==="drag"){this.slice.userPlaced=true;newDist=this.slice.currentCutoutDistance+doffset;if(newDist<0){this.slice.currentCutoutDistance=0;this.slice.userPlaced=false}else{this.slice.currentCutoutDistance=newDist;this.slice.userPlaced=true}event.consumed=true;return event.changes.pie=true}}};Piechart_Scrolling.prototype.onPointerUp=function(event){if(this.mode==="scroll"){event.consumed=true}else{if(this.mode==="drag"){event.consumed=true}}this.pie=null;this.slice=null;return this.mode=null};Piechart_Scrolling.prototype.updatePieAfterScroll=function(pie){if(pie.scrollOffset<0){}else{if(pie.scrollOffset>0){if(pie.offset===0){return pie.scrollOffset=0}}}};return Piechart_Scrolling})();var Piechart_Data,Piechart_PieData,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Piechart_PieData=(function(){function Piechart_PieData(id){this.values=[];this.offset=0;this.total=0;this.valuesSum=0;this.beforeSum=0;this.afterSum=0;this.done=false}Piechart_PieData.prototype.addData=function(values,offset,limit,before,after,sum,chart){var len,v;len=values.length;if(offset<this.offset){if(offset+len<this.offset){chart.error("Data cannot be merged");return}while(offset<this.offset){v=values[this.offset-offset];this.values.unshift(v);this.offset--;this.valuesSum+=v.value;this.beforeSum-=v.value}}if(offset+len>this.offset+this.values.length){if(this.offset+this.values.length<offset){chart.error("Data cannot be merged");return}while(this.offset+this.values.length<offset+len){v=values[this.offset+this.values.length-offset];this.values.push(v);this.valuesSum+=v.value;this.afterSum-=v.value}}if(!limit||values.length<limit){this.done=true}if(offset=0){this.beforeSum=0}else{if(before){this.beforeSum=parseFloat(before)}else{this.beforeSum=Math.max(0,this.beforeSum)}}if(this.done){this.afterSum=0}else{if(after){this.afterSum=parseFloat(after)}else{this.afterSum=Math.max(0,this.afterSum)}}if(sum){this.total=parseFloat(sum);if(!after&&(this.beforeSum||this.offset===0)){this.afterSum=this.total-this.valuesSum-this.beforeSum}if(!before&&(this.afterSum||this.done)){return this.beforeSum=this.total-this.valuesSum-this.afterSum}}else{return this.total=this.beforeSum+this.valuesSum+this.afterSum}};return Piechart_PieData})();Piechart_Data=(function(){Piechart_Data.prototype.requestScheduled=false;Piechart_Data.prototype.cleanupScheduled=false;Piechart_Data.prototype.removed=false;function Piechart_Data(chart){this.chart=chart;this.runRequests=__bind(this.runRequests,this);this.settings=chart.settings;this.pies={};this.pendingPies={};this.requestedPies={};this.requests=[];this.nextId=0;this.dataFunc=this.getDataFunction();if(this.settings.data.preloaded){this.dataArrived(null,this.settings.data.preloaded)}}Piechart_Data.prototype.remove=function(){return this.removed=true};Piechart_Data.prototype.getQueueLength=function(){return Base_Helpers.countProperties(this.pendingPies)+Base_Helpers.countProperties(this.requestedPies)};Piechart_Data.prototype.getRootId=function(){if(Base_Helpers.isArray(this.settings.area.initialPieId)){return this.settings.area.initialPieId[0]}else{return this.settings.area.initialPieId}};Piechart_Data.prototype.canExapnd=function(id){return this.pies.hasOwnProperty(id)||(Base_Helpers.isString(id)&&id[0]!=="°")};Piechart_Data.prototype.getPieData=function(id,offset){var r;if(this.pies.hasOwnProperty(id)){r=this.filterAndSortData(this.pies[id]);if(r.length<=offset){this.requestPieData(id,offset)}return r}else{if(id[0]==="°"){return null}else{this.requestPieData(id,offset);return null}}};Piechart_Data.prototype.requestMorePieData=function(id,offset){if(offset==null){offset=0}if(!(this.pies.hasOwnProperty(id)&&!this.pies[id].done)){return false}this.requestPieData(id,offset);return true};Piechart_Data.prototype.pieRemoved=function(id){delete this.pendingPies[id];return delete this.requestedPies[id]};Piechart_Data.prototype.requestPieData=function(pieId,offset){if(pieId[0]==="°"){throw"Invalid Id: "+pieId}if(this.requestedPies.hasOwnProperty(pieId)||this.pendingPies[pieId]>=offset){return}this.pendingPies[pieId]=offset;if((this.dataFunc!=null)&&!this.requestScheduled){this.requestScheduled=true;return setTimeout(this.runRequests,0)}};Piechart_Data.prototype.runRequests=function(){var id,offset,r,remainingRequests,time,timeout,_i,_len,_ref,_ref1;if(this.removed){return}this.requestScheduled=false;time=new Date().getTime();timeout=this.settings.data.requestTimeout;if(this.cleanupScheduled){this.cleanupScheduled=false;remainingRequests=[];_ref=this.requests;for(_i=0,_len=_ref.length;_i<_len;_i++){r=_ref[_i];if(r.time+timeout>time){remainingRequests.push(r)}else{id=r.id;if(this.requestedPies.hasOwnProperty(id)){offset=this.requestedPies[id];delete this.requestedPies[id];this.pendingPies[id]=offset}if(r.time!==0){this.chart.error("Data request timed out, timeout "+timeout+" ms")}}}this.requests=remainingRequests}while(Base_Helpers.hasProperties(this.pendingPies)&&this.requests.length<this.settings.data.numberOfParralelRequests){_ref1=Base_Helpers.removePropertyValue(this.pendingPies),id=_ref1[0],offset=_ref1[1];this.makeRequest(id,offset,time)}this.chart.scene.loading=this.requests.length>0;this.chart.events.notifySceneChanges({loading:true});if(this.requests.length>0&&!this.cleanupScheduled){this.cleanupScheduled=true;return setTimeout(this.runRequests,timeout)}};Piechart_Data.prototype.makeRequest=function(id,neededOffset,time){var curData,failFunc,limit,offset,okFunc,request,response,_this=this;this.requestedPies[id]=neededOffset;this.chart.log("Requesting data on "+id);curData=this.pies[id];offset=curData?curData.values.length:0;limit=this.settings.data.itemsToLoad+Math.max(0,neededOffset-offset);request={time:time,id:id,offset:offset,limit:limit};okFunc=function(data){return _this.dataArrived(request,data)};failFunc=function(){return _this.dataError(request)};response=this.dataFunc(id,limit,offset,okFunc,failFunc);if((response!=null)&&(Base_Helpers.isObject(response)||Base_Helpers.isString(response))){return this.dataRecievedRaw(r,response)}else{return this.requests.push(request)}};Piechart_Data.prototype.dataError=function(request){var p;if(request){p=new Piechart_PieData(request.id);p.done=true;this.pies[request.id]=p;this.chart.error("Data request failed for pie: "+request.id);Base_Helpers.removeFromArray(this.requests,request);delete this.requestedPies[request.id]}else{this.chart.error("Data request failed")}this.cleanupScheduled=true;return this.runRequests()};Piechart_Data.prototype.dataArrived=function(request,rawData){var allOk,data,id,newIds,required,_i,_len,_ref;if(this.removed){return}allOk=false;if(rawData){data=Base_Helpers.parseData(rawData,this.settings.data.format,this.chart);if(data.error!=null){this.chart.error(data.error);allOk=false}else{allOk=true;_ref=["values"];for(_i=0,_len=_ref.length;_i<_len;_i++){required=_ref[_i];if(!data.hasOwnProperty(required)){allOk=false;this.chart.error("Field "+required+" not set in data")}}if(data.hasOwnProperty("offset")&&parseInt(data.offset)){data.offset=parseInt(data.offset);if(request&&request.offset!==data.offset){allOk=false;this.chart.error("Response Offset "+data.offset+" does not match request offset: "+request.offset)}}else{if(request){data.offset=request.offset}else{data.offset=0}}data.limit=parseInt(data.limit)?parseInt(data.limit):request?request.limit:Infinity}}else{this.chart.error("Got empty response")}if(allOk){id=data.hasOwnProperty("id")?data.id:request?request.id:this.getRootId();if(request){this.chart.log("Data arrived, id="+id+", offset="+request.offset+", len="+data.values.length+" of "+request.limit)}else{this.chart.log("Data arrived, id="+id+", offset="+data.offset+", len="+data.values.length+" of "+data.limit)}newIds={};newIds[id]=true;this.addData(id,data.values,data.offset,data.limit,data.afterSum,data.beforeSum,data.sum,newIds);this.chart.events.notifySceneChanges({dataArrived:true,dataArrivedIds:newIds})}if(request){Base_Helpers.removeFromArray(this.requests,request);delete this.requestedPies[request.id];return this.runRequests()}};Piechart_Data.prototype.addData=function(id,values,offset,limit,afterValue,beforeValue,sum,newIds){var pie,seenIds,v,_i,_len;seenIds={};for(_i=0,_len=values.length;_i<_len;_i++){v=values[_i];v.value=parseFloat(v.value);if(!v.id){v.id="°"+this.nextId;this.nextId++}else{v.id=""+v.id;if(seenIds.hasOwnProperty(v.id)){this.chart.error("Data response: Multiple slices with the same ID: "+n.id)}seenIds[v.id]=true}if(v.subvalues){newIds[v.id]=true;this.addData(v.id,v.subvalues,0,Infinity,0,0,0,newIds)}}if(this.pies.hasOwnProperty(id)){pie=this.pies[id]}else{pie=this.pies[id]=new Piechart_PieData(id)}return pie.addData(values,offset,limit,afterValue,beforeValue,sum,this.chart)};Piechart_Data.prototype.getDataFunction=function(){var config;config=this.settings.data;if(config.dataFunction){return config.dataFunction}else{if(config.url){return function(pieId,limit,offset,success,fail){var params;params=[];if(pieId!=null){params.push(["id",pieId])}params.push(["limit",limit]);params.push(["offset",offset]);return Base_Helpers.doRequest(config.url,params,success,fail)}}else{return null}}};Piechart_Data.prototype.filterAndSortData=function(pieData){var cnt,filter,slice,total,values,_i,_len,_ref;filter=this.chart.settings.filters.sliceFilter;if(filter){total=pieData.total;cnt=pieData.cnt;values=[];_ref=pieData.values;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];if(filter(slice)){values.push(slice)}else{total-=slice.value;cnt-=slice.cnt}}pieData={values:values,done:pieData.done,beforeSum:pieData.beforeSum,afterSum:pieData.afterSum,total:total,cnt:cnt}}if(this.chart.settings.data.sortSlices){pieData.values.sort(function(x,y){return y.value-x.value})}return pieData};return Piechart_Data})();var Base_Export;Base_Export=(function(){function Base_Export(){}Base_Export["export"]=function(api,v){var a4,dh,doc,dpi,dw,h,mime,mime_map,o,out,p,pdf,ph,pw,s,scale,w;if(v.type===void 0){v.type="png"}if(v.transparent===void 0){v.transparent=v.type==="png"}if(v.dimensions===void 0){v.dimensions={}}if(v.type==="png"||v.type==="jpeg"){mime_map={png:"image/png",jpeg:"image/jpeg"};mime=mime_map[v.type];out=api.saveAsImage(v.type,v.dimensions,v.transparent);return this.proxyExport(api,mime,out,"base64",v.dimensions)}else{if(v.type==="pdf"){s=[api._impl.scene.chartWidth,api._impl.scene.chartHeight];p=[10,10,10,10];a4=[];pw=ph=0;dw=dh=0;dpi=72;scale=1;w=h=0;if(s[0]>=s[1]){a4=[297,210];o="l"}else{a4=[210,297];o="p"}pw=a4[0]/25.4*dpi;ph=a4[1]/25.4*dpi;scale=Math.min(ph/s[1],pw/s[0]);if(o==="l"){w=s[0]*scale/pw*a4[0]-p[1]-p[3];dw=(a4[0]-w-p[1]-p[3])/2;h=s[1]/s[0]*w;dh=(a4[1]-p[0]-p[2]-h)/2}else{h=s[1]*scale/ph*a4[1]-p[0]-p[2];dh=(a4[1]-h-p[0]-p[2])/2;w=s[0]/s[1]*h;dw=(a4[0]-p[1]-p[3]-w)/2}out=api.saveAsImage("jpeg",{scaling:scale*3},v.transparent);out=out.slice("data:image/jpeg;base64,".length);out=atob(out);doc=new jsPDF(o,"mm","a4");doc.addImage(out,"JPEG",p[3]+dw,p[0]+dh,w,h);pdf=doc.output("datauristring");return this.proxyExport(api,"application/pdf",pdf,"base64",{})}else{return api._impl.error("Unrecognized export type: "+v.type)}}};Base_Export.proxyExport=function(api,type,data,encoding,dimensions){var b,f,f1,f2,f3,f4;f=Base_Helpers.createDom("form");f.setAttribute("action",api._impl.settings.advanced.exportProxyURL);f.setAttribute("method","POST");f.setAttribute("style","display:none");f1=Base_Helpers.createDom("input",null,null,f);f1.setAttribute("type","hidden");f1.setAttribute("name","type");f1.setAttribute("value",type);f2=Base_Helpers.createDom("input",null,null,f);f2.setAttribute("type","hidden");f2.setAttribute("name","encoding");f2.setAttribute("value",encoding);f3=Base_Helpers.createDom("input",null,null,f);f3.setAttribute("type","hidden");f3.setAttribute("name","data");f3.setAttribute("value",data);if(dimensions.dpi!=null){f4=Base_Helpers.createDom("input",null,null,f);f4.setAttribute("type","hidden");f4.setAttribute("name","setdpi");f4.setAttribute("value",parseInt(dimensions.dpi))}b=document.getElementsByTagName("body")[0];b.appendChild(f);f.submit();return b.removeChild(f)};return Base_Export})();var Base_images_logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAAA0CAYAAAC5HgcyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAACMBJREFUeNrsXGtsFFUUPrOzfdPC8rQkQFwiJKhEUxKIr/CjVRMTX0kJJBqUaIH6gOCPbTD6C0MbTAyS1LQhFDUqodEIGsBsxVp5CoWgxQJNl6UNbcFC6XvZ7e547uyZ9nY6uzuzXUp3nJOczs6dM2fu3O+ec8+5c3sFqRj0UxBZ0ryShuxAvjEsEQI4OsMBmxcuhBRJAmFEdjnybuSnkLtZgYDCQUiHRtgKPpiPJQFe99vIXmT3mKfaRICUVDBC0tolYFayH7+uT1BENFbMwR8p6raW6Wnkz5GXIQ8oYD7g94M4VtUV5C3I/SNFIVQ5FYFcgMgG1R3m4bA2dYXsAIOooumcwVc2L5iCEeGVcwFKHgN4bt4YC81GRiTgonwFm74pKwOKFy2CmykpsmXGsBesiATXpDXwr/gC1moIvYA/cvXs2KNutgLsfA+g46oxy4xZl+QlmxHh2jaA5w8BnOxgDTrqUi9yg4wKtlUgzQZblzwEralpkDrSeMx/voGco9WnhBQbzGqpAPh0HUBPJ1peSpQuiNUe7DMMpNnJFs9N/mAUm0a/+ssNO9Se6oNpmQhS6vAjXkSuQn6UztHOYRYPkCQggJdPAxzZC5CRNcoWST78VAEPaZkWeokAs21gFJgvI+9CDrcu4jF4yw+dVR5oLm+GgZYBEDNExErYh1efRT6LvAb5b+QLyAVyRRD0QPdQWOMtNP3QqGFyNfI15CfAZguPl3XfW+glAswNfwBcvzPsap9BXkfjpkz7vOFj5/FOaNzWCJ7dHvlUsAssIr2LXII8HTkXeZOYKUL3xW7wVtGNF2oBLiHmmTnK4PyPbNU2W6tskd+Vofl/aaGXCDB7MJrdUIeoBGW3+iH+dcppCSYo5ecBDni5ODUQgs66TmiubCZvKpt07bBXThd/723shaadTTDUT5Y5hA8ox4D3KhpvRjaLWs7hjUWQltUC+3YAHK4aFdCYOai5Z9EsjXFTkduxAfujKhYElpU8yIZY5BZWNvPJmeAsckLQF2R56Wpbim3Q1+GrbvykUUIgZ1NwZET3XZRtpbL/fTSr6+W53n+d/N4xvlyLkcpJdiCWLMm3k3ydDtlKku03apl66pKsbBRMZjEbw8UxFbPZnR0Oh0PSWRGW3hTr1I15CWxnRwvMERaMuCV0ZTfxfDYeWYMLMVzhHZSZlpubK7W3t8d8Dsoz95qrU3cvymQr91huNr4AyMgYKxlsPMO64w3gLDAtssC0yALTIgtMC0yLLDDv+2yURRMNpt78D7TWL1hkiOwT9aAV367wDvUNLVDbIgP7zFtnGOJ+C44kcbNSSOqJcKnHcrNWAGSRScC0rDhJwAzpkAla0GkHQGz5BlspUA+RljhPLMnrboWqi0EI+EZfyZgC0uuLRW6c1Uts7S37fOc1u2X+iHwGeROdq/m+RL/Yr2w66mNT/dbildRRT0F4dYKpLXMe/f4M+aMoeSJbLnJyktV/D/v+icfbUWSm05Gtx88yNZiSJCVtb8W6u/DgskZLKzUxn2UamG5TrMFqtUk8ZiYt8R3R6mSWm7UsM4ktuQgPbO1nmZZ1J4hYzl5I6VDNBASBE2KZk3HKjTVy6T1+hpOekZcsbnZIh4zPcnzJ4WbDH5KLMWFXz5KyLQZ2yYuYB63mTQ4whQTJ3Osx0sG5O08CVefTsYvGxkQQq6eDfkcaa9Xv4zF9NMtARGb/C8qm+dzEzRwIihz7x19JXc5RM11XGrlIpfMsyRSOs2M0ky5FL3umSwViqcb7uPEdnKaNZska3dSD2X+LVXM938UBA3S9gsCo0bAUJ8l0cQ3KaBWVKZGrZxzW6CZdJZyV56l0KnWspvooncBFgC7DqLbLjKlJETVGCZ+CMLDwpfN5K8TrlVhWSveUUKPyeoBrPMUNlnAdhL8eDymdo0DlrmtUlqsAuUol00U6WF3LzOhm8wmoMp3yZSrwFLem5Ir13PiopDeOBNTTQXWtiTHu5kfpNLyVglnBNJKsV2uAqQDGN6ACbB6NV6XkZscT8ICOukaT66Jy04JplDwEmpMLZIqoodTWUEBlDhqvmidgEuKeTxqYYz5orHUWEqh5nPtVW8J6CH/wXk/nk+abqm2iAArdDQkR5COUxl21+iipRqSxThm3Crl7q6M8Q7HaZapxzWg9QUdaUxNDLl/RFW+LiToSm1F7IPpv+W8L4ljcsKxXJR/WmpamW7dWI9GkOp+y5EH0+dJKLsKs1pludBkMePJU9ypjcL4O0Is0rrn4jhcvmOGN7YJwfowGcXi3SrYVDHR0dFTaRNuFwbbBg2L6aAzYrlz+2/6f6VQBNYxiIPCXvBMXb8D21D46maUHFATQxdIRAnZ/jKiRzye1Ikcn5YQuLl2o0LBiPurlU6GzxDwoJXTcz+nNpw5VyllmNZW7Ob0uklHG/LjBbMIGOre3AbYEBTghN3+aDHHLMS+sm54uVA4DDvCrFJKWth1o6/a1+z62Z9p72PZr9ix7IDgQ/KbtYNsPqIstr6xVZl3w/E/4bf9mdLWnISsHIDMb9ad74fzRN4WsnD3RLBNTknouHyulBqjg8zSy0khpiidC5OiEkS8ibgKgkO6JFPUqszXRXKi6rm4NK1xPz8mn57pJnt1fwCYM4gpL5C1KBOE1/Pk18qHls2H7/ByYAhKIfQHoOtwCr2L5B8hfoGwxyrI99dgyx8Vome/mPJJzBWWz0b36+jx96f5OP9svaAZ7eZS/hPJr8fde5J9g4dIymDE3G0IhEXx9XdBwgjXeZgjv1fe+ul4as0GKVdQrL6who3aFjhgu1smlJPVRXK0yyVDPWbwzindQ5KPN946Zmx3XCgvu5m00h8j4BFlWD50z15nNybJFyE10zUs9q4HO2deVV1S6t3O6j5PuXjo/ABpLJs28v0/CNnWKAiajl5h1IrNtEQfIAt9RghiV7BxyDZch/O97bLevr5Afj/AoBvARCG8OxXSzNbsbI4VdFpgS/CfAAOjmUutlIPngAAAAAElFTkSuQmCC";var Piechart_View;Piechart_View=(function(){Piechart_View.prototype.animationPriority=1007;function Piechart_View(chart){this.chart=chart}Piechart_View.prototype.updatePie=function(pie){return true};Piechart_View.prototype.scrollForward=function(pie,offset){return true};Piechart_View.prototype.scrollBackward=function(pie,offset){return false};Piechart_View.prototype.onSceneChange=function(event){};Piechart_View.prototype.doAnimations=function(event){};Piechart_View.prototype.paintScene=function(event){};Piechart_View.prototype.getMovement=function(pie,event){return[0,0]};Piechart_View.prototype.findSliceAt=function(x,y,tolerance){};Piechart_View.prototype.findPieAt=function(x,y,tolerance){};Piechart_View.prototype.findLabelAt=function(x,y,tolerance){};return Piechart_View})();var Piechart_Animations;Piechart_Animations=(function(){function Piechart_Animations(chart){this.chart=chart;this.scene=chart.scene;this.events=chart.events;this.prevTime=0}Piechart_Animations.prototype.doAnimations=function(event){var a0Animator,a1Animator,c,c0,c1,c2,c3,cc,changedPies,cutoutAnimator,dt,fadeDuration,fillAnimator,interactionDuration,lineAnimator,pie,pieChanges,piesToRemove,r0Animator,r1Animator,removePie,slice,slicesToRemove,time,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;if(this.prevTime){dt=Math.min(30,event.time-this.prevTime)}else{dt=0}fadeDuration=this.scene.settings.advanced.animationTime;interactionDuration=this.scene.settings.advanced.interactionTime;time=event.time;piesToRemove=[];changedPies=[];_ref=this.scene.pies;for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];pieChanges=false;if(event.changes.pie||event.changes.bounds){pieChanges=true}removePie=false;if(pie.removed===true){pie.removed=time+fadeDuration}if(pie.removed){event.animating=true;removePie=pie.removed<time}if(!removePie){if(!pie.animatorA0){pie.animatorA0=new Base_Animator(pie.currentStartAngle,pie.startAngle,fadeDuration,"<>",time);pie.animatorA1=new Base_Animator(pie.currentEndAngle,pie.endAngle,fadeDuration,"<>",time);pie.animatorR0=new Base_Animator(pie.currentInnerRadius,pie.innerRadius,fadeDuration,"<>",time);pie.animatorR1=new Base_Animator(pie.currentRadius,pie.radius,fadeDuration,"<>",time);if(!this.scene.settings.area.initialAnimation){pie.animatorA0.jump(pie.startAngle);pie.animatorA1.jump(pie.endAngle);pie.animatorR0.jump(pie.innerRadius);pie.animatorR1.jump(pie.radius)}}a0Animator=pie.animatorA0;a1Animator=pie.animatorA1;r0Animator=pie.animatorR0;r1Animator=pie.animatorR1;_ref1=a0Animator.updateAndGet(pie.startAngle,time),pie.currentStartAngle=_ref1[0],c0=_ref1[1];_ref2=a1Animator.updateAndGet(pie.endAngle,time),pie.currentEndAngle=_ref2[0],c1=_ref2[1];_ref3=r1Animator.updateAndGet(pie.radius,time),pie.currentRadius=_ref3[0],c2=_ref3[1];_ref4=r0Animator.updateAndGet(pie.innerRadius,time),pie.currentInnerRadius=_ref4[0],c3=_ref4[1];pie.currentRadius=Math.max(0.1,pie.currentRadius);pie.currentInnerRadius=Math.min(Math.max(0.1,pie.currentInnerRadius),pie.currentRadius);pieChanges||(pieChanges=c0||c1||c2||c3);slicesToRemove=[];cc=false;_ref5=pie.allSlices;for(_j=0,_len1=_ref5.length;_j<_len1;_j++){slice=_ref5[_j];if(!slice.animatorF){slice.animatorF=new Base_Animator(slice.currentFraction,slice.fraction,fadeDuration,"<>",time)}_ref6=slice.animatorF.updateAndGetFixed(slice.fraction,time),slice.currentFraction=_ref6[0],c=_ref6[1];cc||(cc=c);if(slice.removed&&slice.currentFraction===0){slicesToRemove.push(slice)}}pieChanges||(pieChanges=cc);if(slicesToRemove.length>0){pieChanges=true;for(_k=0,_len2=slicesToRemove.length;_k<_len2;_k++){slice=slicesToRemove[_k];Base_Helpers.removeFromArray(pie.slices,slice);Base_Helpers.removeFromArray(pie.allSlices,slice);if(slice===pie.othersSlice){pie.othersSlice=null}if(slice===pie.previousSlice){pie.previousSlice=null}}}_ref7=pie.allSlices;for(_l=0,_len3=_ref7.length;_l<_len3;_l++){slice=_ref7[_l];if(!slice.animatorLineColor){slice.animatorLineColor=new Base_Animator(slice.currentLineColor,slice.targetLineColor,interactionDuration,"<>",time);slice.animatorFillColor=new Base_Animator(slice.currentFillColor,slice.targetFillColor,interactionDuration,"<>",time);slice.animatorCutout=new Base_Animator(slice.currentCutoutDistance,slice.cutoutDistance,interactionDuration,"<>",time)}lineAnimator=slice.animatorLineColor;fillAnimator=slice.animatorFillColor;cutoutAnimator=slice.animatorCutout;_ref8=lineAnimator.updateColorAndGet(slice.targetLineColor,time),slice.currentLineColor=_ref8[0],c0=_ref8[1];_ref9=fillAnimator.updateColorAndGet(slice.targetFillColor,time),slice.currentFillColor=_ref9[0],c1=_ref9[1];if(!slice.userPlaced){_ref10=cutoutAnimator.updateAndGet(slice.cutoutDistance,time),slice.currentCutoutDistance=_ref10[0],c2=_ref10[1]}pieChanges||(pieChanges=c0||c1||c2)}if(pieChanges){changedPies.push(pie)}event.animating||(event.animating=pieChanges)}else{piesToRemove.push(pie)}}for(_m=0,_len4=piesToRemove.length;_m<_len4;_m++){pie=piesToRemove[_m];this.scene.deletePie(pie)}this.prevTime=time;return changedPies};return Piechart_Animations})();var Base_CssColorParser;Base_CssColorParser=(function(){function Base_CssColorParser(){}Base_CssColorParser.clamp_css_byte=function(i){i=Math.round(i);if(i<0){return 0}else{if(i>255){return 255}else{return i}}};Base_CssColorParser.clamp_css_float=function(f){if(f<0){return 0}else{if(f>1){return 1}else{return f}}};Base_CssColorParser.parse_css_int=function(str){if(str[str.length-1]==="%"){return Base_CssColorParser.clamp_css_byte(parseFloat(str)/100*255)}return Base_CssColorParser.clamp_css_byte(parseInt(str))};Base_CssColorParser.parse_css_float=function(str){if(str[str.length-1]==="%"){return Base_CssColorParser.clamp_css_float(parseFloat(str)/100)}return Base_CssColorParser.clamp_css_float(parseFloat(str))};Base_CssColorParser.css_hue_to_rgb=function(m1,m2,h){if(h<0){h+=1}else{if(h>1){h-=1}}if(h*6<1){return m1+(m2-m1)*h*6}if(h*2<1){return m2}if(h*3<2){return m1+(m2-m1)*(2/3-h)*6}return m1};Base_CssColorParser.parseCSSColor=function(css_str){var alpha,ep,fname,h,iv,l,m1,m2,op,params,s,str;str=css_str.replace(RegExp(" ","g"),"").toLowerCase();if(str in Base_CssColorParser.kCSSColorTable){return Base_CssColorParser.kCSSColorTable[str].slice()}if(str[0]==="#"){if(str.length===4){iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<=4095)){return null}return[((iv&3840)>>4)|((iv&3840)>>8),(iv&240)|((iv&240)>>4),(iv&15)|((iv&15)<<4),1]}else{if(str.length===7){iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<16777215)){return null}return[(iv&16711680)>>16,(iv&65280)>>8,iv&255,1]}}return null}op=str.indexOf("(");ep=str.indexOf(")");if(op!==-1&&ep+1===str.length){fname=str.substr(0,op);params=str.substr(op+1,ep-(op+1)).split(",");alpha=1;if(fname==="rgba"){if(params.length!==4){return null}alpha=Base_CssColorParser.parse_css_float(params.pop())}if(fname==="rgba"||fname==="rgb"){if(params.length!==3){return null}return[Base_CssColorParser.parse_css_int(params[0]),Base_CssColorParser.parse_css_int(params[1]),Base_CssColorParser.parse_css_int(params[2]),alpha]}if(fname==="hsla"){if(params.length!==4){return null}alpha=Base_CssColorParser.parse_css_float(params.pop())}if(fname==="hsla"||fname==="hsl"){if(params.length!==3){return null}h=(((parseFloat(params[0])%360)+360)%360)/360;s=parse_css_float(params[1]);l=parse_css_float(params[2]);m2=(l<=0.5?l*(s+1):l+s-l*s);m1=l*2-m2;return[Base_CssColorParser.clamp_css_byte(Base_CssColorParser.css_hue_to_rgb(m1,m2,h+1/3)*255),Base_CssColorParser.clamp_css_byte(Base_CssColorParser.css_hue_to_rgb(m1,m2,h)*255),Base_CssColorParser.clamp_css_byte(Base_CssColorParser.css_hue_to_rgb(m1,m2,h-1/3)*255),alpha]}}return null};Base_CssColorParser.kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return Base_CssColorParser})();var Base_Geometry;Base_Geometry=(function(){function Base_Geometry(){}Base_Geometry.closestPointToLine=function(x0,y0,x1,y1,x,y){var dx,dy,lengthSqr,t;dx=x1-x0;dy=y1-y0;lengthSqr=dx*dx+dy*dy;if(lengthSqr>0){t=(((x-x0)*dx)+(y-y0)*dy)/lengthSqr;t=Math.min(Math.max(t,0),1)}else{t=0}return[x0+dx*t,y0+dy*t]};Base_Geometry.rayIntersectsLine=function(rx,ry,rdx,rdy,lx,ly,lx1,ly1){var coef,div,ldx,ldy,tl,tr;coef=Infinity;ldx=lx1-lx;ldy=ly1-ly;div=rdx*ldy-rdy*ldx;if(div!==0){tr=(ry*ldx-rx*ldy+lx*ldy-ly*ldx)/div;if(Math.abs(ldx)>Math.abs(ldy)){tl=(rx+rdx*tr-lx)/ldx}else{tl=(ry+rdy*tr-ly)/ldy}if(tl>=0&&tl<=1&&tr>=0){coef=tr}}return coef};Base_Geometry.rayIntersectsCircle=function(rx,ry,rdx,rdy,r){var a,b,c,coef,d,t0,t1;a=rdx*rdx+rdy*rdy;b=rx*rdx+ry*rdy;c=rx*rx+ry*ry-r*r;d=b*b-a*c;coef=Infinity;if(d>0){d=Math.sqrt(d);t0=(-b-d)/a;t1=(-b+d)/a;if(t0>=0){coef=t0}if(t1>=0){coef=Math.min(coef,t1)}}return coef};Base_Geometry.lineTouchingCircle=function(rx,ry,xt,yt,r){var a,angle,b,dx,dy,h,xx;a=Math.sqrt(rx*rx+ry*ry);if(!(a>r)){return null}b=Math.sqrt(a*a-r*r);h=r*b/a;xx=r*r/a;dx=rx/a;dy=ry/a;angle=rx*yt-ry*xt;if(angle<0){h=-h}return[dx*xx-dy*h,dy*xx+dx*h]};return Base_Geometry})();var Base_Animator;Base_Animator=(function(){Base_Animator.prototype.formula=null;Base_Animator.prototype.startTime=null;Base_Animator.prototype.from=0;Base_Animator.prototype.to=0;Base_Animator.prototype.fromColor=null;Base_Animator.prototype.toColor=null;Base_Animator.prototype.t=0;Base_Animator.prototype.startSpeed=0;Base_Animator.prototype.easing_formulas={"=":function(t){return t},"<>":function(t){if(t<0.5){return 2*t*t}else{return -0.5*((t*2-1)*(t*2-3)-1)}},scroll:function(t){return 1-(1-t)*(1-t)}};function Base_Animator(from,to,duration,easing,startTime){this.from=from;this.to=to;this.duration=duration;if(easing==null){easing="<>"}if(this.from===void 0||this.from===null){this.from=this.to}this.startTime=startTime===void 0?new Date().getTime():startTime;this.x=this.from;this.t=this.startTime;if(!this.easing_formulas[easing]){throw"Easing formula not defined: "+easing}else{this.formula=this.easing_formulas[easing]}}Base_Animator.prototype.jump=function(to){this.to=to;this.from=to;this.x=to;return this.t=this.startTime=0};Base_Animator.prototype.retarget=function(newTo,startTime){startTime=startTime===void 0?new Date().getTime():startTime;if(this.finished(this.t)){this.startSpeed=0}else{this.startSpeed=this._getSpeed()}this.from=this.get(startTime);this.to=newTo;this.startTime=startTime;return this};Base_Animator.prototype.retargetColor=function(newTo,startTime){if(startTime===void 0){startTime=this.t?this.t:new Date().getTime()}this.startSpeed=0;this.from=this.x;this.to=newTo;this.fromColor=null;this.toColor=null;this.startTime=startTime;return this};Base_Animator.prototype.updateAndGet=function(targetValue,time){var changes;changes=this.x!==targetValue;if(targetValue!==this.to){this.retarget(targetValue,time)}return[this.get(time),changes]};Base_Animator.prototype.updateAndGetFixed=function(targetValue,time){var changes;changes=this.x!==targetValue;if(targetValue!==this.to){this.startSpeed=0;this.startTime=time;this.from=this.x;this.to=targetValue;this.fromColor=null;this.toColor=null}return[this.get(time),changes]};Base_Animator.prototype.updateColorAndGet=function(targetValue,time){var changes;changes=this.x!==targetValue;if(targetValue!==this.to){this.retargetColor(targetValue,time)}return[this.getColor(time),changes]};Base_Animator.prototype.get=function(time){var easingPerc,percentage,spx,xx;if(this.duration<=0){this.t=time;this.x=this.to;return this.to}percentage=Math.min(1,Math.max(time-this.startTime,0)/this.duration);if(percentage>=1){this.t=time;this.x=this.to;return this.to}easingPerc=this.formula(percentage);xx=easingPerc*(this.to-this.from);if(this.startSpeed&&percentage<1){spx=this.startSpeed*percentage*this.duration;xx=xx*easingPerc+spx*(1-easingPerc)}xx=this.from+xx;this.t=time;this.x=xx;return xx};Base_Animator.prototype.getColor=function(time){var fa,fb,fg,fr,p0,p1,percentage,ta,tb,tg,tr,xx,_ref,_ref1;this.t=time;if(this.duration<=0||this.from===this.to){return this.to}if(this.fromColor==null){this.fromColor=Base_CssColorParser.parseCSSColor(this.from)}if(this.toColor==null){this.toColor=Base_CssColorParser.parseCSSColor(this.to)}percentage=Math.min(1,Math.max(time-this.startTime,0)/this.duration);p1=this.formula(percentage);p0=1-p1;_ref=this.fromColor,fr=_ref[0],fg=_ref[1],fb=_ref[2],fa=_ref[3];_ref1=this.toColor,tr=_ref1[0],tg=_ref1[1],tb=_ref1[2],ta=_ref1[3];xx="rgba("+(Math.round(fr*p0+tr*p1))+","+(Math.round(fg*p0+tg*p1))+","+(Math.round(fb*p0+tb*p1))+","+((fa*p0+ta*p1).toFixed(3))+")";this.t=time;this.x=xx;return xx};Base_Animator.prototype.finished=function(time){return time>=this.startTime+this.duration};Base_Animator.prototype._getSpeed=function(){var d,p0,p1,time;time=this.t;d=this.duration/1000;p0=this.get(time-d/2);p1=this.get(time+d/2);this.t=time;return(p1-p0)/d};return Base_Animator})();var Piechart_LabelLayoutBase;Piechart_LabelLayoutBase=(function(){function Piechart_LabelLayoutBase(g,config){var height,lineSpacing;this.g=g;this.config=config;Base_Graphics.textStyle(g,config.textStyle);this.angle=config.angle/180*Math.PI;this.connectorLength=config.connectorLength;this.margin=config.margin;height=g.measureText("M").width*1.2;this.interLabelSpacing=Math.max(this.config.interLabelSpacing*height,this.margin);lineSpacing=config.lineSpacing;this.lineHeightM=height*(lineSpacing+1);this.lineHeightC=-height*lineSpacing}Piechart_LabelLayoutBase.prototype.fitLabelInRect=function(label,align,locationFromHeight){var actualWidth,availableWidth,bestActualWidth,bestDx,bestDy,bestLines,bestProp,bestWidth,bestX,bestY,centerOffset,dx,dy,g,height,line,line1,lineCount,lineHeightC,lineHeightM,lineTargetWidth,lineW,lineWidth,lines,margin,pos,prop,totalChars,totalWidth,word,words,x,y,_i,_j,_len,_ref,_ref1;g=this.g;margin=this.margin;lineHeightC=this.lineHeightC;lineHeightM=this.lineHeightM;totalWidth=g.measureText(label.text).width;words=label.words;totalChars=0;for(_i=0,_len=words.length;_i<_len;_i++){word=words[_i];totalChars+=word.length+1}bestProp=0;bestLines=null;bestX=0;bestY=0;bestWidth=0;bestActualWidth=0;for(lineCount=_j=1,_ref=words.length;_j<=_ref;lineCount=_j+=1){height=lineHeightC+lineHeightM*lineCount;_ref1=locationFromHeight(height/2+margin),x=_ref1[0],y=_ref1[1],dx=_ref1[2],dy=_ref1[3],availableWidth=_ref1[4];availableWidth-=margin*2;lineTargetWidth=totalWidth/lineCount;prop=100;line=words[0];actualWidth=0;lineWidth=g.measureText(line).width;lines=[];pos=1;while(pos<words.length){line1=line+" "+words[pos];lineW=g.measureText(line1).width;if(lineW<=lineTargetWidth||lineW<=availableWidth||lines.length===lineCount-1){line=line1;lineWidth=lineW}else{lines.push(line);actualWidth=Math.max(actualWidth,lineWidth);prop=Math.min(prop,availableWidth/lineWidth);line=words[pos];lineWidth=g.measureText(line).width}pos++}lines.push(line);actualWidth=Math.max(actualWidth,lineWidth);prop=Math.min(prop,availableWidth/lineWidth);if(prop>bestProp){bestLines=lines;bestProp=prop;bestDx=dx;bestDy=dy;bestX=x;bestY=y;bestWidth=availableWidth;bestActualWidth=actualWidth}if(prop>=1){break}}if(bestLines){if(!label.userPlaced){if(align==="left"){centerOffset=(bestActualWidth-bestWidth)/2}else{if(align==="right"){centerOffset=(bestWidth-bestActualWidth)/2}else{centerOffset=0}}bestX=bestX+bestDx*centerOffset;bestY=bestY+bestDy*centerOffset}label.x=bestX;label.y=bestY;label.lines=bestLines;label.hheight=(lineHeightC+lineHeightM*bestLines.length)/2;label.lineHeight=lineHeightM;label.hwidth=bestActualWidth/2;label.visible=true}else{label.lines=[];label.visible=false}return bestProp};return Piechart_LabelLayoutBase})();var PieChart_Renderer_Base;PieChart_Renderer_Base=(function(){function PieChart_Renderer_Base(renderer){this.renderer=renderer;this.settings=this.renderer.settings}PieChart_Renderer_Base.prototype.paintPie=function(context,x,y,r0,r1,a0,a1,pie){if(pie.fillColor){context.beginPath();context.arc(x,y,r1,a0,a1,false);context.arc(x,y,r0,a1,a0,true);context.closePath();return Base_Graphics.fill(context,pie)}};PieChart_Renderer_Base.prototype.paintSlices=function(context,x,y,radius,innerRadius,slices){throw"paintSlices not implemented"};PieChart_Renderer_Base.prototype.strokeSlice=function(context,x,y,slice){var ia0,ia1,oa0,oa1,offset,params,perimeter,r0,r1,width;params=slice.renderParams;context.beginPath();x=x+slice.x;y=y+slice.y;r0=params[0];r1=params[1];oa0=params[2];oa1=params[3];ia0=params[4];ia1=params[5];perimeter=r1*Math.abs(oa1-oa0);width=r1-r0;offset=Math.min(0.1*Math.min(perimeter,width),3);if(slice.lineDecoration==="zigzag"){this.strokeZigZag(context,x,y,r1,offset,oa0,oa1)}else{context.arc(x,y,r1,oa0,oa1,false)}if(ia0===ia1){context.lineTo(x+Math.cos(ia0)*r0,y+Math.sin(ia0)*r0)}else{context.arc(x,y,r0,ia1,ia0,true)}return context.closePath()};PieChart_Renderer_Base.prototype.strokeZigZag=function(context,x,y,r,offset,a0,a1){var a,da;da=5/r;a=a0;context.moveTo(x+r*Math.cos(a0),y+r*Math.sin(a0));while(a+da<a1){a+=da;context.lineTo(x+(r+offset)*Math.cos(a),y+(r+offset)*Math.sin(a));offset=-offset}return context.lineTo(x+r*Math.cos(a1),y+r*Math.sin(a1))};PieChart_Renderer_Base.prototype.strokeAndPaint=function(g,x,y,slice){this.strokeSlice(g,x,y,slice);return Base_Graphics.paint(g,slice)};return PieChart_Renderer_Base})();var Base_Api;Base_Api=(function(){function Base_Api(){}Base_Api.themes={};Base_Api.prototype.customize=function(name){if(!this.themes.hasOwnProperty(name)){throw"No customization named "+name}return this.updateSettings(this.themes[name])};Base_Api.prototype.saveState=function(){return this._impl.save()};Base_Api.prototype.restoreState=function(state,animate){if(animate==null){animate=false}return this._impl.restore(state,animate)};Base_Api.prototype.updateSettings=function(changes){this._impl.updateSettings(changes,"api");return this};Base_Api.prototype.on=function(name,listener){return this._impl.on(name,listener)};Base_Api.prototype.off=function(name,listener){return this._impl.off(name,listener)};Base_Api.prototype.updateSize=function(){this._impl.updateSize();return this};Base_Api.prototype.reloadData=function(){return this._impl.reloadData()};Base_Api.prototype.remove=function(){return this._impl.remove()};Base_Api.prototype.saveAsImage=function(type,dimensions,transparent){return this._impl.events.exportToImage(type,dimensions,transparent)};Base_Api.prototype["export"]=function(type,dimensions,transparent){return Base_Export["export"](this,{type:type,dimensions:dimensions,transparent:transparent})};Base_Api.prototype.exportGetDimensions=function(dimensions){return this._impl.events.exportGetDimensions(dimensions)};return Base_Api})();var Base_Graphics;Base_Graphics=(function(){function Base_Graphics(){}Base_Graphics.stroke=function(g,st){if(st.lineWidth){g.lineWidth=st.lineWidth}g.strokeStyle=st.lineColor;g.stroke();if(st.lineWidth){return g.lineWidth=1}};Base_Graphics.fill=function(g,st){if(!st.fillColor){return}g.fillStyle=st.fillColor;if(st.shadowColor){g.shadowOffsetX=st.shadowOffsetX;g.shadowOffsetY=st.shadowOffsetY;g.shadowBlur=st.shadowBlur;g.shadowColor=st.shadowColor}g.fill();if(st.shadowColor){g.shadowBlur=0;return g.shadowColor=null}};Base_Graphics.paint=function(g,st){if(st.shadowColor){g.shadowOffsetX=st.shadowOffsetX;g.shadowOffsetY=st.shadowOffsetY;g.shadowBlur=st.shadowBlur;g.shadowColor=st.shadowColor}if(st.lineColor){g.lineWidth=st.lineWidth?st.lineWidth:1;g.strokeStyle=st.lineColor;g.stroke()}if(st.fillColor){g.fillStyle=st.fillColor;g.fill()}if(st.shadowColor){g.shadowOffsetX=0;g.shadowOffsetY=0;g.shadowBlur=0;return g.shadowColor=null}};Base_Graphics.textStyle=function(g,st){if(st.fillColor){g.fillStyle=st.fillColor}if(st.font){g.font=st.font}if(st.shadowColor){g.shadowOffsetX=st.shadowOffsetX;g.shadowOffsetY=st.shadowOffsetY;g.shadowBlur=st.shadowBlur;return g.shadowColor=st.shadowColor}};Base_Graphics.rectStyle=function(g,st){if(st.hasOwnProperty("lineColor")){g.strokeStyle=st.lineColor}if(st.hasOwnProperty("fillColor")){return g.fillStyle=st.fillColor}};Base_Graphics.pushClip=function(g,x,y,w,h){g.save();g.beginPath();g.rect(x,y,w,h);return g.clip()};Base_Graphics.popClip=function(g){return g.restore()};Base_Graphics.arcBetweenTwoPoints=function(g,x,y,r,x0,y0,x1,y1){var a1,a2,counterclockwise,d,d1,d2,len,lenSq,mx,my,px,py,xa,xb,ya,yb;mx=(x0+x1)/2;my=(y0+y1)/2;px=y1-y0;py=x0-x1;lenSq=px*px+py*py;if(lenSq===0){return}len=Math.sqrt(lenSq);r=Math.min(Math.max(r,len/2),len*3);d=Math.sqrt(r*r/lenSq-0.25);xa=mx+px*d;ya=my+py*d;xb=mx-px*d;yb=my-py*d;d1=(xa-x)*(xa-x)+(ya-y)*(ya-y);d2=(xb-x)*(xb-x)+(yb-y)*(yb-y);if(d1>d2){x=xb;y=yb}else{x=xa;y=ya}a1=Math.atan2(y0-y,x0-x);a2=Math.atan2(y1-y,x1-x);if(a2<a1){a2+=Math.PI*2}counterclockwise=Math.abs(a1-a2)>Math.PI;return g.arc(x,y,r,a1,a2,counterclockwise)};Base_Graphics.strokeMarker=function(g,shape,x,y,r){var d2;d2=r*1.41421356237;if(shape==="rect"){g.moveTo(x-r,y-r);g.lineTo(x+r,y-r);g.lineTo(x+r,y+r);g.lineTo(x-r,y+r);return g.closePath()}else{if(shape==="romb"){g.moveTo(x-d2,y);g.lineTo(x,y-d2);g.lineTo(x+d2,y);g.lineTo(x,y+d2);g.closePath();return g.fill()}else{if(shape==="triangle"){g.beginPath();g.moveTo(x-d2,y+d2);g.lineTo(x+d2,y+d2);g.lineTo(x,y-d2);g.closePath();return g.fill()}else{if(shape==="triangle2"){g.beginPath();g.moveTo(x-d2,y-d2);g.lineTo(x+d2,y-d2);g.lineTo(x,y+d2);g.closePath();return g.fill()}else{if(shape==="circle"){g.beginPath();g.arc(x,y,r,0,Math.PI*2,true);return g.closePath()}else{throw"unknown marker shape "+shape}}}}}};Base_Graphics.strokeBalloon=function(g,x0,y0,w,h){var m,r,s,x,y;w=Math.max(w,h*2);m=5;s=4;r=(h+s*2)/2;x=x0;y=y0;g.moveTo(x,y);x+=m;y+=m;g.lineTo(x,y);x+=w/2-s-m;g.lineTo(x,y);g.arc(x,y+r,r,-Math.PI/2,Math.PI/2);y+=r*2;x-=w-2*s;g.lineTo(x,y);g.arc(x,y-r,r,Math.PI*0.5,Math.PI*1.5);y-=r*2;x+=w/2-s-m;g.lineTo(x,y);x+=m;y-=m;g.closePath();return y0+m+r};Base_Graphics.strokeBalloon2=function(g,x0,y0,w,h){var r,s,x,y;s=4;r=(h+s*2)/2;w=Math.max(w,h*2)/2-s;x=x0+w;y=y0-r;g.moveTo(x,y);g.arc(x,y+r,r,-Math.PI/2,Math.PI/2,false);y+=r*2;x-=w*2;g.lineTo(x,y);g.arc(x,y-r,r,Math.PI*0.5,Math.PI*1.5,false);return g.closePath()};Base_Graphics.applyColorToImage=function(image,color,ignoreTransparent){var a,b,c,cData,data,g,gr,h,i,r,result,w,_i,_j,_ref,_ref1,_ref2;if(ignoreTransparent==null){ignoreTransparent=true}_ref=Base_Graphics.parseColor(color),r=_ref[0],g=_ref[1],b=_ref[2],a=_ref[3];c=document.createElement("canvas");w=c.width=image.width;h=c.height=image.height;gr=c.getContext("2d");gr.drawImage(image,0,0);cData=gr.getImageData(0,0,w,h);data=cData.data;if(ignoreTransparent){for(i=_i=0,_ref1=data.length;_i<=_ref1;i=_i+=4){if(data[i+3]!==255){continue}data[i]=(data[i]*r)>>8;data[i+1]=(data[i+1]*g)>>8;data[i+2]=(data[i+2]*b)>>8}}else{for(i=_j=0,_ref2=data.length;_j<=_ref2;i=_j+=4){data[i]=(data[i]*r)>>8;data[i+1]=(data[i+1]*g)>>8;data[i+2]=(data[i+2]*b)>>8}}gr.putImageData(cData,0,0);result=new Image();result.src=c.toDataURL("image/png");return result};Base_Graphics.parseColor=function(color){return Base_CssColorParser.parseCSSColor(color)};Base_Graphics.normalizeColor=function(color){var a,b,g,r,_ref;_ref=Base_CssColorParser.parseCSSColor(color),r=_ref[0],g=_ref[1],b=_ref[2],a=_ref[3];return"rgba("+r+","+g+","+b+","+(a.toFixed(3))+")"};Base_Graphics.deriveColor=function(color,lighten,opacity){var a,b,g,r,_ref;_ref=Base_Graphics.parseColor(color),r=_ref[0],g=_ref[1],b=_ref[2],a=_ref[3];return this.deriveColorRGBA(r,g,b,a,lighten,opacity)};Base_Graphics.deriveColorRGBA=function(r,g,b,a,lighten,opacity){var light;light=(lighten-1)*255;r=Math.round(Math.min(255,Math.max(0,r+light)));g=Math.round(Math.min(255,Math.max(0,g+light)));b=Math.round(Math.min(255,Math.max(0,b+light)));a=Math.min(1,a*opacity);return"rgba("+r+","+g+","+b+","+(a.toFixed(3))+")"};Base_Graphics.blendColors=function(c0,c1,proportion){var a,a0,a1,b,b0,b1,g,g0,g1,r,r0,r1,_ref,_ref1;_ref=Base_Graphics.parseColor(c0),r0=_ref[0],g0=_ref[1],b0=_ref[2],a0=_ref[3];_ref1=Base_Graphics.parseColor(c1),r1=_ref1[0],g1=_ref1[1],b1=_ref1[2],a1=_ref1[3];r=Math.round(r1*proportion+r0*(1-proportion));g=Math.round(g1*proportion+g0*(1-proportion));b=Math.round(b1*proportion+b0*(1-proportion));a=a1*proportion+a0*(1-proportion);return"rgba("+r+","+g+","+b+","+(a.toFixed(3))+")"};Base_Graphics.copyHue=function(hue,brightness){var a,a0,a1,b,b0,b1,br0,br1,g,g0,g1,r,r0,r1,_ref,_ref1;_ref=Base_Graphics.parseColor(hue),r0=_ref[0],g0=_ref[1],b0=_ref[2],a0=_ref[3];_ref1=Base_Graphics.parseColor(brightness),r1=_ref1[0],g1=_ref1[1],b1=_ref1[2],a1=_ref1[3];br0=(r0+g0+b0)/765;br1=(r1+g1+b1)/765;r=Math.round(r0/br0*br1);g=Math.round(g0/br0*br1);b=Math.round(b0/br0*br1);a=a1;return"rgba("+r+","+g+","+b+","+(a.toFixed(3))+")"};Base_Graphics.inverseColor=function(c0){var a,b,g,r,_ref;_ref=Base_Graphics.parseColor(c0),r=_ref[0],g=_ref[1],b=_ref[2],a=_ref[3];r=255-r;g=255-g;b=255-b;return"rgba("+r+","+g+","+b+","+(a.toFixed(3))+")"};Base_Graphics.applyShadow=function(g,style){if(style.shadowColor){g.shadowOffsetX=style.shadowOffsetX;g.shadowOffsetY=style.shadowOffsetY;g.shadowBlur=style.shadowBlur;return g.shadowColor=style.shadowColor}};Base_Graphics.clearShadow=function(g){g.shadowOffsetX=0;g.shadowOffsetY=0;g.shadowBlur=0;return g.shadowColor=""};return Base_Graphics})();var Linearchart_ValueAxis;Linearchart_ValueAxis=(function(){Linearchart_ValueAxis.prototype.lastMaxValue=0;Linearchart_ValueAxis.prototype.lastMinValue=0;Linearchart_ValueAxis.prototype.minValue=0;Linearchart_ValueAxis.prototype.maxValue=0;Linearchart_ValueAxis.prototype.scale=0;Linearchart_ValueAxis.prototype.zeroY=0;Linearchart_ValueAxis.prototype.logOffset=1;Linearchart_ValueAxis.prototype.minValueAnimation=null;Linearchart_ValueAxis.prototype.maxValueAnimation=null;Linearchart_ValueAxis.prototype.axisChanged=false;Linearchart_ValueAxis.prototype.seriesDepth=0;Linearchart_ValueAxis.prototype.seriesMinValue=null;Linearchart_ValueAxis.prototype.seriesMaxValue=null;Linearchart_ValueAxis.prototype.series=0;Linearchart_ValueAxis.computeMargins=function(valueAxisList){var axis,leftMargin,leftPadding,rightMargin,rightPadding,_i,_len;leftPadding=0;rightPadding=0;leftMargin=0;rightMargin=0;for(_i=0,_len=valueAxisList.length;_i<_len;_i++){axis=valueAxisList[_i];if(!axis.enabled){continue}if(axis.side==="left"){if(axis.position!=="inside"){leftMargin+=axis.size}else{leftPadding+=axis.size}}else{if(axis.position!=="inside"){rightMargin+=axis.size}else{rightPadding+=axis.size}}}return[leftMargin,leftPadding,rightPadding,rightMargin]};function Linearchart_ValueAxis(r,name,options){this.name=name;this.options=options;this.events=r.events;this.scene=r.scene;this.isLogScale=this.options.logScale;this.isInside=this.options.position==="inside";this.locations=[];this.values=[];this.cachedUnits=[]}Linearchart_ValueAxis.prototype.recieveSeriesGeometry=function(min,max,depth){if(min!==void 0){if(this.seriesMinValue!==void 0){this.seriesMinValue=Math.min(min,this.seriesMinValue)}else{this.seriesMinValue=min}}if(max!==void 0){if(this.seriesMaxValue!==void 0){this.seriesMaxValue=Math.max(max,this.seriesMaxValue)}else{this.seriesMaxValue=max}return this.seriesDepth=Math.max(depth,this.seriesDepth)}};Linearchart_ValueAxis.prototype.process=function(event){var hasChanges,max,min;hasChanges=event.changes.bounds||false;if(event.changes.settings){this.isLogScale=this.options.logScale;this.isInside=this.options.position==="inside";hasChanges=true}if(this.shouldChangeScale()){if(this.seriesMinValue!==this.lastMinValue){hasChanges=true;if((this.lastMinValue==null)||event.changes.displayUnit||this.minValue===this.maxValue){this.minValueAnimation=null}else{if(this.minValueAnimation!=null){this.minValueAnimation.retarget(this.seriesMinValue)}else{this.minValueAnimation=new Base_Animator(this.lastMinValue,this.seriesMinValue,this.options.scaleAdjustmentAnimationDelay,this.options.scaleAdjustmentAnimation,event.time)}}this.lastMinValue=this.seriesMinValue}if(this.seriesMaxValue!==this.lastMaxValue){hasChanges=true;if((this.lastMaxValue==null)||event.changes.displayUnit||this.minValue===this.maxValue){this.maxValueAnimation=null}else{if(this.maxValueAnimation!=null){this.maxValueAnimation.retarget(this.seriesMaxValue)}else{this.maxValueAnimation=new Base_Animator(this.lastMaxValue,this.seriesMaxValue,this.options.scaleAdjustmentAnimationDelay,this.options.scaleAdjustmentAnimation,event.time)}}this.lastMaxValue=this.seriesMaxValue}}this.seriesMaxValue=void 0;this.seriesMinValue=void 0;if(this.minValueAnimation){hasChanges=true;min=this.minValueAnimation.get(event.time);if(this.minValueAnimation.finished(event.time)){this.minValueAnimation=null}}else{min=this.lastMinValue}if(this.maxValueAnimation){hasChanges=true;max=this.maxValueAnimation.get(event.time);if(this.maxValueAnimation.finished(event.time)){this.maxValueAnimation=null}}else{max=this.lastMaxValue}this.axisChanged=hasChanges;if(hasChanges){this.computeNewScale(min,max)}if(this.minValueAnimation||this.maxValueAnimation){return event.animating=true}};Linearchart_ValueAxis.prototype.afterProcess=function(event){var logMul,logUnit,textAboveLine,value,valuePerLine,valueY,y0,y1,_ref;if(!this.axisChanged){return}this.axisChanged=false;if(!this.options.enabled){return}this.locations=[];this.values=[];textAboveLine=parseInt(this.options.style.valueLabel.font)/2*1.5;if(!(this.scale>0)){return}y0=this.scene.y0;y1=y0+this.scene.height;if(!this.isLogScale){valuePerLine=this.calcLinearValuePerLine();value=0;while(true){value+=valuePerLine;valueY=this.zeroY-this.valueToRelativeY(value);if(valueY-textAboveLine<=y0){break}this.locations.push(valueY|0);this.values.push(value)}value=0;while(true){value-=valuePerLine;valueY=this.zeroY-this.valueToRelativeY(value);if(valueY>=y1){break}this.locations.push(valueY|0);this.values.push(value)}}else{_ref=this.calcExpValuePerLine(),logUnit=_ref[0],logMul=_ref[1];value=1/logUnit;while(true){value*=logMul;valueY=this.zeroY-this.valueToRelativeY(value);if(valueY-textAboveLine<y0){break}this.locations.push((valueY|0)-0.5);this.values.push(value)}value=-1/logUnit;while(true){value*=logMul;valueY=this.zeroY-this.valueToRelativeY(value);if(valueY>=y1){break}this.locations.push((valueY|0)-0.5);this.values.push(value)}}if(this.minValue<0&&this.maxValue>0){this.locations.push(this.zeroY|0);return this.values.push(0)}};Linearchart_ValueAxis.prototype.paint=function(context,seriesContext){if(this.options.enabled&&this.series>0&&this.locations.length>0){this.paintGrid(seriesContext);this.paintZeroLine(seriesContext);return this.paintLabels(context)}};Linearchart_ValueAxis.prototype.shouldChangeScale=function(){var tolerance;if(this.seriesMinValue===void 0||this.seriesMaxValue===void 0){return false}if(this.lastMinValue===void 0||this.lastMaxValue===void 0||!(this.lastMinValue<this.lastMaxValue)){return true}if(this.seriesMinValue<this.minValue||this.seriesMaxValue>this.maxValue){return true}tolerance=1+this.options.scaleAdjustmentTolerance;if(this.seriesMinValue<0&&this.seriesMinValue>this.lastMinValue/tolerance){return true}if(this.seriesMaxValue>0&&this.seriesMaxValue<this.lastMaxValue/tolerance){return true}return false};Linearchart_ValueAxis.prototype.computeNewScale=function(min,max){var height,minStep,range,topPos,y0;height=this.scene.height;y0=this.scene.y0;if(this.options.zeroLine==="center"){max=Math.max(max,-min);min=-max}else{if(this.options.zeroLine==="visible"){min=Math.min(min,0);max=Math.max(max,0)}}if(!height>0||!(min<max)){this.minValue=0;this.maxValue=0;this.logOffset=1;this.scale=0;this.zeroY=y0+height;return}minStep=this.options.scaleMinUnit;if(minStep>0){if(min<0){min=Math.floor(min/minStep)*minStep}if(max>0){max=Math.ceil(max/minStep)*minStep}}if(min!==-100){if(this.isLogScale){min=Base_Helpers.sign(min)*Math.pow(Math.abs(min),1+this.options.scaleAdjustmentTolerance)}else{min=min*(1+this.options.scaleAdjustmentTolerance)}}if(max!==100){if(this.isLogScale){max=Base_Helpers.sign(max)*Math.pow(Math.abs(max),1+this.options.scaleAdjustmentTolerance)}else{max=max*(1+this.options.scaleAdjustmentTolerance)}}this.minValue=min;this.maxValue=max;if(!this.isLogScale){range=max-min}else{if(min<=0||max>=0){this.logOffset=1;range=Math.log(max+this.logOffset)+Math.log(-min+this.logOffset)}else{if(min<0){this.logOffset=1-min;range=Math.log(max+this.logOffset)}else{if(max>0){this.logOffset=1+max;range=Math.log(-min+this.logOffset)}}}}this.scale=height/range;topPos=this.valueToRelativeY(min);return this.zeroY=y0+height+topPos};Linearchart_ValueAxis.prototype.valueToRelativeY=function(value){if(!this.isLogScale){return this.scale*value}else{if(value>0){return this.scale*Math.log(value+this.logOffset)}else{if(value<0){return -this.scale*Math.log(-value+this.logOffset)}else{return 0}}}};Linearchart_ValueAxis.prototype.calcLinearValuePerLine=function(){var base,desired,orderOfMagnitude;desired=this.options.style.labelSpacing/this.scale;orderOfMagnitude=Math.log(desired)/Math.log(10);base=Math.pow(10,Math.floor(orderOfMagnitude-1));base=Math.max(base,this.options.scaleMinUnit);while(base<desired){if(base*2>=desired){return base*2}if(base>10&&base*2.5>=desired){return base*2.5}if(base*5>=desired){return base*5}base*=10}return base};Linearchart_ValueAxis.prototype.calcExpValuePerLine=function(){var pixelsPer10Times,stepSize,unit,valueMultiplier;pixelsPer10Times=this.valueToRelativeY(10)-this.valueToRelativeY(1);valueMultiplier=10;unit=10;stepSize=pixelsPer10Times;if(stepSize>this.options.style.labelSpacing*4){return[2,2]}while(stepSize<this.options.style.labelSpacing){valueMultiplier*=10;stepSize+=pixelsPer10Times}return[unit,valueMultiplier]};Linearchart_ValueAxis.prototype.getUnitAndName=function(base,settings){var digitsAfterComma,i,m,name,s,u,unit,x,_ref;base=Math.abs(base);i=this.isLogScale?"log":"lin";if(typeof this.cachedUnits[i]==="undefined"){this.cachedUnits[i]=[]}unit=1;name="";if(this.cachedUnits[i][base]){return this.cachedUnits[i][base]}_ref=settings.localization.valueUnits;for(u in _ref){m=_ref[u];s=Math.abs(base/m);if(i==="lin"){if(s<1000&&s>=1){unit=m;name=u;break}}else{if(i==="log"){if(base===Math.round(base/m)*m&&unit<m){unit=m;name=u}}}}digitsAfterComma=0;x=1;while(base<x){digitsAfterComma+=1;x/=10}this.cachedUnits[i][base]=[unit,digitsAfterComma,name];return[unit,digitsAfterComma,name]};Linearchart_ValueAxis.prototype.paintGrid=function(g){var i,x1,x2,y,_i,_j,_len,_len1,_ref,_ref1;if(!this.options.hgrid){return}x1=this.scene.x0;x2=this.scene.x0+this.scene.width;g.beginPath();g.lineWidth=1;_ref=this.locations;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){y=_ref[i];if(this.values[i]===0){continue}g.moveTo(x1,y);g.lineTo(x2,y)}Base_Graphics.stroke(g,this.options.style.hgrid1);if(this.options.style.hgrid2!=null){g.beginPath();_ref1=this.locations;for(i=_j=0,_len1=_ref1.length;_j<_len1;i=++_j){y=_ref1[i];if(this.values[i]===0){continue}g.moveTo(x1,y+1);g.lineTo(x2,y+1)}return Base_Graphics.stroke(g,this.options.style.hgrid2)}};Linearchart_ValueAxis.prototype.paintZeroLine=function(g){var d,x1,x2,z;d=Math.max(this.options.style.baseLineDepth,this.seriesDepth);x1=this.scene.x0;x2=this.scene.x0+this.scene.width;z=this.zeroY;g.beginPath();if(d>0){g.fillStyle=this.options.style.baseLineFillStyle;g.lineWidth=this.options.style.baseLineWidth;g.moveTo(x1,z);g.lineTo(x1+d,z-d);g.lineTo(x2,z-d);g.lineTo(x2,z);g.closePath();return g.fill()}else{g.strokeStyle=this.options.style.baseLineStyle;g.lineWidth=Math.max(1,this.options.style.baseLineWidth);g.moveTo(x1,z);g.lineTo(x2,z);return g.stroke()}};Linearchart_ValueAxis.prototype.paintLabels=function(g){var fractionDigits,i,labelX,name,tickx,unitMultiplier,unitName,value,valueY,x0,x1,y,_i,_j,_len,_ref,_ref1,_ref2,_ref3;if(this.options.side==="right"){x0=this.scene.x0+this.scene.width;x1=x0+this.options.size}else{x0=0;x1=x0+this.options.size}if(this.isInside){g.textAlign="center";g.textBaseline="middle";labelX=(x0+x1)/2}else{if(this.options.side==="right"){g.textAlign="start";g.textBaseline="middle";tickx=x0;labelX=x0+7}else{g.textAlign="end";g.textBaseline="middle";tickx=x1-4;labelX=x1-7}}if(!this.isInside){g.beginPath();_ref=this.locations;for(_i=0,_len=_ref.length;_i<_len;_i++){y=_ref[_i];g.moveTo(tickx,y);g.lineTo(tickx+4,y)}Base_Graphics.stroke(g,this.options.style.tick)}g.save();g.lineWidth=0;g.strokeStyle="";g.shadowOffsetX=0;g.shadowOffsetY=0;Base_Graphics.textStyle(g,this.options.style.valueLabel);for(i=_j=0,_ref1=this.locations.length-1;_j<=_ref1;i=_j+=1){value=this.values[i];valueY=this.locations[i];if(this.isLogScale){_ref2=this.getUnitAndName(value,this.scene.settings),unitMultiplier=_ref2[0],fractionDigits=_ref2[1],unitName=_ref2[2]}else{_ref3=this.getUnitAndName(this.values[0],this.scene.settings),unitMultiplier=_ref3[0],fractionDigits=_ref3[1],unitName=_ref3[2]}name=(value/unitMultiplier).toFixed(fractionDigits);if(unitMultiplier!==""&&value){name=name+" "+unitName}if(this.isInside){g.fillText(name,labelX,valueY)}else{g.fillText(name,labelX,valueY)}}g.restore()};return Linearchart_ValueAxis})();var PieChart_Renderer_Flat,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};PieChart_Renderer_Flat=(function(_super){__extends(PieChart_Renderer_Flat,_super);function PieChart_Renderer_Flat(){_ref=PieChart_Renderer_Flat.__super__.constructor.apply(this,arguments);return _ref}PieChart_Renderer_Flat.prototype.paintSlices=function(g,x,y,slices){var slice,_i,_len,_results;_results=[];for(_i=0,_len=slices.length;_i<_len;_i++){slice=slices[_i];_results.push(this.strokeAndPaint(g,x,y,slice))}return _results};return PieChart_Renderer_Flat})(PieChart_Renderer_Base);var PieChart_Renderer_Can,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};PieChart_Renderer_Can=(function(_super){__extends(PieChart_Renderer_Can,_super);function PieChart_Renderer_Can(){_ref=PieChart_Renderer_Can.__super__.constructor.apply(this,arguments);return _ref}PieChart_Renderer_Can.prototype.paintPie=function(context,x,y,r0,r1,a0,a1,pie){var depth,offset,_i,_len,_ref1,_results;PieChart_Renderer_Can.__super__.paintPie.call(this,context,x,y,r0,r1,a0,a1,pie);depth=this.settings.pie.depth;if(depth>0&&pie.allSlices.length>0){context.fillStyle="rgba(0,0,0,0.05)";_ref1=[5,10,18];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){offset=_ref1[_i];context.beginPath();context.arc(x,y+offset+depth,r1,a0,a1,false);context.arc(x,y+offset+depth,r0,a1,a0,true);context.closePath();_results.push(context.fill())}return _results}};PieChart_Renderer_Can.prototype.paintSlices=function(g,x,y,slices){var PI,density,depth,i,leftAngle,numSteps,params,rightAngle,slice,stepOffset,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_results;depth=this.settings.pie.depth;density=2*this.settings.advanced.renderQuality;stepOffset=1/density;numSteps=depth*density;g.shadowOffsetX=0;g.shadowOffsetY=0;g.shadowBlur=depth*1.5;g.shadowColor="black";g.fillStyle="black";for(_i=0,_len=slices.length;_i<_len;_i++){slice=slices[_i];this.strokeSlice(g,x,y+depth,slice);g.fill()}g.shadowColor=null;g.shadowBlur=0;g.lineWidth=1;for(i=_j=0;_j<=numSteps;i=_j+=1){for(_k=0,_len1=slices.length;_k<_len1;_k++){slice=slices[_k];this.strokeSlice(g,x,y+depth-i*stepOffset,slice);if(i>=numSteps-1){g.strokeStyle=Base_Graphics.deriveColor(slice.fillColor,1.35,1)}else{g.strokeStyle=Base_Graphics.deriveColor(slice.fillColor,0.5+i/numSteps*0.2,1)}g.stroke()}}PI=Math.PI;g.shadowBlur=depth;g.shadowColor="rgba(0,0,0,0.1)";g.fillStyle="black";for(_l=0,_len2=slices.length;_l<_len2;_l++){slice=slices[_l];params=slice.renderParams;leftAngle=params[4];rightAngle=params[5];if(leftAngle===rightAngle){continue}while(leftAngle>PI){leftAngle-=PI*2;rightAngle-=PI*2}if(leftAngle<0){if(rightAngle>0){rightAngle=Math.min(rightAngle,PI);if(this.strokeInnerShadowSlice(g,x,y,slice,0,rightAngle)){g.fill()}}}else{if(rightAngle<PI){if(this.strokeInnerShadowSlice(g,x,y,slice,leftAngle,rightAngle)){g.fill()}}else{if(leftAngle<PI){if(this.strokeInnerShadowSlice(g,x,y,slice,leftAngle,PI)){g.fill()}}if(rightAngle>2*PI){if(this.strokeInnerShadowSlice(g,x,y,slice,PI*2,rightAngle)){g.fill()}}}}}_results=[];for(_m=0,_len3=slices.length;_m<_len3;_m++){slice=slices[_m];g.beginPath();this.strokeSlice(g,x,y,slice);_results.push(Base_Graphics.paint(g,slice))}return _results};PieChart_Renderer_Can.prototype.strokeInnerShadowSlice=function(context,x,y,slice,leftAngle,rightAngle){var params,r0,r1;params=slice.renderParams;r0=params[0]+1;r1=Math.min(params[1]-1,r0+10);if(r0>=params[1]||r1<=params[0]){return false}leftAngle+=1/r0;rightAngle-=1/r0;if(leftAngle>=rightAngle){return}context.beginPath();context.arc(x,y,r1,leftAngle,rightAngle,false);context.arc(x,y,r0,rightAngle,leftAngle,true);context.closePath();return true};return PieChart_Renderer_Can})(PieChart_Renderer_Base);var PieChart_Renderer_Smoothy,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};PieChart_Renderer_Smoothy=(function(_super){__extends(PieChart_Renderer_Smoothy,_super);function PieChart_Renderer_Smoothy(){_ref=PieChart_Renderer_Smoothy.__super__.constructor.apply(this,arguments);return _ref}PieChart_Renderer_Smoothy.prototype.gradients={};PieChart_Renderer_Smoothy.prototype.paintSlices=function(g,x,y,slices){var slice,_i,_len,_results;this.g=g;_results=[];for(_i=0,_len=slices.length;_i<_len;_i++){slice=slices[_i];this.strokeSlice(g,x,y,slice);Base_Graphics.paint(g,slice);_results.push(this.elegantGradient(x,y,slice))}return _results};PieChart_Renderer_Smoothy.prototype.getRadialGradient=function(x,y,sr0,x1,y1,sr1,angle){var c1,gradient;c1=Math.abs(Math.sin(angle));gradient=this.g.createRadialGradient(x,y,sr0,x1,y1,sr1);this.addColorStops(gradient,c1,angle);return gradient};PieChart_Renderer_Smoothy.prototype.getLinearGradient=function(g,x,y,sr0,x1,y1,sr1,angle){var c1,cosa,dr,gradient,rx0,rx1,ry0,ry1,sina;dr=sr1-sr0;sina=Math.sin(angle);cosa=Math.cos(angle);rx0=x+cosa*sr0;ry0=y+sina*sr0;rx1=rx0+cosa*dr;ry1=ry0+sina*dr;c1=Math.abs(sina);gradient=this.g.createLinearGradient(rx0,ry0,rx1,ry1);this.addColorStops(gradient,c1,angle);return gradient};PieChart_Renderer_Smoothy.prototype.addColorStops=function(g,c1,angle){var black,coef1,coef2,coef3,coef4,coef5,col1,col2,white;black="0,0,0";white="255,255,255";if(angle<=0||angle>Math.PI){col1=black;col2=white}else{col1=white;col2=black}coef1=0.4*c1;coef2=0.2*c1;coef3=0.1*c1;coef4=0.3*c1;coef5=0.5*c1;g.addColorStop(0,"rgba("+col1+","+coef1.toFixed(3)+")");g.addColorStop(0.1,"rgba("+col1+","+coef2.toFixed(3)+")");g.addColorStop(0.1,"rgba("+col1+","+coef3.toFixed(3)+")");g.addColorStop(0.4,"rgba("+black+","+0.1+")");g.addColorStop(0.9,"rgba("+col2+","+coef3.toFixed(3)+")");g.addColorStop(0.95,"rgba("+col2+","+coef4.toFixed(3)+")");return g.addColorStop(1,"rgba("+col2+","+coef5.toFixed(3)+")")};PieChart_Renderer_Smoothy.prototype.elegantGradient=function(xx,yy,slice){var a1,a2,as1,as2,inc,quality,sr0,sr1,_results;sr0=slice.renderParams[0];sr1=slice.renderParams[1];a1=slice.renderParams[2];a2=slice.renderParams[3];quality=this.settings.advanced.renderQuality;inc=Math.PI/Math.max(1,180*quality);as1=a1;_results=[];while(as1<a2){as2=Math.min(as1+inc,a2);this.g.beginPath();this.g.arc(xx,yy,sr1,as1,as2);this.g.arc(xx,yy,sr0,as2,as1,true);this.g.closePath();Base_Graphics.paint(this.g,{fillColor:this.getRadialGradient(xx,yy,sr0,xx,yy,sr1,as1)});_results.push(as1=as2)}return _results};return PieChart_Renderer_Smoothy})(PieChart_Renderer_Base);var PieChart_Renderer_Bevel,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};PieChart_Renderer_Bevel=(function(_super){__extends(PieChart_Renderer_Bevel,_super);function PieChart_Renderer_Bevel(){this.getSmartGradient=__bind(this.getSmartGradient,this);_ref=PieChart_Renderer_Bevel.__super__.constructor.apply(this,arguments);return _ref}PieChart_Renderer_Bevel.prototype.gradients={};PieChart_Renderer_Bevel.prototype.paintSlices=function(g,x,y,slices){var slice,_i,_len,_results;this.g=g;_results=[];for(_i=0,_len=slices.length;_i<_len;_i++){slice=slices[_i];this.strokeAndPaint(g,x,y,slice);_results.push(this.smartGradient(x,y,slice))}return _results};PieChart_Renderer_Bevel.prototype.getSmartGradient=function(x,y,sr0,sr1,side,position){var c1,c2,e,gradient,n,x1,x2,y1,y2;n="g"+side+position+sr0+sr1;if((this.gradients[n]!=null)&&false){return this.gradients[n]}if(side==="inside"){if(position==="top"){y1=x1=x2=y2=0;y1=sr1-sr0;y2=y;c1="rgba(0,0,0,0.3)";c2="rgba(0,0,0,0)"}else{y1=x1=x2=y2=0;y1=y;y2=y+sr0;c1="rgba(255,255,255,0)";c2="rgba(255,255,255,0.3)"}}else{if(position==="top"){y1=x1=x2=y2=0;y2=y;c1="rgba(255,255,255,0.3)";c2="rgba(255,255,255,0)"}else{y1=x1=x2=y2=0;y1=y;y2=y+sr1;c1="rgba(0,0,0,0)";c2="rgba(0,0,0,0.3)"}}try{gradient=this.g.createLinearGradient(x1,y1,x2,y2);gradient.addColorStop(0,c1);gradient.addColorStop(1,c2);this.gradients[n]=gradient;return gradient}catch(_error){e=_error;;throw"Could not create linear gradient: "+e}};PieChart_Renderer_Bevel.prototype.smartOuterShineTop=function(x,y,sr0,sr1,a1,a2,a3,a4){var s;if(a1>0&&a2<Math.PI){return}if(a2>0&&a1<0){a2=0;a4=0}if(a1>0&&a1<Math.PI){a1=Math.PI;a3=Math.PI}s={renderParams:[sr1-0.1*(sr1-sr0),sr1,a1,a2,a3,a4],x:0,y:0};s.fillColor=this.getSmartGradient(x,y,sr0,sr1,"outside","top");return this.strokeAndPaint(this.g,x,y,s)};PieChart_Renderer_Bevel.prototype.smartOuterShineBottom=function(x,y,sr0,sr1,a1,a2,a3,a4){var s;if(a2<0||a1>Math.PI){return}if(a1<0){a1=0;a3=0}if(a2>Math.PI){a2=Math.PI;a4=Math.PI}s={renderParams:[sr1-0.1*(sr1-sr0),sr1,a1,a2,a3,a4],x:0,y:0};s.fillColor=this.getSmartGradient(x,y,sr0,sr1,"outside","bottom");return this.strokeAndPaint(this.g,x,y,s)};PieChart_Renderer_Bevel.prototype.smartInnerShineTop=function(x,y,sr0,sr1,a1,a2,a3,a4){var s;if(a1>0&&a2<Math.PI){return}if(a2>0&&a1<0){a2=0;a4=0}if(a1>0&&a1<Math.PI){a1=Math.PI;a3=Math.PI}s={renderParams:[sr0,sr0+0.1*(sr1-sr0),a1,a2,a3,a4],x:0,y:0};s.fillColor=this.getSmartGradient(x,y,sr0,sr1,"inside","top");return this.strokeAndPaint(this.g,x,y,s)};PieChart_Renderer_Bevel.prototype.smartInnerShineBottom=function(x,y,sr0,sr1,a1,a2,a3,a4){var s;if(a2<0||a1>Math.PI){return}if(a1<0){a1=0;a3=0}if(a2>Math.PI){a2=Math.PI;a4=Math.PI}s={renderParams:[sr0,sr0+0.1*(sr1-sr0),a1,a2,a3,a4],x:0,y:0};s.fillColor=this.getSmartGradient(x,y,sr0,sr1,"inside","bottom");return this.strokeAndPaint(this.g,x,y,s)};PieChart_Renderer_Bevel.prototype.smartGradient=function(x,y,slice){var a1,a2,a3,a4,sr0,sr1;x=x+slice.x;y=y+slice.y;sr0=slice.renderParams[0];sr1=slice.renderParams[1];a1=slice.renderParams[2];a2=slice.renderParams[3];a3=slice.renderParams[4];a4=slice.renderParams[5];this.smartOuterShineTop(x,y,sr0,sr1,a1,a2,a3,a4);this.smartOuterShineBottom(x,y,sr0,sr1,a1,a2,a3,a4);this.smartInnerShineTop(x,y,sr0,sr1,a1,a2,a3,a4);this.smartInnerShineBottom(x,y,sr0,sr1,a1,a2,a3,a4)};return PieChart_Renderer_Bevel})(PieChart_Renderer_Base);var Base_Helpers,lastTime,requestAnimationFrame,__hasProp={}.hasOwnProperty,__slice=[].slice;if(typeof String.prototype.trim==="undefined"){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(!requestAnimationFrame){lastTime=0;requestAnimationFrame=function(callback){var currTime,id,timeToCall;currTime=new Date().getTime();timeToCall=Math.max(0,16-(currTime-lastTime));id=window.setTimeout(function(){return callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}window.requestAnimationFrame=requestAnimationFrame;Base_Helpers=(function(){function Base_Helpers(){}Base_Helpers.prototype.baseCSSClass="DWSL";Base_Helpers.extend=function(object,other){var key,val;if(object==null){return{}}for(key in other){if(!__hasProp.call(other,key)){continue}val=other[key];object[key]=val}return object};Base_Helpers.extendDeep=function(object,other){var key,val,valBefore;if(object==null){return other}for(key in other){if(!__hasProp.call(other,key)){continue}val=other[key];valBefore=object[key];if(Base_Helpers.isObject(valBefore)&&Base_Helpers.isObject(val)){this.extendDeep(valBefore,val)}else{object[key]=val}}return object};Base_Helpers.configure=function(object,defaults){var v;for(v in defaults){if(typeof object[v]==="undefined"&&defaults[v]){object[v]=defaults[v]}}return object};Base_Helpers.clone=function(obj){var key,r,val;r={};for(key in obj){if(!__hasProp.call(obj,key)){continue}val=obj[key];r[key]=val}return r};Base_Helpers.isArray=function(source){return source instanceof Array};Base_Helpers.isObject=function(source){return source!==null&&typeof source==="object"};Base_Helpers.isFunction=function(source){return typeof source==="function"};Base_Helpers.isNumber=function(n){return !isNaN(parseFloat(n))&&isFinite(n)};Base_Helpers.isString=function(source){return Object.prototype.toString.call(source)==="[object String]"};Base_Helpers.hasProperties=function(o){var k,v;if(!o){return false}for(k in o){if(!__hasProp.call(o,k)){continue}v=o[k];return true}return false};Base_Helpers.removeProperty=function(o){var k,v;for(k in o){if(!__hasProp.call(o,k)){continue}v=o[k];delete o[k];return k}return null};Base_Helpers.removePropertyValue=function(o){var k,v;for(k in o){if(!__hasProp.call(o,k)){continue}v=o[k];delete o[k];return[k,v]}return null};Base_Helpers.countProperties=function(o){var c,k,v;c=0;for(k in o){if(!__hasProp.call(o,k)){continue}v=o[k];c+=1}return c};Base_Helpers.realClone=function(source){var a,d,k,o,v,_i,_len;o=this.isObject(source);a=this.isArray(source);if(a){d=[];for(k=_i=0,_len=source.length;_i<_len;k=++_i){v=source[k];if(typeof v!=="function"){d[k]=this.realClone(v)}else{d[k]=v}}}else{if(o){d={};for(k in source){v=source[k];if(typeof v!=="function"){d[k]=this.realClone(v)}else{d[k]=v}}}else{d=source}}return d};Base_Helpers.arrayContains=function(arr,item){var i,_i,_len;for(_i=0,_len=arr.length;_i<_len;_i++){i=arr[_i];if(i===item){return true}}return false};Base_Helpers.removeFromArray=function(arr,item){var i,removed,v;removed=false;for(i in arr){v=arr[i];if(v===item){arr.splice(i,1);removed=true}}return removed};Base_Helpers.arraysEqual=function(arr1,arr2){var i,_i,_ref;if(!((arr1!=null)&&(arr2!=null))){return false}if(arr1.length!==arr2.length){return false}for(i=_i=0,_ref=arr1.length-1;_i<=_ref;i=_i+=1){if(arr1[i]!==arr2[i]){return false}}return true};Base_Helpers.log=function(message,arg){if(typeof console!=="undefined"&&console!==null){if(arg!=null){return console.info(message,arg)}else{return console.info(message)}}};Base_Helpers.error=function(message,arg){if(typeof console!=="undefined"&&console!==null){if(arg!=null){return console.error(message,arg)}else{return console.error(message)}}};Base_Helpers.getExtension=function(name){var re;re=/(?:\.([^.]+))?$/;return re.exec(name)[1]};Base_Helpers.createDom=function(tagName,cl,innerHtml,container){var el;el=document.createElement(tagName);if(cl!=null){el.className=cl}if(innerHtml!=null){el.innerHTML=innerHtml}if(container!=null){container.appendChild(el)}return el};Base_Helpers.createStyledDom=function(tagName,style,innerHtml,container){var el,k,v;el=document.createElement(tagName);if(style!=null){for(k in style){if(!__hasProp.call(style,k)){continue}v=style[k];el.style[k]=v}}if(innerHtml!=null){el.innerHTML=innerHtml}if(container!=null){container.appendChild(el)}return el};Base_Helpers.hasClass=function(el,name){return(el.className.length>0)&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(el.className)};Base_Helpers.addClass=function(el,name){if(!Base_Helpers.hasClass(el,name)){if(el.className.length===0){return el.className=name}else{return el.className=el.className+" "+name}}};Base_Helpers.removeClass=function(el,name){var replaceFn;replaceFn=function(w,match){if(match===name){return""}else{return w}};return el.className=el.className.replace(/(\S+)\s*/g,replaceFn).replace(/(^\s+|\s+$)/,"")};Base_Helpers.setClass=function(el,name){return el.className=name};Base_Helpers.listen=function(node,event,fn){if(node.addEventListener){return node.addEventListener(event,fn)}else{return node.attachEvent("on"+event,fn)}};Base_Helpers.unlisten=function(node,event,fn){if(node.removeEventListener){return node.removeEventListener(event,fn)}else{return node.detachEvent("on"+event,fn)}};Base_Helpers.createEvent=function(type){var event;if(document.createEvent){event=document.createEvent("Event");event.initEvent(type,true,true)}else{event=document.createEventObject()}return event};Base_Helpers.canvasScaling=function(){var r;r=1;if(window.devicePixelRatio){r=window.devicePixelRatio}else{if(window.screen.systemXDPI){r=window.screen.systemXDPI/window.screen.logicalXDPI}}return[r,r]};Base_Helpers.elementPos=function(obj){var curLeft,curTop;curLeft=0;curTop=0;while(obj.offsetParent!=null){curLeft+=obj.offsetLeft;curTop+=obj.offsetTop;obj=obj.offsetParent}return[curLeft,curTop]};Base_Helpers.isParentOf=function(parent,child){while(child!=null){if(child===parent){return true}child=child.parentElement}return false};Base_Helpers.fadeIn=function(dom){return dom.style.display="block"};Base_Helpers.fadeOut=function(dom){return dom.style.display="none"};Base_Helpers.hide=function(dom){return dom.style.display="none"};Base_Helpers.show=function(dom){return dom.style.display="block"};Base_Helpers.wrapClass=function(base,c){var o,x,y,_i,_len;if(!this.baseCSSClass){this.baseCSSClass="DVSL"}if(!base){base=this.baseCSSClass}if(typeof base==="object"){if(base.objClass){base=base.objClass}else{base=this.baseCSSClass}}x=c.split(",");o="";for(_i=0,_len=x.length;_i<_len;_i++){y=x[_i];if(o){o+=" "}o+=base+"-"+y}return o};Base_Helpers.getProp=function(obj,route){var part,_i,_len,_ref;_ref=route.split("/");for(_i=0,_len=_ref.length;_i<_len;_i++){part=_ref[_i];if(obj.hasOwnProperty(part)){obj=obj[part]}else{return void 0}}return obj};Base_Helpers.hasProp=function(obj,route){var part,_i,_len,_ref;_ref=route.split("/");for(_i=0,_len=_ref.length;_i<_len;_i++){part=_ref[_i];if(obj.hasOwnProperty(part)){obj=obj[part]}else{return false}}return obj!==void 0};Base_Helpers.getScroll=function(){var body,doc,left,top;doc=document.documentElement;body=document.body;left=doc&&doc.scrollLeft||body&&body.scrollLeft||0;top=doc&&doc.scrollTop||body&&body.scrollTop||0;return[left,top]};Base_Helpers.isWithIn=function(dot,box){if(dot[0]<box[0]||dot[0]>box[2]||dot[1]<box[1]||dot[1]>box[3]){return true}else{return false}};Base_Helpers.mixIn=function(target,src){var k,v,_ref,_results;_ref=src.prototype;_results=[];for(k in _ref){v=_ref[k];_results.push(target[k]=v)}return _results};Base_Helpers.sign=function(x){if(!x){return 0}if(x<0){return -1}return 1};Base_Helpers.each=function(){var args,k,key,method,results,v,_i,_len,_ref,_ref1;key=arguments[0],method=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[];results=[];if(Base_Helpers.isArray(this[key])){_ref=this[key];for(_i=0,_len=_ref.length;_i<_len;_i++){v=_ref[_i];if(v[method]!=null){results.push(v[method].apply(v,args))}else{console.error(v);throw"Object "+v+"does not have method: "+method}}}else{if(Base_Helpers.isObject(this[key])){_ref1=this[key];for(k in _ref1){v=_ref1[k];if(v[method]!=null){results.push(v[method].apply(v,args))}else{console.error(v);throw"Object "+v+"does not have method "+method}}}else{console.error(key,method,args);throw"Called iterator each on non-object/non-array"}}return results};Base_Helpers.detectBrowser=function(){var m,n,tem,ua;n=navigator.appName;ua=navigator.userAgent;m=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(m&&(tem=ua.match(/version\/([\.\d]+)/i))!==null){m[2]=tem[1]}if(m){m=[m[1],m[2]]}else{m=[n,navigator.appVersion,"-?"]}return m[0].toLowerCase()};Base_Helpers.nextIdentifier=0;Base_Helpers.getIdentifier=function(){return Base_Helpers.nextIdentifier++};Base_Helpers.doRequest=function(url,params,success,fail){var o,p,req,_i,_len,_this=this;o=[];for(_i=0,_len=params.length;_i<_len;_i++){p=params[_i];o.push(""+(encodeURIComponent(p[0]))+"="+(encodeURIComponent(p[1])))}o=o.join("&");if(url.indexOf("?")!==-1){url+="&"+o}else{url+="?"+o}if(window.XMLHttpRequest){req=new XMLHttpRequest()}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP")}}if(req){req.onreadystatechange=function(){if(req.readyState===4){if(req.status===200){return success(req.responseText)}else{return fail()}}};req.open("GET",url,true);return req.send("")}};Base_Helpers.openUrl=function(url){if(Base_Helpers.isString(url)){return window.open(url)}else{return window.open(url.url,url.name,url.specs,url.replace)}};Base_Helpers.parseData=function(text,format,chart){var data,error;data=null;if(format==="JSON"){if(typeof text==="string"||text instanceof String){try{data=JSON.parse(text)}catch(_error){error=_error;chart.error("Error: failed to parse JSON response: "+error+": "+text);data={error:"Error: failed to parse JSON response"}}}else{data=text}}else{chart.error("Unsupported data format: "+format)}return data};return Base_Helpers})();var Base_Scene;Base_Scene=(function(){function Base_Scene(){}Base_Scene.prototype.chartWidth=1;Base_Scene.prototype.chartHeight=1;Base_Scene.prototype.toolbarHeight=0;Base_Scene.prototype.x0=0;Base_Scene.prototype.y0=0;Base_Scene.prototype.height=100;Base_Scene.prototype.width=100;Base_Scene.prototype.canvasScaleX=1;Base_Scene.prototype.canvasScaleY=1;Base_Scene.prototype.settings=null;Base_Scene.prototype.loading=true;Base_Scene.prototype.messages={};Base_Scene.prototype.setMessage=function(origin,msg,pri){var changed;if(msg!=null){changed=(this.messages[origin]==null)||this.messages[origin].msg!==msg||this.messages[origin].pri!==pri;this.messages[origin]={msg:msg,pri:pri}}else{changed=this.messages[origin]!=null;delete this.messages[origin]}return changed};Base_Scene.prototype.getMessage=function(){var k,m,mm,pri,_ref;m=null;pri=0;_ref=this.messages;for(k in _ref){mm=_ref[k];if(mm.pri>pri){m=mm.msg;pri=mm.pri}}return m};Base_Scene.prototype.getChartBounds=function(){throw"GetChartBounds needs to be implmented in subclass"};return Base_Scene})();var Netchart_Icon,Netchart_Link,Netchart_Node,Netchart_Scene,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Netchart_Icon=(function(){function Netchart_Icon(){}Netchart_Icon.prototype.image=null;Netchart_Icon.prototype.title=null;Netchart_Icon.prototype.onclick=null;return Netchart_Icon})();Netchart_Node=(function(){Netchart_Node.prototype.id="";Netchart_Node.prototype.x=0;Netchart_Node.prototype.y=0;Netchart_Node.prototype.isNode=true;Netchart_Node.prototype.isLink=false;Netchart_Node.prototype.removed=false;Netchart_Node.prototype.data=null;Netchart_Node.prototype.loading=false;Netchart_Node.prototype.links=null;Netchart_Node.prototype.dataLinks=null;Netchart_Node.prototype.userLock=false;Netchart_Node.prototype.expanded=false;Netchart_Node.prototype.focused=false;Netchart_Node.prototype.image=null;Netchart_Node.prototype.imageSlicing=null;Netchart_Node.prototype.radius=10;Netchart_Node.prototype.label=null;Netchart_Node.prototype.labelStyle=null;Netchart_Node.prototype.labelBackground=null;Netchart_Node.prototype.icons=null;Netchart_Node.prototype.hilight=null;Netchart_Node.prototype.locks=0;Netchart_Node.prototype.currentRadius=0;function Netchart_Node(id){this.id=id;this.links=[]}return Netchart_Node})();Netchart_Link=(function(){function Netchart_Link(){}Netchart_Link.prototype.from=null;Netchart_Link.prototype.to=null;Netchart_Link.prototype.removed=false;Netchart_Link.prototype.isNode=false;Netchart_Link.prototype.isLink=true;Netchart_Link.prototype.data=null;Netchart_Link.prototype.multiId=null;Netchart_Link.prototype.radius=1;Netchart_Link.prototype.label=null;Netchart_Link.prototype.labelStyle=null;Netchart_Link.prototype.labelBackground=null;Netchart_Link.prototype.strength=1;Netchart_Link.prototype.dashed=false;Netchart_Link.prototype.currentRadius=0;Netchart_Link.prototype.direction=null;Netchart_Link.prototype.fromDecoration=null;Netchart_Link.prototype.toDecoration=null;Netchart_Link.prototype.fromIcons=null;Netchart_Link.prototype.toIcons=null;Netchart_Link.prototype.highlight=null;Netchart_Link.prototype.toPieValue=0;Netchart_Link.prototype.toPieColor=null;Netchart_Link.prototype.toPie0=null;Netchart_Link.prototype.toPie1=null;Netchart_Link.prototype.otherEnd=function(node){if(node===this.from){return this.to}if(node===this.to){return this.from}return null};Netchart_Link.prototype.commonNode=function(link){if(this.from===link.from||this.from===link.to){return this.from}if(this.to===link.from||this.to===link.to){return this.to}return null};return Netchart_Link})();Netchart_Scene=(function(_super){__extends(Netchart_Scene,_super);Netchart_Scene.prototype.settings=null;Netchart_Scene.prototype.nodes=[];Netchart_Scene.prototype.links=[];Netchart_Scene.prototype.idToNode={};Netchart_Scene.prototype.idToLink={};Netchart_Scene.prototype.selection=[];Netchart_Scene.prototype.userNodeIds={};Netchart_Scene.prototype.positionedNodeIds={};Netchart_Scene.prototype.activeNode=null;Netchart_Scene.prototype.activeLink=null;Netchart_Scene.prototype.newNodes={};Netchart_Scene.prototype.newLinks={};Netchart_Scene.prototype.modifiedNodes={};Netchart_Scene.prototype.modifiedLinks={};Netchart_Scene.prototype.deletedNodes={};Netchart_Scene.prototype.deletedLinks={};Netchart_Scene.prototype.enteringNodes={};Netchart_Scene.prototype.enteringLinks={};Netchart_Scene.prototype.exitingNodes={};Netchart_Scene.prototype.exitingLinks={};Netchart_Scene.prototype.centerX=0;Netchart_Scene.prototype.centerY=0;Netchart_Scene.prototype.zoom=1;Netchart_Scene.prototype.layoutActive=true;function Netchart_Scene(){this.nodes=[];this.links=[];this.userNodeIds={};this.positionedNodeIds={};this.selection=[];this.idToNode={};this.idToLink={};this.multilinks=null;this.clearModified()}Netchart_Scene.prototype.addNode=function(nodeId){var node;if(this.idToNode.hasOwnProperty(nodeId)){node=this.idToNode[nodeId];node.removed=false}else{if(this.deletedNodes.hasOwnProperty(nodeId)){node=this.deletedNodes[nodeId];node.removed=false;delete this.deletedNodes[nodeId]}else{node=new Netchart_Node(nodeId);this.idToNode[nodeId]=node;this.nodes.push(node);this.newNodes[nodeId]=node}}this.modifiedNodes[nodeId]=node;return node};Netchart_Scene.prototype.touchNode=function(node){return this.modifiedNodes[node.id]=node};Netchart_Scene.prototype.removeNode=function(node){var link,nodeId,_i,_len,_ref,_results;nodeId=node.id;if(!this.idToNode.hasOwnProperty(nodeId)){return}Base_Helpers.removeFromArray(this.selection,node);if(this.newNodes.hasOwnProperty(node.id)){this.deleteNode(node)}else{node.removed=true;this.modifiedNodes[nodeId]=node}_ref=node.links;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){link=_ref[_i];_results.push(this.removeLink(link))}return _results};Netchart_Scene.prototype.deleteNode=function(node){Base_Helpers.removeFromArray(this.selection,node);Base_Helpers.removeFromArray(this.nodes,node);delete this.newNodes[node.id];delete this.modifiedNodes[node.id];delete this.idToNode[node.id];return this.deletedNodes[node.id]=node};Netchart_Scene.prototype.addLink=function(linkId,from,to){var link;if(this.idToLink.hasOwnProperty(linkId)){link=this.idToLink[linkId];link.removed=false}else{if(this.deletedLinks.hasOwnProperty(linkId)){link=this.deletedLinks[linkId];delete this.deletedLinks[linkId];this.idToLink[linkId]=link;this.links.push(link);link.removed=false}else{link=new Netchart_Link();link.id=linkId;this.links.push(link);this.idToLink[linkId]=link;this.newLinks[linkId]=link}}link.multiId=from<to?from+"#"+to:to+"#"+from;this.modifiedLinks[linkId]=link;return link};Netchart_Scene.prototype.removeLink=function(link){var linkId;linkId=link.id;if(!this.idToLink.hasOwnProperty(linkId)){return}if(this.newLinks.hasOwnProperty(linkId)){return this.deleteLink(link)}else{link.removed=true;return this.modifiedLinks[linkId]=link}};Netchart_Scene.prototype.deleteLink=function(link){Base_Helpers.removeFromArray(this.links,link);if(this.newLinks.hasOwnProperty(link.id)){delete this.newLinks[link.id]}else{this.deletedLinks[link.id]=link}delete this.modifiedLinks[link.id];return delete this.idToLink[link.id]};Netchart_Scene.prototype.touchLink=function(link){return this.modifiedLinks[link.id]=link};Netchart_Scene.prototype.getModified=function(){return[this.newNodes,this.newLinks,this.modifiedNodes,this.modifiedLinks,this.deletedNodes,this.deletedLinks]};Netchart_Scene.prototype.hasTopologyChanges=function(){return Base_Helpers.hasProperties(this.newNodes)||Base_Helpers.hasProperties(this.newLinks)||Base_Helpers.hasProperties(this.deletedNodes)||Base_Helpers.hasProperties(this.deletedLinks)};Netchart_Scene.prototype.hasStyleChanges=function(){return this.hasTopologyChanges()||Base_Helpers.hasProperties(this.modifiedLinks)||Base_Helpers.hasProperties(this.modifiedNodes)};Netchart_Scene.prototype.clearModified=function(){this.newNodes={};this.newLinks={};this.modifiedNodes={};this.modifiedLinks={};this.deletedNodes={};return this.deletedLinks={}};Netchart_Scene.prototype.xyInChart=function(x,y){return(x>=this.x0)&&(x<this.x0+this.width)&&(y>=this.y0)&&(y<this.y0+this.height)};Netchart_Scene.prototype.toDisplay=function(x,y){return[(x-this.centerX)*this.zoom+this.x0+this.width*0.5,(y-this.centerY)*this.zoom+this.y0+this.height*0.5]};Netchart_Scene.prototype.fromDisplay=function(x,y){return[(x-this.x0-this.width*0.5)/this.zoom+this.centerX,(y-this.y0-this.height*0.5)/this.zoom+this.centerY]};Netchart_Scene.prototype.toDisplayTransform=function(x,y){return[this.zoom,this.x0+this.width*0.5-this.centerX*this.zoom,this.zoom,this.y0+this.height*0.5-this.centerY*this.zoom]};Netchart_Scene.prototype.setActiveObject=function(obj){if(this.activeNode!=null){this.touchNode(this.activeNode)}if(this.activeLink!=null){this.touchLink(this.activeLink)}this.activeNode=null;this.activeLink=null;if(obj instanceof Netchart_Node){this.activeNode=obj;return this.touchNode(this.activeNode)}else{if(obj instanceof Netchart_Link){this.activeLink=obj;return this.touchLink(this.activeLink)}else{if(obj!==null){throw"scene.setActiveObject invalid active object type "+obj}}}};Netchart_Scene.prototype.getChartBounds=function(){return{left:this.x0,top:this.y0,right:this.x0+this.width,bottom:this.y0+this.height}};Netchart_Scene.prototype.getVisibleBounds=function(){var x0,x1,y0,y1,_ref,_ref1;_ref=this.fromDisplay(this.x0,this.y0),x0=_ref[0],y0=_ref[1];_ref1=this.fromDisplay(this.x0+this.width,this.y0+this.height),x1=_ref1[0],y1=_ref1[1];return[x0,y0,x1,y1]};Netchart_Scene.prototype.getGraphBounds=function(){var node,r,x,x0,x1,y,y0,y1,_i,_len,_ref;if(this.nodes.length===0){return[0,0,0,0]}x0=Infinity;x1=-Infinity;y0=Infinity;y1=-Infinity;_ref=this.nodes;for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];if(node.removed){continue}x=node.x;y=node.y;r=node.currentRadius;if(node.renderRadius){r=node.renderRadius}r=r*1.2;x0=Math.min(x0,x-r);x1=Math.max(x1,x+r);y0=Math.min(y0,y-r);y1=Math.max(y1,y+r)}return[x0,y0,x1,y1]};Netchart_Scene.prototype.findNodeAt=function(displayX,displayY,tolerance){var best,distanceSq,insideSq,min,n,r,toleranceSq,x,y,_i,_len,_ref,_ref1;_ref=this.fromDisplay(displayX,displayY),x=_ref[0],y=_ref[1];min=tolerance;best=null;_ref1=this.nodes;for(_i=0,_len=_ref1.length;_i<_len;_i++){n=_ref1[_i];if(n.removed){continue}r=n.targetRadius;distanceSq=(x-n.x)*(x-n.x)+(y-n.y)*(y-n.y);toleranceSq=(r+min)*(r+min);if(distanceSq<toleranceSq){insideSq=r*r;if(distanceSq<insideSq){return n}else{min=Math.sqrt(distanceSq)-r}}}return best};Netchart_Scene.prototype.findLinkOrNodeAt=function(displayX,displayY,tolerance){var best,cx,cy,distanceSq,insideSq,l,min,n,r,toleranceSq,x,x0,x1,y,y0,y1,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3;_ref=this.fromDisplay(displayX,displayY),x=_ref[0],y=_ref[1];min=tolerance;best=null;_ref1=this.nodes;for(_i=0,_len=_ref1.length;_i<_len;_i++){n=_ref1[_i];if(n.removed){continue}r=n.targetRadius;distanceSq=(x-n.x)*(x-n.x)+(y-n.y)*(y-n.y);toleranceSq=(r+min)*(r+min);if(distanceSq<toleranceSq){insideSq=r*r;if(distanceSq<insideSq){return n}else{min=Math.sqrt(distanceSq)-r;best=n}}}_ref2=this.links;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){l=_ref2[_j];if(l.removed){continue}r=l.targetRadius;x0=l.from.x;y0=l.from.y;x1=l.to.x;y1=l.to.y;_ref3=Base_Geometry.closestPointToLine(x0,y0,x1,y1,x,y),cx=_ref3[0],cy=_ref3[1];distanceSq=(x-cx)*(x-cx)+(y-cy)*(y-cy);toleranceSq=(r+min)*(r+min);if(distanceSq<toleranceSq){min=Math.sqrt(distanceSq)-r;best=l}}return best};Netchart_Scene.prototype.updateMultilinks=function(){var l,link,multiId,multiLinks,_i,_len,_ref;if(!this.hasTopologyChanges()){return}multiLinks={};_ref=this.links;for(_i=0,_len=_ref.length;_i<_len;_i++){link=_ref[_i];multiId=link.multiId;if(!multiLinks.hasOwnProperty(multiId)){multiLinks[multiId]=link}else{l=multiLinks[multiId];if(l.length!=null){l.push(link)}else{multiLinks[multiId]=[multiLinks[multiId],link]}}}return this.multilinks=multiLinks};return Netchart_Scene})(Base_Scene);var Base_MouseEvent,Base_MouseEvents,Base_MousePointer,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty;Base_MouseEvent=(function(){Base_MouseEvent.prototype.time=0;Base_MouseEvent.prototype.changes={};Base_MouseEvent.prototype.consumed=false;Base_MouseEvent.prototype.defaultPrevented=false;Base_MouseEvent.prototype.preventDefault=function(){return this.defaultPrevented=true};Base_MouseEvent.prototype.x=0;Base_MouseEvent.prototype.y=0;Base_MouseEvent.prototype.dx=0;Base_MouseEvent.prototype.dy=0;Base_MouseEvent.prototype.vx=0;Base_MouseEvent.prototype.vy=0;Base_MouseEvent.prototype.wheely=0;Base_MouseEvent.prototype.wheelx=0;Base_MouseEvent.prototype.identifier=0;Base_MouseEvent.prototype.pressed=false;Base_MouseEvent.prototype.consumed=false;Base_MouseEvent.prototype.touch=false;Base_MouseEvent.prototype.swipeUp=false;Base_MouseEvent.prototype.swipeDown=false;Base_MouseEvent.prototype.swipeLeft=false;Base_MouseEvent.prototype.swipeRight=false;function Base_MouseEvent(x,y,time,identifier){this.x=x;this.y=y;this.time=time;this.identifier=identifier;1}Base_MouseEvent.prototype.distance=function(p){return Math.sqrt((p.x-this.x)*(p.x-this.x)+(p.y-this.y)*(p.y-this.y))};return Base_MouseEvent})();Base_MousePointer=(function(){function Base_MousePointer(event,settings){this.settings=settings;this.identifier=event.identifier;this.x=event.x;this.y=event.y;this.pageX=event.pageX;this.pageY=event.pageY;this.time=event.time;this.pts=[[this.x,this.y,this.time]]}Base_MousePointer.prototype.moveTo=function(e){if(e.time===this.time){this.pts.pop()}this.time=e.time;if(e.x||e.y){this.x=e.x;this.y=e.y}this.pts.push([this.x,this.y,this.time]);if(this.pts.length>6){return this.pts.unshift()}};Base_MousePointer.prototype.getPosAndSpeed=function(e,isUp){var dt,fraction,fromI,i,lastI,smallestDt,vx,vy,_i,_j,_k;e.x=this.x;e.y=this.y;lastI=this.pts.length-2;if(lastI>=0){e.dx=this.pts[lastI+1][0]-this.pts[lastI][0];e.dy=this.pts[lastI+1][1]-this.pts[lastI][1]}else{e.dx=0;e.dy=0}smallestDt=Infinity;for(i=_i=0;_i<=lastI;i=_i+=1){dt=this.pts[i+1][2]-this.pts[i][2];smallestDt=Math.min(smallestDt,this.pts[i+1][2]-this.pts[i][2])}smallestDt=Math.max(smallestDt,20);fromI=-1;for(i=_j=lastI;_j>=0;i=_j+=-1){dt=this.pts[i+1][2]-this.pts[i][2];if(dt>smallestDt*2){break}fromI=i}if(fromI===-1){e.vx=0;e.vy=0;return}vx=0;vy=0;fraction=1;for(i=_k=fromI;_k<=lastI;i=_k+=1){dt=this.pts[i+1][2]-this.pts[i][2];vx=vx*(1-fraction)+(this.pts[i+1][0]-this.pts[i][0])/dt*fraction;vy=vx*(1-fraction)+(this.pts[i+1][1]-this.pts[i][1])/dt*fraction;fraction=0.6}e.vx=vx*1000;return e.vy=vy*1000};return Base_MousePointer})();Base_MouseEvents=(function(){Base_MouseEvents.prototype.ID_MOUSE="mouse";Base_MouseEvents.prototype.EVENT_MOVE="move";Base_MouseEvents.prototype.EVENT_DOWN="down";Base_MouseEvents.prototype.EVENT_DRAG="drag";Base_MouseEvents.prototype.EVENT_UP="up";Base_MouseEvents.prototype.EVENT_LEAVE="leave";Base_MouseEvents.prototype.EVENT_CLICK="click";Base_MouseEvents.prototype.EVENT_RCLICK="rclick";Base_MouseEvents.prototype.EVENT_DBLCLICK="dblclick";Base_MouseEvents.prototype.EVENT_WHEEL="mwheel";Base_MouseEvents.prototype.scaleX=1;Base_MouseEvents.prototype.scaleY=1;Base_MouseEvents.prototype.hasTouch=false;Base_MouseEvents.prototype.mm=1;Base_MouseEvents.prototype.clickEvent=null;Base_MouseEvents.prototype.cachedContainerPosition=null;function Base_MouseEvents(container,settings){this.container=container;this.settings=settings;this.handleTouchMove=__bind(this.handleTouchMove,this);this.handleTouchEnd=__bind(this.handleTouchEnd,this);this.handleTouchStart=__bind(this.handleTouchStart,this);this.handleMouseMove=__bind(this.handleMouseMove,this);this.handleMouseUp=__bind(this.handleMouseUp,this);this.handleMouseWheel=__bind(this.handleMouseWheel,this);this.handleCMenu=__bind(this.handleCMenu,this);this.handleMouseDown=__bind(this.handleMouseDown,this);this.updateContainerPosition=__bind(this.updateContainerPosition,this);this.listeners={};this.downPointers={};this.inPointers={};this.whiteList=[this.container];Base_Helpers.listen(this.container,"mousedown",this.handleMouseDown);Base_Helpers.listen(this.container,"contextmenu",this.handleCMenu);Base_Helpers.listen(this.container,"mousewheel",this.handleMouseWheel);Base_Helpers.listen(this.container,"DOMMouseScroll",this.handleMouseWheel);Base_Helpers.listen(this.container,"touchstart",this.handleTouchStart);Base_Helpers.listen(window,"mouseup",this.handleMouseUp);Base_Helpers.listen(window,"mousemove",this.handleMouseMove);Base_Helpers.listen(window,"touchend",this.handleTouchEnd);Base_Helpers.listen(window,"touchcancel",this.handleTouchEnd);Base_Helpers.listen(window,"touchmove",this.handleTouchMove);Base_Helpers.listen(window,"resize",this.updateContainerPosition)}Base_MouseEvents.prototype.addWhiteList=function(item){this.whiteList.push(item);Base_Helpers.listen(item,"mousedown",this.handleMouseDown);Base_Helpers.listen(item,"mousewheel",this.handleMouseWheel);Base_Helpers.listen(item,"DOMMouseScroll",this.handleMouseWheel);return Base_Helpers.listen(item,"touchstart",this.handleTouchStart)};Base_MouseEvents.prototype.remove=function(){var k,v,_i,_len,_ref;Base_Helpers.unlisten(this.container,"mousedown",this.handleMouseDown);Base_Helpers.unlisten(this.container,"contextmenu",this.handleCMenu);Base_Helpers.unlisten(this.container,"mousewheel",this.handleMouseWheel);Base_Helpers.unlisten(this.container,"DOMMouseScroll",this.handleMouseWheel);Base_Helpers.unlisten(this.container,"touchstart",this.handleTouchStart);if(this.whiteList!=null){_ref=this.whiteList;for(k=_i=0,_len=_ref.length;_i<_len;k=++_i){v=_ref[k];Base_Helpers.unlisten(v,"mousedown",this.handleMouseDown);Base_Helpers.unlisten(v,"mousewheel",this.handleMouseWheel);Base_Helpers.unlisten(v,"DOMMouseScroll",this.handleMouseWheel);Base_Helpers.unlisten(v,"touchstart",this.handleTouchStart)}}Base_Helpers.unlisten(window,"mouseup",this.handleMouseUp);Base_Helpers.unlisten(window,"mousemove",this.handleMouseMove);Base_Helpers.unlisten(window,"touchend",this.handleTouchEnd);Base_Helpers.unlisten(window,"touchcancel",this.handleTouchEnd);return Base_Helpers.unlisten(window,"touchmove",this.handleTouchMove)};Base_MouseEvents.prototype.listen=function(eventName,func){return this.listeners[eventName]=func};Base_MouseEvents.prototype.getContainerPosition=function(){if(this.cachedContainerPosition!=null){return this.cachedContainerPosition}else{return this.updateContainerPosition()}};Base_MouseEvents.prototype.updateContainerPosition=function(){this.cachedContainerPosition=Base_Helpers.elementPos(this.container);return this.cachedContainerPosition};Base_MouseEvents.prototype.handleMouseDown=function(event){var e;if(this.hasTouch){return}e=this.buildEvent(event,this.ID_MOUSE,event.timeStamp,true);this.downHappened(e);if(e.consumed){return event.preventDefault()}};Base_MouseEvents.prototype.handleCMenu=function(event){var e,isRightMB;if(event.witch){isRightMB=event.which===3}else{isRightMB=event.button===2}if(isRightMB){e=this.buildEvent(event,this.ID_MOUSE,event.timeStamp,true);this.rclickHappened(e);if(e.consumed){return event.preventDefault()}}};Base_MouseEvents.prototype.handleMouseWheel=function(event){var e;e=this.buildEvent(event,this.ID_MOUSE,event.timeStamp,true);e.wheely=event.wheelDelta|(event.detail*-40);this.wheelHappened(e);if(e.consumed){return event.preventDefault()}};Base_MouseEvents.prototype.handleMouseUp=function(event){var e,removeAll;if(this.hasTouch){return}if(event.shiftKey&&event.ctrlKey){this.ID_MOUSE="mouse"+this.mm;this.mm+=1;return}else{removeAll=true}e=this.buildEvent(event,this.ID_MOUSE,event.timeStamp,false);e.isRightMB=event.witch?event.which===3:event.button===2;this.upHappened(e);if(e.consumed){event.preventDefault()}if(removeAll){return this.removeLostTouches(event,[],[])}};Base_MouseEvents.prototype.handleMouseMove=function(event){var e;if(this.hasTouch){return}e=this.buildEvent(event,this.ID_MOUSE,event.timeStamp,false);this.moveHappened(e);if(e.consumed){return event.preventDefault()}};Base_MouseEvents.prototype.handleTouchStart=function(event){var consumed,e,list,t,_i,_len,_results;if(!this.isTargetOkay(event.target)){return}this.hasTouch=true;this.removeLostTouches(event,event.touches,event.changedTouches);consumed=false;list=event.changedTouches||event.touches;_results=[];for(_i=0,_len=list.length;_i<_len;_i++){t=list[_i];e=this.buildEvent(t,t.identifier,event.timeStamp,true);this.downHappened(e);_results.push(consumed|=e.consumed)}return _results};Base_MouseEvents.prototype.handleTouchEnd=function(event){var e,list,t,_i,_len;list=event.changedTouches||event.touches;for(_i=0,_len=list.length;_i<_len;_i++){t=list[_i];e=this.buildEvent(t,t.identifier,event.timeStamp,false);this.upHappened(e)}return this.removeLostTouches(event,event.touches)};Base_MouseEvents.prototype.handleTouchMove=function(event){var consumed,e,list,t,_i,_len;consumed=false;this.removeLostTouches(event,event.touches);list=event.changedTouches||event.touches;for(_i=0,_len=list.length;_i<_len;_i++){t=list[_i];e=this.buildEvent(t,t.identifier,event.timeStamp,true);this.moveHappened(e);consumed|=e.consumed}if(consumed){return event.preventDefault()}};Base_MouseEvents.prototype.removeLostTouches=function(event,touches,freshTouches){var e,k,p,presentTouches,t,_i,_j,_len,_len1,_ref,_results;presentTouches=[];for(_i=0,_len=touches.length;_i<_len;_i++){t=touches[_i];presentTouches[t.identifier]=true}_ref=this.downPointers;for(k in _ref){if(!__hasProp.call(_ref,k)){continue}p=_ref[k];if(!presentTouches[k]){console.log("Removing touch "+k);e=this.rebuildEvent(event,p,false);this.upHappened(e)}}if(freshTouches!=null){_results=[];for(_j=0,_len1=freshTouches.length;_j<_len1;_j++){t=freshTouches[_j];p=this.downPointers[t.identifier];if(p!=null){console.log("Removing fresh touch "+t.identifier);e=this.rebuildEvent(event,p,false);_results.push(this.upHappened(e))}else{_results.push(void 0)}}return _results}};Base_MouseEvents.prototype.rebuildEvent=function(event,obj,pressed){var e;e=new Base_MouseEvent(obj.x,obj.y,event.timeStamp,obj.identifier);e.pageX=obj.pageX;e.pageY=obj.pageY;e.pressed=pressed;e.shiftKey=event.shiftKey;e.altKey=event.altKey;e.ctrlKey=event.ctrlKey;e.touch=this.hasTouch;return e};Base_MouseEvents.prototype.buildEvent=function(event,id,timestamp,pressed){var dx,dy,e,x,y,_ref;_ref=this.getContainerPosition(),dx=_ref[0],dy=_ref[1];x=event.pageX-dx;y=event.pageY-dy;e=new Base_MouseEvent(Math.round(x*this.scaleX),Math.round(y*this.scaleY),timestamp,id);e.target=event.target;e.touch=this.hasTouch;e.pageX=event.pageX;e.pageY=event.pageY;e.shiftKey=event.shiftKey;e.altKey=event.altKey;e.ctrlKey=event.ctrlKey;e.pressed=pressed;return e};Base_MouseEvents.prototype.downHappened=function(e){if(!this.isTargetOkay(e.target)){return}e.pressed=true;if(this.downPointers[e.identifier]!=null){console.log("Unexpected down on already down pointer");return}this.downPointers[e.identifier]=new Base_MousePointer(e,this.settings);this.inPointers[e.identifier]=true;return this.fireEvent(this.EVENT_DOWN,e)};Base_MouseEvents.prototype.upHappened=function(e){var fireClick,p,_this=this;this.cachedContainerPosition=null;if(this.downPointers[e.identifier]==null){return}p=this.downPointers[e.identifier];p.moveTo(e);p.getPosAndSpeed(e,true);delete this.downPointers[e.identifier];if(Math.abs(e.vx)>Math.abs(e.vy)*2){e.swipeSpeed=Math.abs(e.vx);if(e.vx>0){e.swipeLeft=true}if(e.vx<0){e.swipeRight=true}}else{if(Math.abs(e.vy)>Math.abs(e.vx)*2){e.swipeSpeed=Math.abs(e.vy);if(e.vy<0){e.swipeUp=true}if(e.vy>0){e.swipeDown=true}}}this.fireEvent(this.EVENT_UP,e);if(!(p.scrolling||e.isRightMB)){if((this.clickEvent!=null)&&this.clickEvent.time+this.settings.doubleClickTimeout>=e.time&&this.clickEvent.distance(e)<this.settings.doubleClickSensitivity){this.clickEvent=null;return this.fireEvent(this.EVENT_DBLCLICK,e)}else{if(this.settings.noClickOnDoubleClick){this.clickEvent=e;fireClick=function(){if(_this.clickEvent===e){_this.fireEvent(_this.EVENT_CLICK,_this.clickEvent);return _this.clickEvent=null}};return setTimeout(fireClick,this.settings.doubleClickTimeout)}else{return this.fireEvent(this.EVENT_CLICK,e)}}}};Base_MouseEvents.prototype.moveHappened=function(e){var p;p=this.downPointers[e.identifier];e.pressed=p!=null;if(p!=null){if(e.distance(p)>=this.settings.dragSensitivity||p.scrolling){p.scrolling=true;p.moveTo(e);p.getPosAndSpeed(e,false);return this.fireEvent(this.EVENT_DRAG,e)}}else{if(this.clickEvent){if(this.clickEvent.distance(e)>this.settings.doubleClickSensitivity){this.fireEvent(this.EVENT_CLICK,this.clickEvent);return this.clickEvent=null}}else{if(this.isTargetOkay(e.target)){this.inPointers[e.identifier]=true;return this.fireEvent(this.EVENT_MOVE,e)}else{if(this.inPointers.hasOwnProperty(e.identifier)){delete this.inPointers[e.identifier];return this.fireEvent(this.EVENT_LEAVE,e)}}}}};Base_MouseEvents.prototype.wheelHappened=function(e){return this.fireEvent(this.EVENT_WHEEL,e)};Base_MouseEvents.prototype.rclickHappened=function(e){return this.fireEvent(this.EVENT_RCLICK,e)};Base_MouseEvents.prototype.fireEvent=function(name,event){if(this.listeners[name]){return this.listeners[name].call(this,event)}};Base_MouseEvents.prototype.isTargetOkay=function(target){var k,v,_i,_len,_ref;_ref=this.whiteList;for(k=_i=0,_len=_ref.length;_i<_len;k=++_i){v=_ref[k];if((v===target)||Base_Helpers.isParentOf(v,target)){return true}}return false};return Base_MouseEvents})();var Base_Settings;Base_Settings=(function(){Base_Settings.defaults={container:null,width:null,height:null,minHeight:165,maxHeight:2000,minWidth:100,maxWidth:4000,theme:null,assetsUrlBase:"",advanced:{highDpi:{"default":true,safari:false,firefox:true,msie:true,chrome:false},pointer:{noClickOnDoubleClick:true,dragSensitivity:10,doubleClickSensitivity:40,doubleClickTimeout:300,speedAveragingPeriod:100},trackTouches:false,logging:false,style:{messageTextStyle:{fillColor:"#000",font:"15px Arial"},loadingArcStyle:{r:35,lineColor:"#444",lineWidth:2}},maxCanvasWidth:2047,maxCanvasHeight:2047,themeCSSClass:"DVSL-round",assets_applyMethod:"merge",assets:["base.css"],builtinAssets:{"builtin-logo":Base_images_logo},exportProxyURL:"http://developers.dvsl.co/export"},interaction:{resizing:{enabled:true,advanced:{resizerHandleVisibilityTolerance:45,resizerHandleEnableTolerance:10}}},events:{onError:null,onSettingsChange:null},title:{enabled:true,enabledOnExport:true,align:"center",margin:25,style:{font:"20px Arial",fillColor:"#000"},text:""},credits:{enabled:false,enabledOnExport:true,href:"http://dvsl.co",image:"builtin-logo"}};function Base_Settings(scriptName){var k,n,prefix,r,r2,v,_ref;this._imageCache={};this.apply(Base_Settings.defaults);r=new RegExp("((file:///|https?://)[^/]+/.*?)/?"+scriptName+".(min.|)js");r2=new RegExp("((file:///|https?://)[^/]+/.*/src)/?"+scriptName);_ref=document.getElementsByTagName("script");for(k in _ref){v=_ref[k];if(v.src&&(n=v.src.match(r))){if(n[1][n[1].length-1]==="/"){prefix=""}else{prefix="/"}this.assetsUrlBase=n[1]+prefix+"assets/"}if(v.src&&(n=v.src.match(r2))){if(n[1][n[1].length-1]==="/"){prefix=""}else{prefix="/"}this.assetsUrlBase=n[1]+prefix+"assets/"}}}Base_Settings.prototype.apply=function(settings){var changes,theme;if(settings==null){return}changes={};theme=null;if(settings.theme!=null){theme=settings.theme;delete settings.theme}this.applyRec(this,settings,changes,0);if(theme){this.applyRec(this,theme,changes,0);settings.theme=theme}return changes};Base_Settings.prototype.applyRec=function(target,changes,changedProperties,depth){var a,f,key,methodProp,o,oa,oo,origValue,skip,ta,value,vv,_i,_len;if(depth>10){throw"Stack depth greater than 10, seems like recursive settings"}if(target===void 0){console.error(depth,target,changes);throw"Tried to applyRec on undefined"}for(key in changes){value=changes[key];origValue=target[key];if(origValue!==void 0&&value===origValue){continue}a=Base_Helpers.isArray(value);o=Base_Helpers.isObject(value);oa=Base_Helpers.isArray(origValue);oo=Base_Helpers.isObject(origValue);f=Base_Helpers.isFunction(value);skip=false;if(oa&&!a){console.error("Applying settings: Setting expected to be array but got something else: "+key+" = "+value);skip=true}if(value!==null&&oo&&!o&&!f){console.error("Applying settings: Setting expected to be object but got something else: "+key+" = "+value);skip=true}if(skip){continue}if(o){if(!(origValue!=null)){if(a){target[key]=[];changedProperties[key]=[];oo=true}else{target[key]={};changedProperties[key]={};oo=true}}if(value===null||value===void 0){target[key]=value;changedProperties[key]=value}if(o&&!oo){target[key]={};changedProperties[key]={}}if(key==="container"){target[key]=value;changedProperties[key]=value}else{if(a){methodProp=key+"_applyMethod";if(changes[methodProp]==="merge"||target[methodProp]==="merge"){ta=target[key];for(_i=0,_len=value.length;_i<_len;_i++){vv=value[_i];if(!Base_Helpers.arrayContains(ta,vv)){ta.push(vv)}}}else{target[key]=value}changedProperties[key]=value}else{if(!changedProperties.hasOwnProperty(key)){changedProperties[key]={}}this.applyRec(target[key],value,changedProperties[key],depth+1)}}}else{if(value===void 0){delete target[key];changedProperties[key]=value}else{target[key]=value;changedProperties[key]=value}}}return 1};Base_Settings.prototype.getAssetUrl=function(asset){if(this.advanced.builtinAssets.hasOwnProperty(asset)){return this.advanced.builtinAssets[asset]}if(!((this.assetsUrlBase!=null)&&this.assetsUrlBase.length>0)){return asset}if(asset.indexOf("://")!==-1){return asset}if(asset[0]==="/"||asset.indexOf("./")===0){return asset}if(this.assetsUrlBase[this.assetsUrlBase.length-1]!=="/"){return this.assetsUrlBase+"/"+asset}else{return this.assetsUrlBase+asset}};Base_Settings.prototype.getAssetImage=function(asset){var image,url;if(this._imageCache.hasOwnProperty(asset)){return this._imageCache[asset]}url=this.getAssetUrl(asset);if(!url){return null}image=this._imageCache[asset]=new Image();image.src=url;if(image.width>0){return image}else{return null}};return Base_Settings})();var Linearchart_Settings,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Linearchart_Settings=(function(_super){__extends(Linearchart_Settings,_super);Linearchart_Settings.defaults={valueAxis:{"default":{enabled:true,position:"outside",side:"left",size:45,logScale:false,hgrid:true,scaleMinUnit:0,scaleAdjustmentTolerance:0.3,scaleAdjustmentAnimationDelay:200,scaleAdjustmentAnimation:"=",zeroLine:"visible",style:{tick:{lineColor:"#AAAAAA"},valueLabel:{fillColor:"#000000",font:"11px Arial"},labelSpacing:25,baseLineStyle:"rgba(127,127,127,0.5)",baseLineFillStyle:"rgba(127,127,127,0.5)",baseLineWidth:1,baseLineDepth:1,hgrid1:{lineColor:"rgba(127,127,127,0.1)"},hgrid2:{lineColor:"rgba(255,255,255,0.2)"}}},secondary:{enabled:false,position:"outside",side:"right",hgrid:true,size:45,scaleMinUnit:0,logScale:false,scaleAdjustmentTolerance:0.3,scaleAdjustmentAnimationDelay:200,scaleAdjustmentAnimation:"=",zeroLine:"visible",style:{tick:{lineColor:"#AAAAAA"},valueLabel:{fillColor:"#bb8000",font:"11px Arial"},labelSpacing:25,baseLineStyle:"rgba(187,128,0,0.5)",baseLineWidth:1,baseLineDepth:0,hgrid1:{lineColor:"rgba(187,128,0,0.1)"},hgrid2:{lineColor:"rgba(255,235,235,0.2)"}}}},localization:{valueUnits:{K:1000,M:1000000,G:1000000000,T:1000000000000,E:1000000000000000}}};function Linearchart_Settings(name){Linearchart_Settings.__super__.constructor.call(this,name);this.apply(Linearchart_Settings.defaults)}Linearchart_Settings.prototype.getValueAxisList=function(){return[this.valueAxis["default"],this.valueAxis.secondary]};return Linearchart_Settings})(Base_Settings);var Piechart_Icon,Piechart_Label,Piechart_Pie,Piechart_Scene,Piechart_Slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_Label=(function(){function Piechart_Label(){}Piechart_Label.prototype.lines=null;Piechart_Label.prototype.words=null;Piechart_Label.prototype.lineHeight=0;Piechart_Label.prototype.align="left";Piechart_Label.prototype.hwidth=0;Piechart_Label.prototype.hheight=0;Piechart_Label.prototype.x=null;Piechart_Label.prototype.y=null;Piechart_Label.prototype.angle=0;Piechart_Label.prototype.visible=true;Piechart_Label.prototype.userPlaced=false;Piechart_Label.prototype.inside=true;return Piechart_Label})();Piechart_Icon=(function(){function Piechart_Icon(){}Piechart_Icon.prototype.hwidth=0;Piechart_Icon.prototype.hheight=0;Piechart_Icon.prototype.x=null;Piechart_Icon.prototype.y=null;Piechart_Icon.prototype.userPlaced=false;Piechart_Icon.prototype.inside=true;return Piechart_Icon})();Piechart_Slice=(function(){Piechart_Slice.prototype.pie=null;Piechart_Slice.prototype.data=null;Piechart_Slice.prototype.index=0;Piechart_Slice.prototype.value=0;Piechart_Slice.prototype.fraction=0;Piechart_Slice.prototype.cutoutDistance=0;Piechart_Slice.prototype.brightness=1;Piechart_Slice.prototype.expandable=true;Piechart_Slice.prototype.icon=null;Piechart_Slice.prototype.url=null;Piechart_Slice.prototype.userPlaced=false;Piechart_Slice.prototype.inside=true;Piechart_Slice.prototype.x=0;Piechart_Slice.prototype.y=0;Piechart_Slice.prototype.currentCutoutDistance=null;Piechart_Slice.prototype.currentFraction=null;Piechart_Slice.prototype.currentInsideLabel=null;Piechart_Slice.prototype.currentLabel=null;Piechart_Slice.prototype.currentIcon=null;Piechart_Slice.prototype.currentLineColor=null;Piechart_Slice.prototype.currentFillColor=null;Piechart_Slice.prototype.label=null;Piechart_Slice.prototype.insideLabel=null;Piechart_Slice.prototype.lineColor=null;Piechart_Slice.prototype.fillColor=null;Piechart_Slice.prototype.lineWidth=1;function Piechart_Slice(pie,index){this.pie=pie;this.index=index}return Piechart_Slice})();Piechart_Pie=(function(){function Piechart_Pie(){}Piechart_Pie.prototype.id=null;Piechart_Pie.prototype.data=null;Piechart_Pie.prototype.total=1;Piechart_Pie.prototype.parentSlice=null;Piechart_Pie.prototype.othersSlice=null;Piechart_Pie.prototype.previousSlice=null;Piechart_Pie.prototype.slices=[];Piechart_Pie.prototype.allSlices=[];Piechart_Pie.prototype.offset=0;Piechart_Pie.prototype.count=0;Piechart_Pie.prototype.background=false;Piechart_Pie.prototype.activeSliceId=null;Piechart_Pie.prototype.brightness=1;Piechart_Pie.prototype.scrollOffset=0;Piechart_Pie.prototype.columnsInScreen=10;Piechart_Pie.prototype.getActiveSlice=function(){var slice,_i,_len,_ref;if(!this.activeSliceId){return null}_ref=this.slices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];if(slice.data.id===this.activeSliceId){return slice}}return null};Piechart_Pie.prototype.fillColor=null;Piechart_Pie.prototype.x=0;Piechart_Pie.prototype.y=0;Piechart_Pie.prototype.startAngle=0;Piechart_Pie.prototype.endAngle=0;Piechart_Pie.prototype.radius=100;Piechart_Pie.prototype.innerRadius=0;Piechart_Pie.prototype.currentStartAngle=null;Piechart_Pie.prototype.currentEndAngle=null;Piechart_Pie.prototype.currentRadius=0;Piechart_Pie.prototype.currentInnerRadius=0;return Piechart_Pie})();Piechart_Scene=(function(_super){__extends(Piechart_Scene,_super);function Piechart_Scene(){this.settings=null;this.pies=[];this.stack=[];this.selection=[];this.selectionIds=[];this.activeSlice=null;this.activePie=null;this.view=null}Piechart_Scene.prototype.getChartBounds=function(){return{left:0,top:0,right:this.x0+this.width,bottom:this.y0+this.height}};Piechart_Scene.prototype.addPie=function(pie){this.pies.push(pie);this.stack.push(pie);return pie};Piechart_Scene.prototype.removePie=function(pie){var i,slice,_results;pie.removed=true;Base_Helpers.removeFromArray(this.stack,pie);i=0;_results=[];while(i<this.selection.length){slice=this.selection[i];if(slice.pie===pie){_results.push(Base_Helpers.removeFromArray(this.selection,slice))}else{_results.push(i++)}}return _results};Piechart_Scene.prototype.deletePie=function(pie){Base_Helpers.removeFromArray(this.pies,pie);return Base_Helpers.removeFromArray(this.stack,pie)};Piechart_Scene.prototype.length=function(){return this.stack.length};Piechart_Scene.prototype.peek=function(){if(this.stack.length===0){return null}return this.stack[this.stack.length-1]};Piechart_Scene.prototype.push=function(pie,originSlice){var a0,a1,originPie,parent,slice,_i,_j,_len,_len1,_ref,_ref1,_ref2;parent=this.peek();if(parent&&!originSlice){_ref=parent.slices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];if(slice.data.id===pie.id){originSlice=slice;break}}}if(originSlice){pie.parentSlice=originSlice;originPie=originSlice.pie;_ref1=this.getSliceAngles(originSlice),a0=_ref1[0],a1=_ref1[1];pie.currentStartAngle=a0;pie.currentEndAngle=a1;pie.currentRadius=originPie.currentRadius;pie.currentInnerRadius=originPie.currentInnerRadius;parent.activeSliceId=originSlice.id;_ref2=pie.allSlices;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){slice=_ref2[_j];if(originSlice){slice.currentFillColor=originSlice.currentFillColor;slice.currentLineColor=originSlice.currentLineColor}}}else{if(parent){parent.activeSliceId=null}}if(parent){parent.background=true}return this.addPie(pie)};Piechart_Scene.prototype.pop=function(){var pie;if(!(this.stack.length>0)){return}this.removePie(this.peek());pie=this.peek();pie.background=false;return pie.brightness=1};Piechart_Scene.prototype.getParent=function(pie){var p,parent,_i,_len,_ref;parent=null;_ref=this.stack;for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];if(p===pie){return parent}parent=p}return null};Piechart_Scene.prototype.getChild=function(pie){var p,parent,_i,_len,_ref;parent=null;_ref=this.stack;for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];if(parent===pie){return p}parent=p}return null};Piechart_Scene.prototype.updateOnPieChanged=function(pie){var child,parent,slice,_i,_j,_len,_len1,_ref,_ref1,_results;parent=this.getParent(pie);child=this.getChild(pie);if(parent&&!pie.parentSlice){_ref=parent.slices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];if(slice.data.id===pie.id){pie.parentSlice=slice;parent.activeSliceId=slice.data.id;break}}}if(child&&!child.parentSlice){_ref1=pie.slices;_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){slice=_ref1[_j];if(slice.id===child.id){child.parentSlice=slice;pie.activeSliceId=slice.data.id;break}else{_results.push(void 0)}}return _results}};Piechart_Scene.prototype.findPieAt=function(x,y,t){return this.view.findPieAt(x,y,t)};Piechart_Scene.prototype.findSliceAt=function(x,y,t){return this.view.findSliceAt(x,y,t)};Piechart_Scene.prototype.findLabelAt=function(x,y,t){return this.view.findLabelAt(x,y,t)};Piechart_Scene.prototype.getSliceAngles=function(slice){var a0,da,f0,f1,pie,s,_i,_len,_ref;f1=0;pie=slice.pie;_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){s=_ref[_i];f0=f1;f1=f1+s.currentFraction;if(s.id===slice.id){break}}da=pie.currentEndAngle-pie.currentStartAngle;a0=pie.currentStartAngle+da*pie.scrollOffset;return[a0+da*f0,a0+da*f1]};Piechart_Scene.prototype.getSliceTargetAngles=function(slice){var a0,da,f0,f1,pie,s,_i,_len,_ref;f1=0;pie=slice.pie;_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){s=_ref[_i];f0=f1;f1=f1+s.currentFraction;if(s.id===slice.id){break}}da=pie.currentEndAngle-pie.currentStartAngle;a0=pie.currentStartAngle+da*pie.scrollOffset;return[a0+da*f0,a0+da*f1]};return Piechart_Scene})(Base_Scene);var Piechart_Styles;Piechart_Styles=(function(){Piechart_Styles.prototype.animationPriority=1012;function Piechart_Styles(chart){this.chart=chart;this.scene=chart.scene}Piechart_Styles.prototype.doAnimations=function(event){var pie,slice,slice_ind,_i,_len,_ref,_results;if(!(event.changes.settings||event.changes.pie||event.changes.selection)){return}_ref=this.scene.pies;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];this.updatePie(pie);this.computePieColors(pie);_results.push((function(){var _j,_len1,_ref1,_results1;_ref1=pie.allSlices;_results1=[];for(slice_ind=_j=0,_len1=_ref1.length;_j<_len1;slice_ind=++_j){slice=_ref1[slice_ind];_results1.push(this.updateSlice(slice,slice_ind))}return _results1}).call(this))}return _results};Piechart_Styles.prototype.updatePie=function(pie){Base_Helpers.extend(pie,this.scene.settings.pie.style);if(pie.slices.length===0){Base_Helpers.extend(pie,this.scene.settings.pie.noDataStyle)}if(pie.background){Base_Helpers.extend(pie,this.scene.settings.pie.backgroundStyle)}if(this.scene.activePie===pie){Base_Helpers.extend(pie,this.scene.settings.pie.backgroundHoveredStyle)}if(this.scene.settings.pie.styleFunction){return this.scene.settings.pie.styleFunction(pie)}};Piechart_Styles.prototype.computePieColors=function(pie){var c0,c1,col,colorCount,colorMode,colors,cp,i,pos,round,slice,sliceCount,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3,_results,_results1,_results2;colors=pie.sliceColors;colorMode=pie.colorDistribution;sliceCount=0;_ref=pie.slices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];if(!slice.removed){sliceCount+=1}}if(sliceCount===1){pie.slices[0].fillColor=colors[0];return}if(colors.length===1){col=colors[0];colors=[col,Base_Graphics.blendColors(col,"#fff",0.8)]}colorCount=colors.length;if(colorMode==="gradient"){pos=0;_ref1=pie.slices;_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){slice=_ref1[_j];if(slice.removed){continue}c0=colors[(pos*(colorCount-1))|0];c1=colors[(pos*(colorCount-1)+1)|0];cp=pos*(colorCount-1);cp=cp-Math.floor(cp);col=Base_Graphics.blendColors(c0,c1,cp);slice.fillColor=col;_results.push(pos+=1/(sliceCount-0.9))}return _results}else{if(colorMode==="gradientProportional"){pos=0;_ref2=pie.slices;_results1=[];for(_k=0,_len2=_ref2.length;_k<_len2;_k++){slice=_ref2[_k];if(slice.removed){continue}c0=colors[(pos*(colorCount-1))|0];c1=colors[(pos*(colorCount-1)+1)|0];cp=pos*(colorCount-1);cp=cp-Math.floor(cp);col=Base_Graphics.blendColors(c0,c1,cp);slice.fillColor=col;_results1.push(pos+=slice.fraction)}return _results1}else{_ref3=pie.slices;_results2=[];for(i=_l=0,_len3=_ref3.length;_l<_len3;i=++_l){slice=_ref3[i];if(slice.removed){continue}col=colors[i%colorCount];round=(i/colorCount)|0;if(round===1){col=Base_Graphics.deriveColor(col,1.5,1)}else{if(round>=2){col=Base_Graphics.deriveColor(col,0.5,1)}}_results2.push(slice.fillColor=col)}return _results2}}};Piechart_Styles.prototype.updateSlice=function(slice,index){var brightness,pie,targetFillColor,targetLineColor;pie=slice.pie;if(slice.removed){return}Base_Helpers.extend(slice,this.scene.settings.slice.style);if(slice===pie.othersSlice){Base_Helpers.extend(slice,this.scene.settings.slice.othersStyle)}if(slice===pie.previousSlice){Base_Helpers.extend(slice,this.scene.settings.slice.previousStyle)}if(pie.total>0){slice.percent=slice.value/pie.total*100}else{slice.percent=0}if(Base_Helpers.arrayContains(this.scene.selection,slice)){Base_Helpers.extend(slice,this.scene.settings.slice.selectedStyle)}if(this.scene.activeSlice===slice){Base_Helpers.extend(slice,this.scene.settings.slice.hoverStyle)}if(slice.data.style){Base_Helpers.extend(slice,slice.data.style)}if(this.scene.settings.slice.styleFunction){this.scene.settings.slice.styleFunction(slice,slice.data)}else{slice.label=""+(slice.percent.toFixed(1))+"%";if(slice.data.name){slice.label=slice.data.name+" "+slice.label}}if(pie.background){if(pie.activeSliceId!==slice.id){Base_Helpers.extend(slice,this.scene.settings.slice.backgroundStyle);if(index%2===1){slice.fillColor=slice.fillColor2}}else{Base_Helpers.extend(slice,this.scene.settings.slice.backgroundActiveStyle)}}if(slice.fillColor){targetFillColor=slice.fillColor}else{targetFillColor="rgba(255,255,255,0)"}if(slice.lineColor){targetLineColor=slice.lineColor}else{if(slice.lineBrightness){targetLineColor=Base_Graphics.deriveColor(targetFillColor,slice.lineBrightness,1)}else{targetLineColor="rgba(255,255,255,0)"}}brightness=slice.brightness*pie.brightness;if(brightness!==1){targetFillColor=Base_Graphics.deriveColor(targetFillColor,brightness,1);targetLineColor=Base_Graphics.deriveColor(targetLineColor,brightness,1);if(targetFillColor.indexOf("rgba(255,255,255")!==-1&&targetLineColor.indexOf("rgba(255,255,255")!==-1){targetLineColor="rgba(200,200,200,1.000)"}}if(pie.removed&&pie.parentSlice){slice.targetFillColor=pie.parentSlice.targetFillColor;return slice.targetLineColor=pie.parentSlice.targetLineColor}else{slice.targetFillColor=Base_Graphics.normalizeColor(targetFillColor);return slice.targetLineColor=Base_Graphics.normalizeColor(targetLineColor)}};return Piechart_Styles})();var Piechart_Layers;Piechart_Layers=(function(){Piechart_Layers.prototype.scene=null;Piechart_Layers.prototype.container=null;Piechart_Layers.prototype.background=null;Piechart_Layers.prototype.canvas=null;Piechart_Layers.prototype.outerBorder=null;Piechart_Layers.prototype.mouseTrackLayer=null;function Piechart_Layers(chart){this.chart=chart;this.scene=chart.scene;this.container=Base_Helpers.createDom("div","TimeChart-container");this.container.style.position="relative";this.container.style.width="100%";this.container.style.height="100%";this.background=Base_Helpers.createDom("div","TimeChart-background",null,this.container);this.setContainerStyle(this.background);this.canvas=Base_Helpers.createDom("canvas","Piechart-canvas",null,this.container);this.setContainerStyle(this.canvas);this.outerBorder=Base_Helpers.createDom("div","TimeChart-border",null,this.container);this.setContainerStyle(this.outerBorder);this.resizerBar=Base_Helpers.createDom("div","TimeChart-resizer",null,this.container);this.mouseTrackLayer=Base_Helpers.createDom("div",null,null,this.container);this.setContainerStyle(this.mouseTrackLayer);this.updateSettings(this.scene.settings,"init");this.updateSize()}Piechart_Layers.prototype.updateSize=function(){var setHeight,setWidth;setWidth=this.scene.settings.width;setHeight=this.scene.settings.height;if(this.scene.chartWidth>this.scene.settings.container.clientWidth){setWidth=this.scene.chartWidth}if(this.scene.chartHeight>this.scene.settings.container.clientHeight){setHeight=this.scene.chartHeight}if(setWidth){this.container.style.width=""+setWidth+"px"}if(setHeight){this.container.style.height=""+setHeight+"px"}this.resizerBar.style.width=""+this.scene.width+"px";return this.resizerBar.style.left=""+this.scene.x0+"px"};Piechart_Layers.prototype.updateSettings=function(changes){if(Base_Helpers.hasProp(changes,"advanced/themeCSSClass")){if(this.curTheme!=null){Base_Helpers.removeClass(this.container,this.curTheme)}this.curTheme=this.scene.settings.advanced.themeCSSClass;return Base_Helpers.addClass(this.container,this.curTheme)}};Piechart_Layers.prototype.setContainerStyle=function(c){c.style.position="absolute";c.style.left="0px";c.style.right="0px";c.style.top="0px";return c.style.bottom="0px"};return Piechart_Layers})();var Base_ChartElement,Base_ChartEvents,Base_SceneEvent,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Base_SceneEvent=(function(){function Base_SceneEvent(){}Base_SceneEvent.prototype.time=0;Base_SceneEvent.prototype.animating=false;Base_SceneEvent.prototype.changes={};return Base_SceneEvent})();Base_ChartElement=(function(){function Base_ChartElement(){}Base_ChartElement.prototype.animationPriority=0;Base_ChartElement.prototype.remove=function(){return false};Base_ChartElement.prototype.doAnimations=function(sceneEvent){return false};Base_ChartElement.prototype.paintScene=function(sceneEvent){return false};Base_ChartElement.prototype.onSceneChange=function(event){return false};Base_ChartElement.prototype.onClick=function(mouseEvent){return false};Base_ChartElement.prototype.onRClick=function(mouseEvent){return false};Base_ChartElement.prototype.onDoubleClick=function(mouseEvent){return false};Base_ChartElement.prototype.onPointerDown=function(mouseEvent){return false};Base_ChartElement.prototype.onPointerUp=function(mouseEvent){return false};Base_ChartElement.prototype.onPointerDrag=function(mouseEvent){return false};Base_ChartElement.prototype.onPointerMove=function(mouseEvent){return false};Base_ChartElement.prototype.onPointerOut=function(mouseEvent){return false};Base_ChartElement.prototype.onWheel=function(mouseEvent){return false};Base_ChartElement.prototype.onKeyDown=function(keyEvent){return false};Base_ChartElement.prototype.previewWheel=function(mouseEvent){return false};Base_ChartElement.prototype.previewPointerDown=function(mouseEvent){return false};Base_ChartElement.prototype.previewPointerUp=function(mouseEvent){return false};Base_ChartElement.prototype.previewPointerDrag=function(mouseEvent){return false};Base_ChartElement.prototype.previewPointerMove=function(mouseEvent){return false};Base_ChartElement.prototype.previewPointerOut=function(mouseEvent){return false};return Base_ChartElement})();Base_ChartEvents=(function(){Base_ChartEvents.prototype.container=null;Base_ChartEvents.prototype.paintRequested=false;Base_ChartEvents.prototype.mouseEvents=null;function Base_ChartEvents(container,canvas,chart){this.container=container;this.canvas=canvas;this.chart=chart;this._paintScene=__bind(this._paintScene,this);this.kd=__bind(this.kd,this);this.mw=__bind(this.mw,this);this.mdbl=__bind(this.mdbl,this);this.rcl=__bind(this.rcl,this);this.mcl=__bind(this.mcl,this);this.mlve=__bind(this.mlve,this);this.mmve=__bind(this.mmve,this);this.mdrg=__bind(this.mdrg,this);this.mup=__bind(this.mup,this);this.mdwn=__bind(this.mdwn,this);this.scene=this.chart.scene;this.settings=this.chart.settings;this.elements=[];this.elementsReverse=[];this.pointerToElement={};this.sceneChanges={};this.animationOrder=[];this.hooks={};this.mouseEvents=new Base_MouseEvents(this.container,this.settings.advanced.pointer,this.chart,this.whiteList);this.mouseEvents.listen(this.mouseEvents.EVENT_DOWN,this.mdwn);this.mouseEvents.listen(this.mouseEvents.EVENT_UP,this.mup);this.mouseEvents.listen(this.mouseEvents.EVENT_DRAG,this.mdrg);this.mouseEvents.listen(this.mouseEvents.EVENT_MOVE,this.mmve);this.mouseEvents.listen(this.mouseEvents.EVENT_LEAVE,this.mlve);this.mouseEvents.listen(this.mouseEvents.EVENT_CLICK,this.mcl);this.mouseEvents.listen(this.mouseEvents.EVENT_RCLICK,this.rcl);this.mouseEvents.listen(this.mouseEvents.EVENT_DBLCLICK,this.mdbl);this.mouseEvents.listen(this.mouseEvents.EVENT_WHEEL,this.mw);Base_Helpers.listen(this.container,"keydown",this.kd)}Base_ChartEvents.prototype.addWhiteList=function(item){return this.mouseEvents.addWhiteList(item)};Base_ChartEvents.prototype.remove=function(){this.mouseEvents.remove();return Base_Helpers.unlisten(this.container,"keydown",this.kd)};Base_ChartEvents.prototype.setScaling=function(x,y){this.mouseEvents.scaleX=x;return this.mouseEvents.scaleY=y};Base_ChartEvents.prototype.addElement=function(element){element.animationPriority=element.animationPriority||0;this.elements.push(element);this.elementsReverse.splice(0,0,element);this.animationOrder=this.elements.slice(0);this.animationOrder.sort(function(a,b){return b.animationPriority-a.animationPriority});return element};Base_ChartEvents.prototype.removeElement=function(element){Base_Helpers.removeFromArray(this.elements,element);Base_Helpers.removeFromArray(this.animationOrder,element);return Base_Helpers.removeFromArray(this.elementsReverse,element)};Base_ChartEvents.prototype.notifySceneChanges=function(changes){if(!Base_Helpers.hasProperties(changes)){return}Base_Helpers.extendDeep(this.sceneChanges,changes);return this._requestPaint()};Base_ChartEvents.prototype.addHook=function(obj,hook,callback){if(typeof this.hooks[hook]==="undefined"){this.hooks[hook]=[]}return this.hooks[hook].push({obj:obj,callback:callback})};Base_ChartEvents.prototype.hook=function(hook,arg,caller){var v,_i,_len,_ref,_results;this.chart.log("firing hook",{hook:hook,arg:arg,caller:caller});if(this.hooks[hook]){_ref=this.hooks[hook];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){v=_ref[_i];_results.push(v.callback.call(v.obj,hook,arg,caller))}return _results}};Base_ChartEvents.prototype.mdwn=function(event){var element;element=this._notifyMouseEvent(event,"PointerDown");this.pointerToElement[event.identifier]=element;this.notifySceneChanges(event.changes);return this.container.focus()};Base_ChartEvents.prototype.mup=function(event){this._notifyMouseEvent(event,"PointerUp");this.pointerToElement[event.identifier]=null;return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mdrg=function(event){var element;element=this._notifyMouseEvent(event,"PointerDrag");this.pointerToElement[event.identifier]=element;return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mmve=function(event){var element;element=this._notifyMouseEvent(event,"PointerMove");this.pointerToElement[event.identifier]=element;return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mlve=function(event){this._notifyMouseEvent(event,"PointerOut");return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mcl=function(event){this._notifyMouseEvent(event,"Click");return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.rcl=function(event){this._notifyMouseEvent(event,"RightClick");return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mdbl=function(event){this._notifyMouseEvent(event,"DoubleClick");return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.mw=function(event){this._notifyMouseEvent(event,"Wheel");return this.notifySceneChanges(event.changes)};Base_ChartEvents.prototype.kd=function(event){if(!event.keyCode){event.keyCode=event.which}this._notifyKeyEvent(event,"KeyDown");this.notifySceneChanges(event.changes);if(event.consumed){return event.preventDefault()}};Base_ChartEvents.prototype._notifyMouseEvent=function(event,name){var element,firstCursor,funcName,_i,_j,_len,_len1,_ref,_ref1;event.changes={};event.consumed=false;event.cursor=null;funcName="preview"+name;_ref=this.elementsReverse;for(_i=0,_len=_ref.length;_i<_len;_i++){element=_ref[_i];if(element[funcName]!=null){element[funcName].call(element,event)}}funcName="on"+name;element=this.pointerToElement[event.identifier];if(element){if(element[funcName]!=null){element[funcName].call(element,event);if(event.consumed){if(event.cursor){this.container.style.cursor=event.cursor}return element}}}firstCursor=null;_ref1=this.elementsReverse;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){element=_ref1[_j];if(element[funcName]!=null){element[funcName].call(element,event);if(event.consumed){if(event.cursor){this.container.style.cursor=event.cursor}return element}else{if((firstCursor==null)&&(event.cursor!=null)){firstCursor=event.cursor}}}}this.container.style.cursor=firstCursor;return null};Base_ChartEvents.prototype._notifyKeyEvent=function(event,name){var element,funcName,_i,_len,_ref;event.changes={};event.consumed=false;event.cursor=null;funcName="on"+name;_ref=this.elementsReverse;for(_i=0,_len=_ref.length;_i<_len;_i++){element=_ref[_i];if(element[funcName]!=null){element[funcName].call(element,event);if(event.consumed){break}}}return null};Base_ChartEvents.prototype._requestPaint=function(){if(!this.paintRequested){requestAnimationFrame(this._paintScene);return this.paintRequested=true}};Base_ChartEvents.prototype._paintScene=function(){var e,el,event,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;if(this.chart.removed){return}this.paintRequested=false;event=new Base_SceneEvent();event.time=new Date().getTime();event.changes=this.sceneChanges;event["export"]=false;this.sceneChanges={};_ref=this.elementsReverse;for(_i=0,_len=_ref.length;_i<_len;_i++){el=_ref[_i];if(el.onSceneChange!=null){el.onSceneChange(event)}}event.context=this.prepareContext(event);_ref1=this.animationOrder;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){e=_ref1[_j];if(e.doAnimations!=null){e.doAnimations(event)}}_ref2=this.elements;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){e=_ref2[_k];if(e.paintScene!=null){e.paintScene(event)}}if(event.animating){return this._requestPaint()}};Base_ChartEvents.prototype.prepareContext=function(event){var context,heightPx,scene,widthPx;if(event.changes.bounds){scene=this.chart.scene;this.scaleX=Math.min(scene.canvasScaleX,scene.settings.advanced.maxCanvasWidth/scene.chartWidth);this.scaleY=Math.min(scene.canvasScaleY,scene.settings.advanced.maxCanvasHeight/scene.chartHeight);widthPx=Math.round(scene.chartWidth*this.scaleX);heightPx=Math.round(scene.chartHeight*this.scaleY);this.canvas.width=widthPx;this.canvas.height=heightPx;this.canvas.style.width=""+scene.chartWidth+"px";this.canvas.style.height=""+scene.chartHeight+"px"}context=this.canvas.getContext("2d");context.setTransform(1,0,0,1,0,0);context.clearRect(0,0,this.canvas.width,this.canvas.height);context.setTransform(this.scaleX,0,0,this.scaleY,0,0);return context};Base_ChartEvents.prototype.exportGetDimensions=function(dimensions){var bounds,chartHeight,chartWidth,height,pixelsPerMM,scale,width;bounds=this.scene.getChartBounds();chartWidth=bounds.right-bounds.left;chartHeight=bounds.bottom-bounds.top;width=dimensions.width;height=dimensions.height;if(width>0&&height>0){scale=Math.min(width/chartWidth,height/chartHeight)}else{if(width>0){scale=width/chartWidth;height=chartHeight*scale}else{if(height>0){scale=height/chartHeight;width=chartWidth*scale}else{scale=dimensions.scaling>0?dimensions.scaling:1;width=chartWidth*scale*this.scene.canvasScaleX;height=chartHeight*scale*this.scene.canvasScaleY}}}if(dimensions.unit==="mm"){if(dimensions.dpi>0&&dimensions.width>0&&dimensions.height>0){pixelsPerMM=dimensions.dpi/25.4;scale*=pixelsPerMM;width*=pixelsPerMM;height*=pixelsPerMM}else{throw"Invalid export configuration. If unit = mm, dpi, width and height must be supplied"}}return[width,height,scale]};Base_ChartEvents.prototype.exportToImage=function(type,dimensions,transparent){var bounds,canvas,context,e,event,height,mime,mime_map,scale,scaleX,scaleY,width,_i,_len,_ref,_ref1;mime_map={png:"image/png",jpeg:"image/jpeg"};mime=mime_map[type];_ref=this.exportGetDimensions(dimensions),width=_ref[0],height=_ref[1],scale=_ref[2];canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;context=canvas.getContext("2d");if(!transparent){context.fillStyle="#fff";context.fillRect(0,0,canvas.width,canvas.height)}bounds=this.scene.getChartBounds();scaleX=scale*this.scene.canvasScaleX;scaleY=scale*this.scene.canvasScaleY;context.setTransform(scaleX,0,0,scaleY,-bounds.left*scaleX,-bounds.top*scaleY);event=new Base_SceneEvent();event["export"]=true;event.time=new Date().getTime();event.changes={};event.context=context;_ref1=this.elements;for(_i=0,_len=_ref1.length;_i<_len;_i++){e=_ref1[_i];if(e.paintScene!=null){e.paintScene(event)}}return canvas.toDataURL(mime)};return Base_ChartEvents})();var Base_Credits;Base_Credits=(function(){function Base_Credits(scene){this.scene=scene;if(this.scene.settings.credits.enabledOnExport||this.scene.settings.credits.enabled){this.scene.settings.getAssetImage(this.scene.settings.credits.image)}}Base_Credits.prototype.paintScene=function(event){var canvas,context,enabled,h,i,margin,w;enabled=event["export"]?this.scene.settings.credits.enabledOnExport:this.scene.settings.credits.enabled;if(!enabled){return}i=this.scene.settings.getAssetImage(this.scene.settings.credits.image);if(i&&(i.width||event["export"])){margin=3;context=event.context;context.save();context.setTransform(1,0,0,1,0,0);canvas=context.canvas;w=canvas.width;h=canvas.height;context.drawImage(i,w-i.width-margin,h-i.height-margin);return context.restore()}};Base_Credits.prototype.onClick=function(event){};return Base_Credits})();var Base_TouchMarkers,__hasProp={}.hasOwnProperty;Base_TouchMarkers=(function(){Base_TouchMarkers.prototype.animationPriority=0;Base_TouchMarkers.prototype.scene=null;Base_TouchMarkers.prototype.touches={};Base_TouchMarkers.prototype.text=null;Base_TouchMarkers.prototype.fps=0;Base_TouchMarkers.prototype.fpsAveragingPeriod=1000;Base_TouchMarkers.prototype.prevFrame=null;function Base_TouchMarkers(scene){this.scene=scene;this.scene.frameCount=0;this.touches={}}Base_TouchMarkers.prototype.paintScene=function(event){var count,dt,fp,g,k,p,prop,t,_i,_len,_ref,_ref1;this.scene.frameCount+=1;if(this.prevFrame){dt=Math.max(event.time-this.prevFrame,1)/1000;fp=1/dt;prop=Math.min(1,dt*3);this.fps=this.fps*(1-prop)+fp*prop}this.prevFrame=event.time;g=event.context;g.strokeStyle="#000";g.fillStyle="#000";g.beginPath();count=0;_ref=this.touches;for(k in _ref){if(!__hasProp.call(_ref,k)){continue}t=_ref[k];count+=1;g.moveTo(t.dx+10,t.dy);g.arc(t.dx,t.dy,10,0,Math.PI*2);g.moveTo(t.x+30,t.y);g.arc(t.x,t.y,30,0,Math.PI*2);g.moveTo(t.dx,t.dy);_ref1=t.trace;for(_i=0,_len=_ref1.length;_i<_len;_i++){p=_ref1[_i];g.lineTo(p.x,p.y);g.arc(p.x,p.y,3,0,Math.PI*2)}}g.stroke();g.textAlign="start";g.textBaseline="middle";return g.fillText("FPS: "+(Math.round(this.fps))+", touches: "+count,this.scene.x0+this.scene.width/3,20)};Base_TouchMarkers.prototype.previewPointerDown=function(event){var k,t,_ref;_ref=this.touches;for(k in _ref){if(!__hasProp.call(_ref,k)){continue}t=_ref[k];if(t.up){delete this.touches[k]}}this.touches[event.identifier]={dx:event.x,dy:event.y,up:false,trace:[]};return event.changes.pointers=true};Base_TouchMarkers.prototype.previewPointerDrag=function(event){var t;t=this.touches[event.identifier];t.x=event.x;t.y=event.y;return t.trace.push({x:t.x,y:t.y})};Base_TouchMarkers.prototype.previewPointerUp=function(event){this.touches[event.identifier].up=true;return this.previewPointerDrag(event)};return Base_TouchMarkers})();var Base_InfoPopup;Base_InfoPopup=(function(){function Base_InfoPopup(chart){this.chart=chart;this.container=chart.layers.container;this.scene=chart.scene;this.events=chart.events;this.popup=Base_Helpers.createDom("div","DVSL-info-center",null,this.container);this.popup.style.position="absolute";this.popup.style.display="none";this.contents=null;this.popupVisible=false;this.x=null;this.y=null;this.chart.events.addWhiteList(this.popup)}Base_InfoPopup.prototype.hide=function(){if(!this.popupVisible){return false}this.popupVisible=false;this.popup.style.display="none";return true};Base_InfoPopup.prototype.show=function(x,y,contents){if(!this.popupVisible){this.popup.style.display="block";this.popupVisible=true}if(contents){this.popup.innerHTML=contents}return this.updateXY(x,y)};Base_InfoPopup.prototype.updateContents=function(contents){this.popup.innerHTML=contents;return this.updateXY(this.x,this.y)};Base_InfoPopup.prototype.updateXY=function(x,y){var arrowWidth,cl,h,margin,w;this.x=x;this.y=y;margin=12;arrowWidth=10;cl="DVSL-info-center";w=this.popup.offsetWidth;h=this.popup.offsetHeight;if(x+w>this.scene.x0+this.scene.width+arrowWidth){x=x-w-arrowWidth;cl="DVSL-info-left"}else{x=x+arrowWidth;cl="DVSL-info-right"}y=Math.min(Math.max(this.scene.y0+margin,y-h/2),this.scene.y0+this.scene.height-h);this.popupX=x;this.popupY=y;this.popup.style.left=x+"px";this.popup.style.top=y+"px";return Base_Helpers.setClass(this.popup,cl)};return Base_InfoPopup})();var Piechart_LabelLayout,Piechart_PieLayout,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_PieLayout=(function(){function Piechart_PieLayout(chart,view){this.chart=chart;this.view=view;this.scene=chart.scene;this.events=chart.events}Piechart_PieLayout.prototype.placeStack=function(pie){var depth,endAngle,height,i,innerRadius,pieChanges,pieIndex,pies,r,radius,radiusStep,remainingSlices,settings,startAngle,x,y,_i,_j,_len,_ref,_ref1,_ref2;settings=this.scene.settings;depth=settings.pie.depth;pieChanges=false;height=this.scene.height-depth*2;height=Math.max(2,height);x=settings.pie.x;y=settings.pie.y;if(x===null){x=this.scene.x0+this.scene.width/2}else{if(x>=0&&x<=1){x=this.scene.x0+width*x}}if(y===null){y=this.scene.y0+height/2}else{if(y>=0&&y<=1){y=this.scene.y0+this.scene.height*y}}radius=settings.pie.radius;if(!radius){r=Math.min(height/2,this.scene.width/2);r-=settings.pie.outerMargin;if(settings.labels.enabled){r-=settings.labels.connectorLength*0.5}radius=r}innerRadius=settings.pie.innerRadius;if(innerRadius<1){innerRadius=radius*innerRadius}startAngle=settings.pie.startAngle;endAngle=settings.pie.endAngle;if(pie.x!==x||pie.y!==y||pie.radius!==radius||pie.innerRadius!==innerRadius||startAngle!==pie.startAngle||endAngle!==pie.endAngle){pieChanges=true;pie.x=x;pie.y=y;pie.radius=radius;pie.innerRadius=innerRadius;pie.startAngle=startAngle;pie.endAngle=endAngle}pies=this.scene.stack;pieIndex=pies.length-1;if(pieIndex>0){innerRadius=innerRadius-settings.pie.margin;remainingSlices=pieIndex;radiusStep=Math.max(0,Math.min(radius-innerRadius,(innerRadius-settings.pie.innerMargin)/remainingSlices));for(i=_i=_ref=pieIndex-1;_i>=0;i=_i+=-1){radius=innerRadius;innerRadius-=radiusStep;pie=pies[i];y+=depth;pie.x=x;pie.y=y;pie.radius=radius;pie.innerRadius=innerRadius+settings.pie.margin;pie.brightness=0.8-0.8*(remainingSlices-i-1)/remainingSlices;pie.startAngle=settings.pie.startAngle;pie.endAngle=settings.pie.endAngle}}_ref1=this.scene.pies;for(_j=0,_len=_ref1.length;_j<_len;_j++){pie=_ref1[_j];if(pie.removed&&pie.parentSlice){_ref2=this.scene.getSliceTargetAngles(pie.parentSlice),pie.startAngle=_ref2[0],pie.endAngle=_ref2[1]}}return pieChanges};Piechart_PieLayout.prototype.placeLabels=function(pie,g){var a0,a1,am,astart,bottom,config,da,endAngle,fsum,icon,iconMinSize,iconSize,insideLablelProp,label,labelLayout,left,leftOutsideLabels,margin,r0,r1,right,rightOutsideLabels,slice,sliceAngle0,sliceAngle1,startAngle,text,top,x,y,_i,_len,_ref,_ref1;config=this.scene.settings.labels;if(!config.enabled){return}iconMinSize=this.scene.settings.advanced.iconMinSize;margin=this.scene.settings.slice.margin;x=pie.x;y=pie.y;r0=pie.currentInnerRadius;r1=pie.currentRadius;fsum=0;fsum=0;startAngle=pie.currentStartAngle;endAngle=pie.currentEndAngle;da=endAngle-startAngle;astart=pie.currentStartAngle+pie.scrollOffset*da;left=this.scene.x0-x;right=left+this.scene.width;top=this.scene.y0-y;bottom=top+this.scene.height;labelLayout=new Piechart_LabelLayout(g,r1,left,right,top,bottom,config);leftOutsideLabels=[];rightOutsideLabels=[];sliceAngle1=astart;_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];sliceAngle0=sliceAngle1;fsum=Math.min(1,fsum+slice.currentFraction);sliceAngle1=astart+fsum*da;a0=Math.max(sliceAngle0,startAngle);a1=Math.min(sliceAngle1,endAngle);if(a0>=endAngle||a1<=startAngle){slice.currentLabel=null;slice.currentInsideLabel=null;slice.currentIcon=null;continue}am=(a0+a1)/2;if(!slice.removed&&!pie.background){if(slice.insideLabel){text=slice.insideLabel;if(!slice.currentInsideLabel){label=slice.currentInsideLabel=new Piechart_Label()}else{label=slice.currentInsideLabel}if(slice.currentInsideLabel.text!==text){label.text=text;label.words=text.split(" ");label.align="center"}insideLablelProp=labelLayout.fitLabelInSlice(label,r0,r1,a0,a1);label.shouldBeVisible=config.insideLabel==="always"||insideLablelProp>=config.insideLabelVisibilityFraction;if(!label.shouldBeVisible&&slice!==this.scene.activeSlice&&!label.userPlaced){label.visible=false}}if(slice.label){text=slice.label;if(config.insideLabel==="append"&&slice.insideLabel&&!slice.currentInsideLabel.userPlaced&&!slice.currentInsideLabel.shouldBeVisible){x=Math.cos(am);if(x>0){text=slice.insideLabel+", "+text}else{text=text+", "+slice.insideLabel}}label=null;if(!slice.currentLabel){label=slice.currentLabel=new Piechart_Label()}else{label=slice.currentLabel}if(slice.currentLabel.text!==text){label.text=text;label.words=text.split(" ")}if(!label.userPlaced){labelLayout.placeOutsideLabelInitial(label,am)}if(label.x>0){label.align="left";rightOutsideLabels.push(label)}else{label.align="right";leftOutsideLabels.push(label)}}else{slice.currentLabel=null}}else{slice.currentLabel=null;slice.currentInsideLabel=null}icon=null;if(slice.icon&&(!pie.background||slice.id===pie.activeSliceId)){_ref1=labelLayout.fitBoxInSlice(1,1,r0,r1,a0,a1),x=_ref1[0],y=_ref1[1],iconSize=_ref1[2];iconSize-=margin;if(iconSize*2>=iconMinSize){icon=new Piechart_Icon();icon.x=x;icon.y=y;icon.hwidth=iconSize;icon.hheight=iconSize;icon.inside=true}else{}}slice.currentIcon=icon}labelLayout.computeOutsideLabelLocations(rightOutsideLabels,0);return labelLayout.computeOutsideLabelLocations(leftOutsideLabels,1)};return Piechart_PieLayout})();Piechart_LabelLayout=(function(_super){__extends(Piechart_LabelLayout,_super);function Piechart_LabelLayout(g,r1,left,right,top,bottom,config){this.left=left;this.right=right;this.top=top;this.bottom=bottom;Piechart_LabelLayout.__super__.constructor.call(this,g,config);this.rr=r1+this.connectorLength}Piechart_LabelLayout.prototype.placeOutsideLabelInitial=function(label,angle){var shortenProp,x,y;x=this.rr*Math.cos(angle);y=this.rr*Math.sin(angle);shortenProp=1;if(y<this.top){shortenProp=Math.min(shortenProp,this.top/y)}if(y>this.bottom){shortenProp=Math.min(shortenProp,this.bottom/y)}if(x<this.left){shortenProp=Math.min(shortenProp,this.left/x)}if(x>this.right){shortenProp=Math.min(shortenProp,this.right/x)}label.x=x*shortenProp;return label.y=y*shortenProp};Piechart_LabelLayout.prototype.computeOutsideLabelLocations=function(labels,direction){var aligned,bottom,h,hasMultiline,height,label,labelBottom,labelSpacing,labelTop,maxHeight,prop,sortDirection,top,visibleLabels,worstProp,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_results;if(direction==null){direction=1}bottom=this.bottom-this.margin;top=this.top+this.margin;labelSpacing=this.interLabelSpacing;sortDirection=0.5-direction;labels.sort(function(a,b){return(a.y-b.y)*sortDirection});for(_i=0,_len=labels.length;_i<_len;_i++){label=labels[_i];label.originX=label.x}_ref=[true,false];_results=[];for(_j=0,_len1=_ref.length;_j<_len1;_j++){aligned=_ref[_j];for(_k=0,_len2=labels.length;_k<_len2;_k++){label=labels[_k];label.prop=this.fitLabelOutside(label,aligned)}maxHeight=bottom-top;visibleLabels=[];height=0;for(_l=0,_len3=labels.length;_l<_len3;_l++){label=labels[_l];if(label.visible){h=label.hheight*2+labelSpacing;if(height+h<maxHeight){visibleLabels.push(label);height+=h}else{label.visible=label.userPlaced}}}worstProp=100;hasMultiline=false;labelBottom=bottom;labelTop=top;if(direction===1){labelTop+=height}else{labelBottom-=height}for(_m=0,_len4=visibleLabels.length;_m<_len4;_m++){label=visibleLabels[_m];if(direction===1){labelTop-=label.hheight*2+labelSpacing}else{labelBottom+=label.hheight*2+labelSpacing}if(!label.userPlaced&&(label.y+label.hheight>labelBottom||label.y-label.hheight<labelTop)){label.y=Math.min(Math.max(label.y,labelTop+label.hheight),labelBottom-label.hheight);prop=this.fitLabelOutside(label,aligned);worstProp=Math.min(prop,worstProp);hasMultiline||(hasMultiline=label.lines&&label.lines.length>1)}else{worstProp=Math.min(worstProp,label.prop)}if(direction===1){labelBottom=label.y-label.hheight-labelSpacing}else{labelTop=label.y+label.hheight+labelSpacing}}if(worstProp>=1||!hasMultiline){break}else{_results.push(void 0)}}return _results};Piechart_LabelLayout.prototype.fitLabelOutside=function(label,aligned){var locationFunc,_this=this;if(aligned==null){aligned=false}locationFunc=function(hheight){if(label.userPlaced){return _this.getOutsideMaxWidth(label.x,label.y,hheight,false);return[label.x,label.y,1,0,width]}else{return _this.placeOutsideMaxWidth(label.originX,label.y,hheight,aligned)}};return this.fitLabelInRect(label,label.align,locationFunc)};Piechart_LabelLayout.prototype.fitLabelInSlice=function(label,r0,r1,a0,a1){var sliceLocationFunc,_this=this;sliceLocationFunc=function(hheight){var width,xx,yy,_ref,_ref1;if(label.userPlaced){_ref=_this.getInsideMaxWidth(label.x,label.y,hheight,r0,r1,a0,a1,true),xx=_ref[0],yy=_ref[1],width=_ref[2];return[label.x,label.y,1,0,width]}else{_ref1=_this.placeInsideMaxWidth(hheight,r0,r1,a0,a1),xx=_ref1[0],yy=_ref1[1],width=_ref1[2];return[xx,yy,1,0,width]}};return this.fitLabelInRect(label,"center",sliceLocationFunc)};Piechart_LabelLayout.prototype.placeOutsideMaxWidth=function(x,y,hheight,aligned){var diff,distanceFromCenter,lbottom,lleft,lright,ltop,radius;radius=this.rr;ltop=y-hheight/2;lbottom=ltop+hheight;if(ltop<this.top){diff=this.top-ltop;ltop+=diff;lbottom+=diff}if(lbottom>this.bottom){diff=this.bottom-lbottom;ltop+=diff;lbottom+=diff}lleft=this.left;lright=this.right;if(aligned){distanceFromCenter=radius}else{if(ltop>radius||lbottom<-radius){distanceFromCenter=0}else{if(ltop>0){distanceFromCenter=Math.sqrt(radius*radius-ltop*ltop)}else{if(lbottom<0){distanceFromCenter=Math.sqrt(radius*radius-lbottom*lbottom)}else{distanceFromCenter=radius}}}}distanceFromCenter+=this.connectorLength;if(x>0){lleft=Math.max(distanceFromCenter,x)}else{lright=Math.min(x,-distanceFromCenter)}return[(lleft+lright)/2,(ltop+lbottom)/2,1,0,lright-lleft]};Piechart_LabelLayout.prototype.getOutsideMaxWidth=function(x,y,hheight,aligned){var dist,distanceFromCenter,lbottom,lleft,lright,ltop,radius;ltop=y-hheight/2;lbottom=ltop+hheight;lleft=this.left;lright=this.right;radius=this.rr;if(aligned){distanceFromCenter=radius}else{if(ltop>radius||lbottom<-radius){distanceFromCenter=0}else{if(ltop>0){distanceFromCenter=Math.sqrt(radius*radius-ltop*ltop)}else{if(lbottom<0){distanceFromCenter=Math.sqrt(radius*radius-lbottom*lbottom)}else{distanceFromCenter=radius}}}}distanceFromCenter+=this.connectorLength;if(x>0){lleft=distanceFromCenter}else{lright=-distanceFromCenter}dist=Math.min(Math.abs(x-lleft),Math.abs(x-lright));return[x,y,1,0,dist*2]};Piechart_LabelLayout.prototype.placeInsideMaxWidth=function(hheight,r0,r1,a0,a1){var am,cosa,rm,rprop,sina,x,y;rprop=0.5+(r1-r0)/r1/4;rm=r0+(r1-r0)*rprop;am=(a0+a1)/2;cosa=Math.cos(am);sina=Math.sin(am);x=rm*cosa;y=rm*sina;return this.getInsideMaxWidth(x,y,hheight,r0,r1,a0,a1,false)};Piechart_LabelLayout.prototype.getInsideMaxWidth=function(x,y,hheight,r0,r1,a0,a1,userPlaced){var down,l,l0,l1,r,up,width;down=this.rayIntersectsSlice(x,y,0,1,r0,r1,a0,a1);up=this.rayIntersectsSlice(x,y,0,-1,r0,r1,a0,a1);if(down<hheight||up<hheight){return[x,y,1,0,0.00001]}l0=this.rayIntersectsSlice(x,y-hheight,-1,0,r0,r1,a0,a1);l1=this.rayIntersectsSlice(x,y+hheight,-1,0,r0,r1,a0,a1);r0=this.rayIntersectsSlice(x,y-hheight,1,0,r0,r1,a0,a1);r1=this.rayIntersectsSlice(x,y+hheight,1,0,r0,r1,a0,a1);l=Math.min(l0,l1);r=Math.min(r0,r1);if(userPlaced){width=Math.min(l,r)*2}else{width=l+r;x=x-l+width/2}return[x,y,width]};Piechart_LabelLayout.prototype.fitBoxInSlice=function(hwidth,hheight,r0,r1,a0,a1){var am,cosa,d0,d1,d2,d3,dx,dy,prop,rm,rprop,sina,x,y;rprop=0.5+(r1-r0)/r1/4;rm=r0+(r1-r0)*rprop;am=(a0+a1)/2;cosa=Math.cos(am);sina=Math.sin(am);x=rm*cosa;y=rm*sina;dx=hwidth;dy=hheight;d0=this.rayIntersectsSlice(x,y,dx,dy,r0,r1,a0,a1);d1=this.rayIntersectsSlice(x,y,-dx,dy,r0,r1,a0,a1);d2=this.rayIntersectsSlice(x,y,-dx,-dy,r0,r1,a0,a1);d3=this.rayIntersectsSlice(x,y,dx,-dy,r0,r1,a0,a1);prop=Math.min(d0,d1,d2,d3);return[x,y,prop]};Piechart_LabelLayout.prototype.rayIntersectsSlice=function(x0,y0,dx,dy,r0,r1,a0,a1){var cosa,d,sina;d=Base_Geometry.rayIntersectsCircle(x0,y0,dx,dy,r0);d=Math.min(d,Base_Geometry.rayIntersectsCircle(x0,y0,dx,dy,r1));cosa=Math.cos(a0);sina=Math.sin(a0);d=Math.min(d,Base_Geometry.rayIntersectsLine(x0,y0,dx,dy,r0*cosa,r0*sina,r1*cosa,r1*sina));cosa=Math.cos(a1);sina=Math.sin(a1);d=Math.min(d,Base_Geometry.rayIntersectsLine(x0,y0,dx,dy,r0*cosa,r0*sina,r1*cosa,r1*sina));return d};return Piechart_LabelLayout})(Piechart_LabelLayoutBase);var Piechart_PieRenderer;Piechart_PieRenderer=(function(){function Piechart_PieRenderer(chart){this.chart=chart;this.settings=chart.settings;this.scene=chart.scene;this.events=chart.events}Piechart_PieRenderer.prototype.onSceneChange=function(event){if(event.changes.settings){return this.buildSeries()}};Piechart_PieRenderer.prototype.buildSeries=function(){var c,e,theme;theme=this.settings.pie.theme;c="PieChart_Renderer_"+theme.charAt(0).toUpperCase()+theme.slice(1);try{return eval("this.renderer = new "+c+"(this);")}catch(_error){e=_error;throw"Renderer "+theme+" is not available: "+e}};Piechart_PieRenderer.prototype.doAnimations=function(event){};Piechart_PieRenderer.prototype.paintScene=function(event){var g,innerPies,pie,pieindex,_i,_len,_ref;g=event.context;innerPies=event["export"]?this.settings.pie.showInnerPiesExport:this.settings.pie.showInnerPies;_ref=this.scene.pies;for(pieindex=_i=0,_len=_ref.length;_i<_len;pieindex=++_i){pie=_ref[pieindex];if(innerPies||!pie.background){this.paintPie(g,pie)}}if(Base_Helpers.arrayContains(this.scene.pies,this.scene.activePie)){this.paintBackArrow(event)}};Piechart_PieRenderer.prototype.paintBackArrow=function(event){var depth,g,heightProportion,ihh,ihw,img,invsq2,phs,topPie,widthProportion,x,y,zoom;if(!(!event["export"]&&this.scene.pies.length>1)){return}img=this.scene.settings.getAssetImage(this.scene.settings.advanced.backImage);if(!(img&&img.width)){return}topPie=this.scene.pies[this.scene.pies.length-1];invsq2=0.707106781186547;x=topPie.x;y=topPie.y;depth=this.settings.pie.depth;y+=(this.scene.pies.length-1)*depth;ihw=img.width/2;ihh=img.height/2;phs=topPie.innerRadius*invsq2;widthProportion=Math.min(ihw,Math.max(phs,ihw/2))/ihw;heightProportion=Math.min(ihh,Math.max(phs,ihh/2))/ihh;zoom=Math.min(widthProportion,heightProportion);g=event.context;g.globalAlpha=0.5;g.drawImage(img,x-ihw*zoom,y-ihh*zoom,ihw*2*zoom,ihh*2*zoom);return g.globalAlpha=1};Piechart_PieRenderer.prototype.paintPie=function(g,pie){var a0,a1,aR1,am,angle,angle1,angleDiff,end,h,icon,img,innerAngleLeft,innerAngleRight,m,outerAngleLeft,outerAngleRight,pxToAngleR0,pxToAngleR1,r0,r1,rl,slice,sliceAngle,slicesToPaint,spacing,spacingAngleR0,spacingAngleR1,sr0,sr1,start,w,x,xx,y,yy,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_results;spacing=this.settings.slice.margin;x=pie.x;y=pie.y;r0=Math.max(pie.currentInnerRadius,spacing/2);r1=pie.currentRadius;start=pie.currentStartAngle;end=pie.currentEndAngle;angleDiff=end-start;angle1=start+pie.scrollOffset*angleDiff;if(!(r1>0&&angleDiff>0)){return}pxToAngleR0=r0>0?1/r0:0;pxToAngleR1=1/r1;spacingAngleR0=spacing/2*pxToAngleR0;spacingAngleR1=spacing/2*pxToAngleR1;slicesToPaint=[];_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];sliceAngle=slice.currentFraction*angleDiff;if(!(sliceAngle>0)){continue}angle=angle1;angle1+=sliceAngle;sr0=r0+slice.currentCutoutDistance;sr1=r1+slice.currentCutoutDistance;if(sliceAngle<=spacingAngleR1*4){m=(angle+angle1)/2;aR1=sliceAngle/4;outerAngleLeft=m-aR1;outerAngleRight=m+aR1}else{outerAngleLeft=angle+spacingAngleR1;outerAngleRight=angle1-spacingAngleR1}innerAngleLeft=angle+spacingAngleR0;innerAngleRight=angle1-spacingAngleR0;if(innerAngleLeft>innerAngleRight){innerAngleLeft=innerAngleRight=(innerAngleLeft+innerAngleRight)/2}if(outerAngleRight<start||outerAngleLeft>end){continue}outerAngleLeft=Math.max(outerAngleLeft,start);outerAngleRight=Math.min(outerAngleRight,end);innerAngleLeft=Math.max(innerAngleLeft,start);innerAngleRight=Math.min(innerAngleRight,end);if(innerAngleLeft>innerAngleRight){innerAngleLeft=innerAngleRight=(innerAngleLeft+innerAngleRight)/2}slice.renderParams=[sr0,sr1,outerAngleLeft,outerAngleRight,innerAngleLeft,innerAngleRight];slice.fillColor_b=slice.fillColor;slice.lineColor_b=slice.lineColor;slice.fillColor=slice.currentFillColor;slice.lineColor=slice.currentLineColor;slicesToPaint.push(slice)}x=pie.x;y=pie.y;this.renderer.paintPie(g,x,y,r0,r1,pie.currentStartAngle,pie.currentEndAngle,pie);this.renderer.paintSlices(g,x,y,slicesToPaint);for(_j=0,_len1=slicesToPaint.length;_j<_len1;_j++){slice=slicesToPaint[_j];slice.fillColor=slice.fillColor_b;slice.lineColor=slice.lineColor_b}if(!pie.removed){Base_Graphics.clearShadow(g);_ref1=pie.allSlices;for(_k=0,_len2=_ref1.length;_k<_len2;_k++){slice=_ref1[_k];if(slice.currentIcon&&(img=this.scene.settings.getAssetImage(slice.icon))){icon=slice.currentIcon;xx=x+icon.x;yy=y+icon.y;w=Math.min(img.width/2,icon.hwidth);h=Math.min(img.height/2,icon.hheight);g.drawImage(img,xx-w,yy-h,w*2,h*2)}}angle1=start+pie.scrollOffset*angleDiff;_ref2=pie.allSlices;_results=[];for(_l=0,_len3=_ref2.length;_l<_len3;_l++){slice=_ref2[_l];sliceAngle=slice.currentFraction*angleDiff;angle=angle1;angle1=angle+sliceAngle;a0=Math.max(angle,start);a1=Math.min(angle1,end);am=(a0+a1)/2;rl=r1+slice.currentCutoutDistance;if(slice.currentInsideLabel&&slice.currentInsideLabel.visible){this.paintLabel(g,x,y,rl,am,slice.currentInsideLabel,this.settings.labels.insideTextStyle)}if(slice.currentLabel&&slice.currentLabel.visible){_results.push(this.paintLabel(g,x,y,rl,am,slice.currentLabel,this.settings.labels.textStyle))}else{_results.push(void 0)}}return _results}};Piechart_PieRenderer.prototype.paintLabel=function(g,x,y,r1,angleM,label,style){var a,bottom,cosa,da,hh,labelConfig,line,r15,r2,sina,t,top,touchAngle,ww,x0,x1,x1a,x2,xc,xx,y0,y1,y1a,y2,yc,yy,_i,_len,_ref;top=this.scene.y0;bottom=top+this.scene.height;labelConfig=this.settings.labels;xx=label.x;yy=label.y;ww=label.hwidth;hh=label.hheight;r2=r1+labelConfig.connectorLength;if(labelConfig.connectors&&xx*xx+yy*yy>r1*r1){sina=Math.sin(angleM);cosa=Math.cos(angleM);g.beginPath();x0=x+r1*cosa;y0=y+r1*sina;g.moveTo(x0,y0);x1=x+r2*cosa;y1=y+r2*sina;y1=Math.min(Math.max(y1,top),bottom);if(xx+ww<0){x2=x+xx+ww;y2=y+yy}else{if(xx+ww>=0){x2=x+xx-ww;y2=y+yy}else{x2=x+xx;if(yy>0){y2=y+yy-hh}else{y2=y+yy+hh}}}r15=(r1+r2)/2;t=Base_Geometry.rayIntersectsCircle(x2-x,y2-y,x0-x2,y0-y2,r1);a=Base_Geometry.lineTouchingCircle(x2-x,y2-y,x1-x,y1-y,r2);if(t<0.9&&a){xc=a[0],yc=a[1];touchAngle=Math.atan2(yc,xc);while(touchAngle-angleM>Math.PI){touchAngle-=Math.PI*2}while(touchAngle-angleM<-Math.PI){touchAngle+=Math.PI*2}da=touchAngle-angleM;xc+=x;yc+=y;x1=x+r15*cosa;y1=y+r15*sina;y1=Math.min(Math.max(y1,top),bottom);x1a=x+r15*Math.cos(angleM+da*0.2);y1a=y+r15*Math.sin(angleM+da*0.2);y1a=Math.min(Math.max(y1a,top),bottom);g.quadraticCurveTo(x1,y1,x1a,y1a);Base_Graphics.arcBetweenTwoPoints(g,x,y,r15,x1a,y1a,x+r2*Math.cos(touchAngle),y+r2*Math.sin(touchAngle));g.lineTo(x2,y2)}else{g.quadraticCurveTo(x1,y1,x2,y2)}Base_Graphics.stroke(g,labelConfig.connectorStyle)}x0=x+label.x;y0=y+label.y-label.hheight;g.textBaseline="top";if(label.align==="left"){x0-=label.hwidth;g.textAlign="start"}else{if(label.align==="right"){x0+=label.hwidth;g.textAlign="end"}else{g.textAlign="center"}}Base_Graphics.textStyle(g,style);_ref=label.lines;for(_i=0,_len=_ref.length;_i<_len;_i++){line=_ref[_i];g.fillText(line,x0,y0);y0+=label.lineHeight}return Base_Graphics.clearShadow(g)};return Piechart_PieRenderer})();var Piechart_PieBuilder;Piechart_PieBuilder=(function(){function Piechart_PieBuilder(chart){this.chart=chart;this.scene=chart.scene;this.loading=false}Piechart_PieBuilder.prototype.updatePie=function(pie){var data,newSlices,numberOfSlices,others,previous,_ref;data=this.getPieData(pie);numberOfSlices=this.getForwardCount(data,pie.offset);if(this.loading){this.scene.data.requestMorePieData(pie.id,pie.offset)}pie.data=data;_ref=this.buildSlices(pie,pie.offset,numberOfSlices),newSlices=_ref[0],others=_ref[1],previous=_ref[2];if(newSlices.length>0||!this.loading){this.applyNewSlices(pie,newSlices,others,previous)}return this.loading};Piechart_PieBuilder.prototype.scrollForward=function(pie,newOffset){var data,newOthers,newPrevious,newSlices,numberOfSlices,_ref;data=this.getPieData(pie);if(newOffset==null){numberOfSlices=this.getForwardCount(data,pie.offset);newOffset=pie.offset+numberOfSlices}numberOfSlices=this.getForwardCount(data,newOffset);if(this.loading){this.scene.data.requestMorePieData(pie.id,pie.offset)}pie.data=data;_ref=this.buildSlices(pie,newOffset,numberOfSlices),newSlices=_ref[0],newOthers=_ref[1],newPrevious=_ref[2];if(pie.othersSlice){this.fitSlicesInOrigin(pie.othersSlice,newSlices,newOthers);if(!newOthers){newOthers=pie.othersSlice;newOthers.fraction=0;newOthers.currentFraction=0;newOthers.removed=true}}pie.offset=newOffset;this.applyNewSlices(pie,newSlices,newOthers,newPrevious);return this.loading};Piechart_PieBuilder.prototype.scrollBackward=function(pie,newOffset){var data,newOthers,newPrevious,newSlices,numberOfSlices,_ref;data=this.getPieData(pie);if(newOffset==null){newOffset=this.getBackOffset(data,pie.offset)}numberOfSlices=this.getForwardCount(data,newOffset);if(this.loading){this.scene.data.requestMorePieData(pie.id,pie.offset)}pie.data=data;_ref=this.buildSlices(pie,newOffset,numberOfSlices),newSlices=_ref[0],newOthers=_ref[1],newPrevious=_ref[2];if(pie.previousSlice){this.fitSlicesInOrigin(pie.previousSlice,newSlices,newPrevious);if(!newPrevious){newPrevious=pie.previousSlice;newPrevious.fraction=0;newPrevious.currentFraction=0;newPrevious.removed=true}}pie.offset=newOffset;this.applyNewSlices(pie,newSlices,newOthers,newPrevious);return this.loading};Piechart_PieBuilder.prototype.fitSlicesInOrigin=function(origin,slices,extraSlice){var compression,originFraction,slice,targetFraction,_i,_j,_len,_len1;originFraction=Math.max(0.000001,origin.currentFraction);targetFraction=0;for(_i=0,_len=slices.length;_i<_len;_i++){slice=slices[_i];targetFraction+=slice.fraction}if(extraSlice){targetFraction+=extraSlice.fraction}compression=originFraction/targetFraction;for(_j=0,_len1=slices.length;_j<_len1;_j++){slice=slices[_j];slice.currentFraction=slice.fraction*compression;slice.currentFillColor=origin.currentFillColor;slice.currentLineColor=origin.currentLineColor}if(extraSlice){extraSlice.currentFraction=extraSlice.fraction*compression;extraSlice.currentFillColor=origin.currentFillColor;extraSlice.currentLineColor=origin.currentLineColor}};Piechart_PieBuilder.prototype.getForwardCount=function(data,offset){var count,i,maxOthers,maxSlices,minSlice,othersRealFraction,othersS,othersSum,othersVisibleFraction,sliceFraction,slicesSum,val,_i,_ref;if(!data||(data.values.length<=offset&&(!data.done))){this.loading=true;return 0}othersS=this.scene.settings.interaction.others;if(!othersS.enabled){this.loading=!data.done;return Math.max(data.values.length-offset,0)}othersSum=data.afterFraction;for(i=_i=offset,_ref=data.values.length-1;_i<=_ref;i=_i+=1){othersSum+=data.values[i].fraction}minSlice=othersS.minSliceFraction;maxOthers=othersS.maxOthersFraction;maxSlices=othersS.maxSlicesVisible;count=0;slicesSum=0;while(count+offset<data.values.length){count++;val=data.values[offset+count-1].fraction;slicesSum+=val;othersSum-=val;othersRealFraction=othersSum/(othersSum+slicesSum);othersVisibleFraction=Math.min(othersRealFraction,maxOthers);sliceFraction=val/slicesSum*(1-othersVisibleFraction);if(count>maxSlices||sliceFraction<minSlice){if(count+offset!==data.values.length){count--}break}}this.loading=!data.done&&offset+maxSlices>data.values.length;return count};Piechart_PieBuilder.prototype.getBackOffset=function(data,othersOffset){var count,i,maxOthers,maxSlices,minSlice,othersFraction,othersS,othersSum,pos,slicesSum,smallestSliceFraction,smallestValue,val,_i,_ref;othersS=this.scene.settings.interaction.others;if(!data){this.loading=true;return 0}if(!othersS.enabled){this.loading=!data.done;return 0}othersSum=data.afterFraction;for(i=_i=othersOffset,_ref=data.values.length-1;_i<=_ref;i=_i+=1){othersSum+=data.values[i].fraction}minSlice=othersS.minSliceFraction;maxOthers=othersS.maxOthersFraction;maxSlices=othersS.maxSlicesVisible;pos=othersOffset;smallestValue=data.values[othersOffset-1].fraction;slicesSum=0;while(pos>0){pos--;count=othersOffset-pos;val=data.values[pos].fraction;slicesSum+=val;othersFraction=Math.min(othersSum/(othersSum+slicesSum),maxOthers);smallestSliceFraction=smallestValue/slicesSum*(1-othersFraction);if(count>maxSlices||smallestSliceFraction<minSlice){if(pos>0){pos++}break}}return pos};Piechart_PieBuilder.prototype.buildSlices=function(pie,offset,count){var data,fractionCompress,i,othersFraction,othersSettings,othersSlice,othersVal,prevValue,previousFraction,previousSlice,s,slice,slices,slicesFraction,_i,_j,_k,_l,_len,_ref,_ref1,_ref2,_ref3;data=pie.data;if(!data||(data.values.length<offset&&!data.ready)){this.loading=true;return[[],null,null]}slicesFraction=0;slices=[];for(i=_i=offset,_ref=Math.min(offset+count,data.values.length)-1;_i<=_ref;i=_i+=1){s=new Piechart_Slice(pie,i);s.data=data.values[i];s.id=s.data.id;slicesFraction+=s.data.fraction;slices.push(s)}othersSettings=this.scene.settings.interaction.others;othersFraction=data.afterFraction;othersVal=data.afterSum;for(i=_j=_ref1=offset+count,_ref2=data.values.length-1;_j<=_ref2;i=_j+=1){othersVal+=data.values[i].value;othersFraction+=data.values[i].fraction}if(othersFraction>0){othersSlice=new Piechart_Slice(pie,Infinity);othersSlice.data={value:othersVal,fraction:othersFraction,name:this.scene.settings.localization.othersLabel}}else{othersSlice=null}previousSlice=null;previousFraction=0;if(offset>0){prevValue=0;for(i=_k=0,_ref3=Math.min(offset,data.values.length)-1;_k<=_ref3;i=_k+=1){prevValue+=Math.abs(data.values[i].value)}previousSlice=new Piechart_Slice(pie,-1);previousFraction=othersSettings.navigationFraction;previousSlice.data={value:prevValue,name:this.scene.settings.localization.previousLabel};previousSlice.fraction=previousFraction}fractionCompress=(1-previousFraction)/(slicesFraction+othersFraction);othersFraction=othersFraction*fractionCompress;if(offset>0||othersFraction>othersSettings.maxOthersFraction){othersFraction=Math.min(othersFraction,othersSettings.navigationFraction)}if(othersSlice){othersSlice.fraction=othersFraction}fractionCompress=(1-previousFraction-othersFraction)/slicesFraction;for(_l=0,_len=slices.length;_l<_len;_l++){slice=slices[_l];slice.fraction=slice.data.fraction*fractionCompress}return[slices,othersSlice,previousSlice]};Piechart_PieBuilder.prototype.applyNewSlices=function(pie,newSlices,others,previous){var allSlices,i1,i2,oldSlices,s1,s2,slice,slices,wasEmpty,_i,_len,_ref;oldSlices=pie.slices;wasEmpty=oldSlices.length===0;slices=[];allSlices=[];i1=0;i2=0;while(i1<oldSlices.length||i2<newSlices.length){s1=oldSlices[i1];s2=newSlices[i2];if((s1!=null)&&(s2!=null)&&s1.id===s2.id){s1.removed=false;s1.fraction=s2.fraction;s1.data=s2.data;if(s2.currentFraction){s1.currentFraction=s2.currentFraction;s1.animatorF=null}slices.push(s1);allSlices.push(s1);i1++;i2++}else{if(!s2||(s1&&s1.index<s2.index)){s1.removed=true;s1.fraction=0;allSlices.push(s1);slices.push(s1);i1++}else{if(!s2.currentFraction&&!wasEmpty){s2.currentFraction=0}slices.push(s2);allSlices.push(s2);i2++}}}pie.total=pie.data?pie.data.total:0;pie.count=newSlices.length;pie.slices=slices;pie.allSlices=allSlices;if(others){if(!pie.othersSlice){if(!wasEmpty){others.currentFraction=0}pie.othersSlice=others}else{pie.othersSlice.removed=others.removed;pie.othersSlice.data=others.data;pie.othersSlice.fraction=others.fraction;pie.othersSlice.value=others.value;if(others.currentFraction!=null){pie.othersSlice.currentFraction=others.currentFraction;pie.othersSlice.animatorF=null}}pie.allSlices.push(pie.othersSlice)}else{if(pie.othersSlice){pie.allSlices.push(pie.othersSlice);pie.othersSlice.removed=true;pie.othersSlice.fraction=0}}if(previous){if(!pie.previousSlice){if(!wasEmpty){previous.currentFraction=0}pie.previousSlice=previous}else{pie.previousSlice.removed=previous.removed;pie.previousSlice.data=previous.data;pie.previousSlice.fraction=previous.fraction;pie.previousSlice.value=previous.value;if(previous.currentFraction!=null){pie.previousSlice.currentFraction=previous.currentFraction;pie.previousSlice.animatorF=null}}pie.allSlices.unshift(pie.previousSlice)}else{if(pie.previousSlice){pie.previousSlice.removed=true;pie.previousSlice.fraction=0;pie.allSlices.unshift(pie.previousSlice)}}_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];slice.value=slice.data.value}return this.scene.updateOnPieChanged(pie)};Piechart_PieBuilder.prototype.getPieData=function(pie){var data,sum,v,_i,_j,_len,_len1,_ref,_ref1;data=this.scene.data.getPieData(pie.id,pie.offset);if(!data){return null}sum=data.total;if(sum>0){_ref=data.values;for(_i=0,_len=_ref.length;_i<_len;_i++){v=_ref[_i];v.fraction=v.value/sum}}else{sum=data.values.length;_ref1=data.values;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){v=_ref1[_j];v.fraction=1/sum}}if(data.afterSum>0){data.afterFraction=data.afterSum/sum}else{data.afterFraction=0}if(data.beforeSum>0){data.beforeFraction=data.beforeSum/sum}else{data.beforeFraction=0}return data};return Piechart_PieBuilder})();var Piechart_ColumnLabelLayout,Piechart_ColumnLayout,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_ColumnLayout=(function(){function Piechart_ColumnLayout(chart,view){this.chart=chart;this.view=view;this.scene=chart.scene;this.events=chart.events}Piechart_ColumnLayout.prototype.placeColumns=function(pie){var activeSlice,i,index,maxSlicesInScreen,pieChanges,pieIndex,pies,sliceWidth,slices,slicesInScreen,w,_i,_j,_len,_ref,_ref1,_ref2;pieChanges=false;pie.startAngle=0;pie.endAngle=1;slices=pie.count;w=this.scene.width;if(slices>0){sliceWidth=Math.min(this.scene.settings.columns.maxColumnWidth,Math.max(this.scene.settings.columns.minColumnWidth,w/slices))}else{sliceWidth=this.scene.settings.columns.maxColumnWidth}maxSlicesInScreen=Math.round(this.scene.width/sliceWidth);slicesInScreen=Math.max(1,Math.min(maxSlicesInScreen,pie.allSlices.length));if(slicesInScreen!==pie.columnsInScreen){pie.columnsInScreen=slicesInScreen;pieChanges=true}pies=this.scene.stack;pieIndex=pies.length-1;if(pieIndex>0){for(i=_i=0,_ref=pieIndex-1;_i<=_ref;i=_i+=1){pie=pies[i];activeSlice=pie.getActiveSlice();if(activeSlice){index=pie.allSlices.indexOf(activeSlice);pie.startAngle=-index;pie.endAngle=pie.columnsInScreen-index;pie.scrollOffset=0}else{pie.startAngle=-1;pie.endAngle=0;pie.scrollOffset=0}}}_ref1=this.scene.pies;for(_j=0,_len=_ref1.length;_j<_len;_j++){pie=_ref1[_j];if(pie.removed&&pie.parentSlice){_ref2=this.scene.getSliceTargetAngles(pie.parentSlice),pie.startAngle=_ref2[0],pie.endAngle=_ref2[1]}}return pieChanges};Piechart_ColumnLayout.prototype.placeLabels=function(pie,valueAxis,g){var bottom,config,fsum,iconMinSize,index,insideLablelProp,label,labelLayout,left,margin,right,slice,text,top,x,y,_i,_len,_ref,_results;config=this.scene.settings.labels;if(!config.enabled){return}iconMinSize=this.scene.settings.advanced.iconMinSize;margin=this.scene.settings.slice.margin;x=pie.x;y=pie.y;fsum=0;fsum=0;left=this.scene.x0-x;right=left+this.scene.width;top=this.scene.y0-y;bottom=top+this.scene.height;labelLayout=new Piechart_ColumnLabelLayout(g,this.view.getColumnTransform(pie),valueAxis,left,right,top,bottom,bottom+this.scene.settings.columns.labelsHeight,config);_ref=pie.allSlices;_results=[];for(index=_i=0,_len=_ref.length;_i<_len;index=++_i){slice=_ref[index];if(!slice.removed&&!pie.background){if(slice.insideLabel){text=slice.insideLabel;if(!slice.currentInsideLabel){label=slice.currentInsideLabel=new Piechart_Label()}else{label=slice.currentInsideLabel}if(slice.currentInsideLabel.text!==text){label.text=text;label.words=text.split(" ");label.align="center"}if(!label.userPlaced){insideLablelProp=labelLayout.placeInsideLabel(label,slice.value,index);if(config.insideLabel==="auto"&&insideLablelProp<1&&slice!==this.scene.activeSlice){label.visible=false}}}if(slice.label){text=slice.label;if(slice.insideLabel&&!slice.currentInsideLabel.visible){text+=", "+slice.insideLabel}label=null;if(!slice.currentLabel){label=slice.currentLabel=new Piechart_Label()}else{label=slice.currentLabel}if(slice.currentLabel.text!==text){label.text=text;label.align="left";label.words=text.split(" ")}if(!label.userPlaced){_results.push(labelLayout.placeOutsideLabel(label,slice.value,index))}else{_results.push(void 0)}}else{_results.push(slice.currentLabel=null)}}else{slice.currentLabel=null;_results.push(slice.currentInsideLabel=null)}}return _results};return Piechart_ColumnLayout})();Piechart_ColumnLabelLayout=(function(_super){__extends(Piechart_ColumnLabelLayout,_super);function Piechart_ColumnLabelLayout(g,transform,valueAxis,left,right,top,bottom,bottomLabels,config){this.valueAxis=valueAxis;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.bottomLabels=bottomLabels;Piechart_ColumnLabelLayout.__super__.constructor.call(this,g,config);this.trAdd=transform[0],this.trMul=transform[1]}Piechart_ColumnLabelLayout.prototype.placeInsideLabel=function(label,value,index){var p1,x0,x1,y0,y1;x0=0;x1=this.trMul;y0=this.valueAxis.zeroY-this.bottom;y1=y0-this.valueAxis.valueToRelativeY(value);p1=this.placeLabel(label,x0,Math.max(this.top-this.bottom,Math.min(y0,y1)),x1,Math.min(0,Math.max(y0,y1)),"top");if(p1>=1){return p1}return this.placeLabel(label,x0,this.top-this.bottom,x1,Math.max(this.top-this.bottom,Math.min(y0,y1)),"bottom")};Piechart_ColumnLabelLayout.prototype.placeLabel=function(label,left,top,right,bottom,valign){var locationFromHeight;locationFromHeight=function(halfHeight){var centerX,centerY,width;centerX=(left+right)/2;if(valign==="top"){centerY=top+halfHeight}else{if(valign==="bottom"){centerY=bottom-halfHeight}else{centerY=(bottom+top)/2}}if(halfHeight*2<=bottom-top){width=right-left}else{width=0}return[centerX,centerY,1,0,width]};return this.fitLabelInRect(label,"center",locationFromHeight)};Piechart_ColumnLabelLayout.prototype.placeOutsideLabel=function(label,value,index){var align,angle,availableHeight,availableWidth,bottom,cosa,left,locationFromHeight,middleX,right,sina,top;left=0;right=this.trMul;top=0;bottom=this.bottomLabels-this.bottom;angle=label.angle=this.angle;if(angle>0){align=label.align="left"}else{if(angle<0){align=label.align="right"}else{align=label.align="center"}}availableWidth=right-left;availableHeight=bottom-top;middleX=(left+right)/2;sina=Math.sin(angle);cosa=Math.cos(angle);locationFromHeight=function(halfHeight){var centerX,centerY,heightR,rotatedHeight,width;rotatedHeight=halfHeight*cosa;if(sina!==0){heightR=availableHeight-2*halfHeight*cosa;width=Math.max(0,heightR/Math.abs(sina))}else{if(halfHeight*2<=availableHeight){width=availableWidth}else{width=0}}if(angle>0){centerX=middleX+width/2*cosa;centerY=top+halfHeight*cosa+width/2*sina}else{if(angle<0){centerX=middleX-width/2*cosa;centerY=top+halfHeight*cosa-width/2*sina}else{centerX=middleX;centerY=top+halfHeight}}return[centerX,centerY,cosa,sina,width]};return this.fitLabelInRect(label,align,locationFromHeight)};return Piechart_ColumnLabelLayout})(Piechart_LabelLayoutBase);var Piechart_ColumnRenderer;Piechart_ColumnRenderer=(function(){function Piechart_ColumnRenderer(chart,view){var k,v,_ref;this.chart=chart;this.view=view;this.settings=chart.settings;this.scene=chart.scene;this.valueAxis={};_ref=this.scene.settings.valueAxis;for(k in _ref){v=_ref[k];this.valueAxis[k]=new Linearchart_ValueAxis(this,k,v)}}Piechart_ColumnRenderer.prototype.doAnimations=function(event){var f0,f1,max,min,name,pie,sliceFraction,v,va,x,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_results;if(event.changes.pie||event.changes.settings||event.changes.bounds){va=this.valueAxis["default"];va.series=0;_ref=this.scene.pies;for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];if(pie.background){continue}va.series++;min=Infinity;max=-Infinity;f0=pie.scrollOffset;sliceFraction=1/pie.columnsInScreen;_ref1=pie.slices;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){v=_ref1[_j];f1=f0+sliceFraction;if(f0<1&&f1>0){min=Math.min(min,v.value);max=Math.max(max,v.value)}f0=f1}va.recieveSeriesGeometry(min,max,0)}}_ref2=this.valueAxis;for(name in _ref2){x=_ref2[name];x.process(event)}_ref3=this.valueAxis;_results=[];for(name in _ref3){x=_ref3[name];_results.push(x.afterProcess(event))}return _results};Piechart_ColumnRenderer.prototype.paintScene=function(event){var g,h,name,o,pie,pieindex,w,x,y,_i,_j,_len,_len1,_ref,_ref1,_ref2;g=event.context;x=this.scene.x0;w=this.scene.width;y=this.scene.y0;h=this.scene.height+this.scene.settings.columns.labelsHeight;_ref=this.valueAxis;for(name in _ref){o=_ref[name];o.paint(g,g)}Base_Graphics.pushClip(g,x,y,w,h);_ref1=this.scene.pies;for(pieindex=_i=0,_len=_ref1.length;_i<_len;pieindex=++_i){pie=_ref1[pieindex];this.paintColumns(g,pie)}_ref2=this.scene.pies;for(pieindex=_j=0,_len1=_ref2.length;_j<_len1;pieindex=++_j){pie=_ref2[pieindex];if(!(pie.background||pie.removed)){this.paintLabels(g,pie)}}return Base_Graphics.popClip(g)};Piechart_ColumnRenderer.prototype.paintColumns=function(g,pie){var fc,index,lc,left,margin,right,sleft,slice,sright,trAdd,trMul,va,vy,ya,yb,zeroY,_i,_len,_ref,_ref1,_results;va=this.valueAxis["default"];zeroY=va.zeroY;_ref=this.view.getColumnTransform(pie),trAdd=_ref[0],trMul=_ref[1];margin=this.scene.settings.slice.margin;margin=Math.min(trMul/2-1,Math.max((trMul-this.scene.settings.columns.maxColumnWidth)/2,margin));sleft=this.scene.x0;sright=sleft+this.scene.width;left=trAdd+margin;right=Math.max(left+1,trAdd+trMul-margin);_ref1=pie.allSlices;_results=[];for(index=_i=0,_len=_ref1.length;_i<_len;index=++_i){slice=_ref1[index];if(left<sright&&right>sleft){ya=zeroY-slice.currentCutoutDistance;vy=va.valueToRelativeY(slice.value);if(vy<0){yb=ya-vy}else{yb=ya;ya=yb-vy}g.beginPath();g.moveTo(left,ya);g.lineTo(right,ya);g.lineTo(right,yb);g.lineTo(left,yb);g.closePath();fc=slice.fillColor;lc=slice.lineColor;slice.fillColor=slice.currentFillColor;slice.lineColor=slice.currentLineColor;Base_Graphics.paint(g,slice);slice.fillColor=fc;slice.lineColor=lc}left+=trMul;_results.push(right+=trMul)}return _results};Piechart_ColumnRenderer.prototype.paintLabels=function(g,pie){var index,slice,trAdd,trMul,x,y,_i,_len,_ref,_ref1,_results;y=this.scene.y0+this.scene.height;_ref=this.view.getColumnTransform(pie),trAdd=_ref[0],trMul=_ref[1];_ref1=pie.allSlices;_results=[];for(index=_i=0,_len=_ref1.length;_i<_len;index=++_i){slice=_ref1[index];x=trAdd+index*trMul;if(slice.currentInsideLabel&&slice.currentInsideLabel.visible){this.paintLabel(g,x,y,slice.currentInsideLabel,this.settings.labels.insideTextStyle)}if(slice.currentLabel&&slice.currentLabel.visible){_results.push(this.paintLabel(g,x,y,slice.currentLabel,this.settings.labels.textStyle))}else{_results.push(void 0)}}return _results};Piechart_ColumnRenderer.prototype.paintLabel=function(g,x,y,label,style){var line,x0,y0,_i,_len,_ref;g.save();g.translate(x+label.x,y+label.y);g.rotate(label.angle);x0=0;y0=-label.hheight;g.textBaseline="top";if(label.align==="left"){x0-=label.hwidth;g.textAlign="start"}else{if(label.align==="right"){x0+=label.hwidth;g.textAlign="end"}else{g.textAlign="center"}}Base_Graphics.textStyle(g,style);_ref=label.lines;for(_i=0,_len=_ref.length;_i<_len;_i++){line=_ref[_i];g.fillText(line,x0,y0);y0+=label.lineHeight}return g.restore()};return Piechart_ColumnRenderer})();var Piechart_ColumnBuilder;Piechart_ColumnBuilder=(function(){function Piechart_ColumnBuilder(chart){this.chart=chart;this.scene=chart.scene;this.loading=false}Piechart_ColumnBuilder.prototype.updatePie=function(pie){var data,newSlices,numberOfSlices,others,previous,_ref;data=this.getPieData(pie);numberOfSlices=this.getForwardCount(data,pie.offset);if(this.loading){this.scene.data.requestMorePieData(pie.id,pie.offset)}pie.data=data;_ref=this.buildSlices(pie,pie.offset,numberOfSlices),newSlices=_ref[0],others=_ref[1],previous=_ref[2];if(newSlices.length>0||!this.loading){this.applyNewSlices(pie,newSlices,others,previous)}return this.loading};Piechart_ColumnBuilder.prototype.scrollForward=function(pie,newOffset){var data,newOthers,newPrevious,newSlices,numberOfSlices,_ref;data=this.getPieData(pie);if(newOffset==null){numberOfSlices=this.getForwardCount(data,pie.offset);newOffset=pie.offset+numberOfSlices}numberOfSlices=this.getForwardCount(data,newOffset);if(this.loading){this.scene.data.requestMorePieData(pie.id,pie.offset)}pie.data=data;pie.offset=newOffset;_ref=this.buildSlices(pie,newOffset,numberOfSlices),newSlices=_ref[0],newOthers=_ref[1],newPrevious=_ref[2];this.applyNewSlices(pie,newSlices,newOthers,newPrevious);return this.loading};Piechart_ColumnBuilder.prototype.scrollBackward=function(pie,newOffset){var data,newOthers,newPrevious,newSlices,numberOfSlices,_ref;data=this.getPieData(pie);if(newOffset==null){newOffset=this.getBackOffset(data,pie.offset)}numberOfSlices=pie.count+newOffset-pie.offset;if(!data||(!data.done&&pie.offset+numberOfSlices>data.values.length)){this.scene.data.requestMorePieData(pie.id,pie.offset);this.loading=true}else{this.loading=false}pie.data=data;pie.offset=newOffset;_ref=this.buildSlices(pie,newOffset,numberOfSlices),newSlices=_ref[0],newOthers=_ref[1],newPrevious=_ref[2];this.applyNewSlices(pie,newSlices,newOthers,newPrevious);return this.loading};Piechart_ColumnBuilder.prototype.getForwardCount=function(data,offset){var count,slicesToDisplay;if(!data||(data.values.length<=offset&&(!data.done))){this.loading=true;return 0}slicesToDisplay=Math.ceil(this.scene.width/this.scene.settings.columns.minColumnWidth);count=Math.max(0,Math.min(slicesToDisplay,data.values.length-offset));this.loading=!data.done&&offset+slicesToDisplay>data.values.length;return count};Piechart_ColumnBuilder.prototype.getBackOffset=function(data,othersOffset){var offset,slicesToDisplay;if(!data){this.loading=true;return 0}slicesToDisplay=Math.ceil(this.scene.width/this.scene.settings.columns.minColumnWidth);offset=Math.max(0,othersOffset-slicesToDisplay);if(offset===1){offset=0}return offset};Piechart_ColumnBuilder.prototype.buildSlices=function(pie,offset,count){var data,fractionCompress,i,othersFraction,othersSettings,othersSlice,othersVal,prevValue,previousFraction,previousSlice,s,slice,slices,slicesFraction,_i,_j,_k,_l,_len,_ref,_ref1,_ref2,_ref3;data=pie.data;if(!data||(data.values.length<offset&&!data.ready)){this.loading=true;return[[],null,null]}slicesFraction=0;slices=[];for(i=_i=offset,_ref=Math.min(offset+count,data.values.length)-1;_i<=_ref;i=_i+=1){s=new Piechart_Slice(pie,i);s.data=data.values[i];s.id=s.data.id;slicesFraction+=s.data.fraction;slices.push(s)}othersSettings=this.scene.settings.interaction.others;othersFraction=data.afterFraction;othersVal=data.afterSum;for(i=_j=_ref1=offset+count,_ref2=data.values.length-1;_j<=_ref2;i=_j+=1){othersVal+=data.values[i].value;othersFraction+=data.values[i].fraction}if(othersFraction>0){othersSlice=new Piechart_Slice(pie,Infinity);othersSlice.data={value:othersVal,fraction:othersFraction,name:this.scene.settings.localization.othersLabel}}else{othersSlice=null}previousSlice=null;previousFraction=0;if(offset>0){prevValue=0;for(i=_k=0,_ref3=Math.min(offset,data.values.length)-1;_k<=_ref3;i=_k+=1){prevValue+=Math.abs(data.values[i].value)}previousSlice=new Piechart_Slice(pie,-1);previousFraction=othersSettings.navigationFraction;previousSlice.data={value:prevValue,name:this.scene.settings.localization.previousLabel};previousSlice.fraction=previousFraction}fractionCompress=(1-previousFraction)/(slicesFraction+othersFraction);othersFraction=othersFraction*fractionCompress;if(offset>0){othersFraction=Math.min(othersFraction,othersSettings.navigationFraction)}if(othersSlice){othersSlice.fraction=othersFraction}fractionCompress=(1-previousFraction-othersFraction)/slicesFraction;for(_l=0,_len=slices.length;_l<_len;_l++){slice=slices[_l];slice.fraction=1}return[slices,othersSlice,previousSlice]};Piechart_ColumnBuilder.prototype.applyNewSlices=function(pie,newSlices,others,previous){var allSlices,i1,i2,oldSlices,s1,s2,slice,slices,wasEmpty,_i,_len,_ref;oldSlices=pie.slices;wasEmpty=oldSlices.length===0;slices=[];allSlices=[];i1=0;i2=0;while(i1<oldSlices.length||i2<newSlices.length){s1=oldSlices[i1];s2=newSlices[i2];if((s1!=null)&&(s2!=null)&&s1.id===s2.id){s1.removed=false;s1.fraction=s2.fraction;s1.data=s2.data;if(s2.currentFraction){s1.currentFraction=s2.currentFraction;s1.animatorF=null}slices.push(s1);allSlices.push(s1);i1++;i2++}else{if(!s2||(s1&&s1.index<s2.index)){s1.removed=true;s1.fraction=0;allSlices.push(s1);slices.push(s1);i1++}else{if(!s2.currentFraction&&!wasEmpty){s2.currentFraction=0}slices.push(s2);allSlices.push(s2);i2++}}}pie.total=pie.data?pie.data.total:0;pie.count=newSlices.length;pie.slices=slices;pie.allSlices=allSlices;if(others){if(!pie.othersSlice){if(!wasEmpty){others.currentFraction=0}pie.othersSlice=others}else{pie.othersSlice.removed=others.removed;pie.othersSlice.data=others.data;pie.othersSlice.fraction=others.fraction;pie.othersSlice.value=others.value;if(others.currentFraction!=null){pie.othersSlice.currentFraction=others.currentFraction;pie.othersSlice.animatorF=null}}}else{if(pie.othersSlice){pie.othersSlice.removed=true;pie.othersSlice.fraction=0}}if(previous){if(!pie.previousSlice){if(!wasEmpty){previous.currentFraction=0}pie.previousSlice=previous}else{pie.previousSlice.removed=previous.removed;pie.previousSlice.data=previous.data;pie.previousSlice.fraction=previous.fraction;pie.previousSlice.value=previous.value;if(previous.currentFraction!=null){pie.previousSlice.currentFraction=previous.currentFraction;pie.previousSlice.animatorF=null}}}else{if(pie.previousSlice){pie.previousSlice.removed=true;pie.previousSlice.fraction=0}}_ref=pie.allSlices;for(_i=0,_len=_ref.length;_i<_len;_i++){slice=_ref[_i];slice.value=slice.data.value}return this.scene.updateOnPieChanged(pie)};Piechart_ColumnBuilder.prototype.getPieData=function(pie){var data;data=this.scene.data.getPieData(pie.id,pie.offset);if(!data){return null}return data};return Piechart_ColumnBuilder})();var Piechart_Settings,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_Settings=(function(_super){__extends(Piechart_Settings,_super);Piechart_Settings.FlatTheme={advanced:{themeCSSClass:"DVSL-flat",assets:[]},pie:{theme:"flat"}};Piechart_Settings.BevelTheme={advanced:{themeCSSClass:"DVSL-flat",assets:[]},pie:{theme:"bevel"}};Piechart_Settings.GradientTheme={advanced:{themeCSSClass:"DVSL-flat",assets:[]},pie:{theme:"smoothy"}};Piechart_Settings.CanTheme={advanced:{themeCSSClass:"DVSL-flat",assets:[]},pie:{theme:"can",depth:8}};Piechart_Settings.defaults={theme:Piechart_Settings.FlatTheme,data:{format:"JSON",preloaded:null,dataFunction:null,url:null,itemsToLoad:50,requestTimeout:40000,numberOfParralelRequests:3,sortSlices:false},area:{type:"pie",initialPieId:"",initialPieOffset:0,initialSelectionIds:[],initialAnimation:true},columns:{minColumnWidth:50,maxColumnWidth:200,margin:2,labelsHeight:80,series:[],stacks:[]},pie:{radius:null,margin:2,outerMargin:1,innerMargin:5,showInnerPies:true,showInnerPiesExport:true,innerRadius:0.3,x:null,y:null,startAngle:-Math.PI/2,endAngle:Math.PI*1.5,theme:"flat",depth:0,style:{fillColor:"transparent",location:"center",sliceColors:["#2fc32f","#b0dc0b","#eab404","#de672c","#ec2e2e","#d5429b","#6f52b8","#1c7cd5","#56b9f7","#0ae8eb"],colorDistribution:"list",brightness:1},noDataStyle:{fillColor:"#ddd"},backgroundStyle:{},backgroundHoveredStyle:{brightness:0.7},styleFunction:null},slice:{margin:2,style:{lineBrightness:0,brightness:1,cutoutDistance:0,lineColor:null,lineWidth:1,label:null,insideLabel:null,expandable:true,url:null,icon:null},hoverStyle:{brightness:1.2,lineBrightness:2,lineWidth:0.7},selectedStyle:{cutoutDistance:15},backgroundStyle:{fillColor:"#e2e2e2",fillColor2:"#e0e0e0"},backgroundActiveStyle:{brightness:1.3},othersStyle:{fillColor:"#ccc",lineDecoration:"zigzag"},previousStyle:{fillColor:"#ccc",lineDecoration:"zigzag"},styleFunction:null},filters:{sliceFilter:null},labels:{enabled:true,connectors:true,connectorLength:20,angle:0,insideLabel:"append",insideLabelVisibilityFraction:0.8,lineSpacing:0.4,interLabelSpacing:0.6,connectorStyle:{lineColor:"#333",lineWidth:1},textStyle:{fillColor:"#000",font:"12px Arial"},insideTextStyle:{fillColor:"#fff",font:"12px Arial"},margin:4},advanced:{renderQuality:1,backImage:"builtin-back",assets:["timechart.css","piechart.css","jspdf/jspdf.min.js","jspdf/jspdf.plugin.addimage.min.js"],iconMinSize:16,animationTime:500,interactionTime:200,labelInsideTreshold:1,pointer:{noClickOnDoubleClick:false},builtinAssets:{"builtin-back":Piechart_images_back}},events:{onClick:null,onDoubleClick:null,onSelectionChange:null,onHoverChange:null,onPieChange:null,onPieReadyStateChanged:null},interaction:{selection:{enabled:true,tolerance:2},others:{enabled:true,navigationFraction:0.15,maxSlicesVisible:15,maxOthersFraction:0.6,minSliceFraction:0.01},scrolling:{enabled:false},dragging:{enabled:false},drilldown:{enabled:true}},info:{enabled:true,contentsFunction:null},localization:{othersLabel:"Others",previousLabel:"Previous",loadingLabel:"Loading...",closeButton:"Close"}};function Piechart_Settings(settings){Piechart_Settings.__super__.constructor.call(this,"piechart");this.apply(Piechart_Settings.defaults);this.apply(settings)}Piechart_Settings.prototype.apply=function(settings){var changes;changes=Piechart_Settings.__super__.apply.call(this,settings);return changes};return Piechart_Settings})(Linearchart_Settings);var Base_Impl,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty;Base_Impl=(function(){Base_Impl.prototype.container=null;Base_Impl.prototype.settings=null;Base_Impl.prototype.scene=null;Base_Impl.prototype.layers=null;Base_Impl.prototype.removed=false;Base_Impl.prototype.previusSizeW=0;Base_Impl.prototype.previusSizeH=0;Base_Impl.prototype.onAssetsLoaded=function(){return Base_Helpers.error("Need to override onAssetsLoaded")};Base_Impl.prototype.onRemove=function(){return Base_Helpers.error("Need to override onRemove")};Base_Impl.prototype.onSizeChanged=function(width,height){return Base_Helpers.error("Need to override onSizeChanged")};Base_Impl.prototype.onSettingsChanged=function(changes){return Base_Helpers.error("Need to override onSettingsChanged")};function Base_Impl(settings){this.loadAssets=__bind(this.loadAssets,this);this.defaultError=__bind(this.defaultError,this);this._windowResize=__bind(this._windowResize,this);if(!settings.container){throw"Chart container not set"}if(!(settings.container.nodeType>0)){throw"Chart container not a dom object"}}Base_Impl.prototype.initialize=function(api){var browser,sx,sy,_ref;this.api=api;this.eventListeners={};this.eventDelayedCalls={};this.assetsLoaded=true;this.loadedAssets={};this.imgAssets={};if(this.settings.advanced.assets!=null){this.loadAssets(this.settings.advanced.assets)}browser=Base_Helpers.detectBrowser();_ref=Base_Helpers.canvasScaling(),sx=_ref[0],sy=_ref[1];if((this.settings.advanced.highDpi.hasOwnProperty(browser)&&this.settings.advanced.highDpi[browser])||this.settings.advanced.highDpi["default"]){this.scene.canvasScaleX=sx;this.scene.canvasScaleY=sy}else{this.scene.canvasScaleX=1;this.scene.canvasScaleY=1}this.container=this.settings.container;if(this.container._DVSL_ChartInstance!==void 0&&this.container._DVSL_ChartInstance!==null){this.container._DVSL_ChartInstance.remove()}this.container._DVSL_ChartInstance=this;this.container.appendChild(this.layers.container);this.events=new Base_ChartEvents(this.layers.mouseTrackLayer,this.layers.canvas,this);if(this.settings.advanced.trackTouches){this.events.addElement(new Base_TouchMarkers(this.scene))}Base_Helpers.listen(window,"resize",this._windowResize);return this.api._impl=this};Base_Impl.prototype.updateSettings=function(newSettings,origin){var changes,old;if(origin==null){origin=null}this.log("Update Settings, "+(JSON.stringify(newSettings)));old=Base_Helpers.clone(this.settings.events);changes=this.settings.apply(newSettings);if(this.removed){return}if(changes.events){this.updateEvents(old,this.settings.events,this.EVENT_NAMES)}if(changes.advanced&&changes.advanced.assets){this.loadAssets(this.settings.advanced.assets)}if(changes.width||changes.height||changes.maxWidth||changes.minWidth||changes.minHeight||changes.maxHeight){this.updateSize(true)}this.onSettingsChanged(changes);this.events.notifySceneChanges({settings:true});if(origin){return this.notifySettingsChanged(changes,origin)}};Base_Impl.prototype.remove=function(){this.removed=true;this.events.remove();this.container.removeChild(this.layers.container);this.onRemove();this.layers=null;this.scene=null;this.events=null;this.container._DVSL_ChartInstance=void 0;return Base_Helpers.unlisten(window,"resize",this._windowResize)};Base_Impl.prototype._windowResize=function(){return this.updateSize(false)};Base_Impl.prototype.updateSize=function(force){var clientHeight,clientWidth;if(force==null){force=false}if(this.removed){return}clientWidth=this.settings.width;clientHeight=this.settings.height;if(!clientWidth){clientWidth=Math.max(this.settings.minWidth,Math.min(this.settings.maxWidth,this.layers.container.clientWidth))}if(!clientHeight){clientHeight=Math.max(this.settings.minHeight,Math.min(this.settings.maxHeight,this.layers.container.clientHeight))}if(clientWidth!==this.previusSizeW||clientHeight!==this.previusSizeH||force){this.log("Update size, "+clientHeight+", "+clientWidth);this.previusSizeH=clientHeight;this.previusSizeW=clientWidth;this.scene.chartHeight=clientHeight;this.scene.chartWidth=clientWidth;return this.onSizeChanged(clientWidth,clientHeight)}};Base_Impl.prototype.on=function(event,handler){if(!this.eventListeners[event]){this.eventListeners[event]=[]}return this.eventListeners[event].push(handler)};Base_Impl.prototype.off=function(event,handler){if(this.eventListeners[event]!=null){return Base_Helpers.removeFromArray(this.eventListeners[event],handler)}};Base_Impl.prototype.updateEvents=function(oldSettings,newSettings,eventMap){var event,prop,_results;_results=[];for(event in eventMap){prop=eventMap[event];if(oldSettings[prop]!=null){this.off(event,oldSettings[prop])}if(newSettings[prop]!=null){_results.push(this.on(event,newSettings[prop]))}else{_results.push(void 0)}}return _results};Base_Impl.prototype.dispatchEventParams=function(name,params,defaultFunc,delay){var event,key,value;if(delay==null){delay=0}if(!(defaultFunc||((this.eventListeners[name]!=null)&&this.eventListeners[name].length>0))){return}event=Base_Helpers.createEvent(name);for(key in params){if(!__hasProp.call(params,key)){continue}value=params[key];event[key]=value}return this.dispatchEvent(name,event,defaultFunc,delay)};Base_Impl.prototype.cancelDelayedEvent=function(name){return this.eventDelayedCalls[name]=null};Base_Impl.prototype.dispatchEvent=function(name,event,defaultFunc,delay){var fn,l,_i,_len,_ref,_this=this;if(delay==null){delay=0}if(!(defaultFunc||((this.eventListeners[name]!=null)&&this.eventListeners[name].length>0))){return}if(delay>0){this.eventDelayedCalls[name]=event;fn=function(){if(_this.eventDelayedCalls[name]===event){return _this.dispatchEvent(name,event,defaultFunc,0)}};setTimeout(fn,delay);return}if(this.eventListeners[name]!=null){_ref=this.eventListeners[name];for(_i=0,_len=_ref.length;_i<_len;_i++){l=_ref[_i];this.log("Call user event handler, "+name);l.call(this.api,event)}}if(!event.defaultPrevented&&(defaultFunc!=null)){this.log("Call default event handler, "+name);defaultFunc.call(this.api,event)}return event};Base_Impl.prototype.notifySettingsChanged=function(changes,origin){return this.dispatchEventParams("settingsChange",this.extendEventParams({changes:changes,origin:origin}),null)};Base_Impl.prototype.error=function(msg,arg){return this.dispatchEventParams("error",{message:msg,arg:arg},this.defaultError)};Base_Impl.prototype.log=function(msg,arg){if(this.settings.advanced.logging){return Base_Helpers.log(msg,arg)}};Base_Impl.prototype.defaultError=function(event){if(this.settings.events.onError){this.settings.events.onError(event)}return Base_Helpers.error(event.message,event.arg?event.arg:null)};Base_Impl.prototype.loadAssets=function(){var asset,assetToLoad,loaded,_i,_len,_ref,_this=this;assetToLoad=null;_ref=this.settings.advanced.assets;for(_i=0,_len=_ref.length;_i<_len;_i++){asset=_ref[_i];if(!this.loadedAssets.hasOwnProperty(asset)){assetToLoad=asset;break}}if(assetToLoad){if(this.assetsLoaded){this.log("Loading assets")}this.assetsLoaded=false;loaded=function(asset){if(_this.removed){return}if(!_this.credits){_this.credits=_this.events.addElement(new Base_Credits(_this.scene))}_this.loadedAssets[asset]=true;return _this.loadAssets()};return this.loadAsset(assetToLoad,loaded)}else{if(!this.assetsLoaded){this.log("Chart assets loaded");this.onAssetsLoaded()}return this.assetsLoaded=true}};Base_Impl.prototype.loadAsset=function(asset,callback){var elem,ext,url,_this=this;url=asset.src;url=this.settings.getAssetUrl(asset);ext=Base_Helpers.getExtension(asset);if(ext==="css"){elem=document.createElement("link");elem.setAttribute("rel","stylesheet");elem.setAttribute("href",url);elem.setAttribute("type","text/css");elem.addEventListener("load",function(){return callback(asset)});elem.addEventListener("error",function(){_this.error("Assets: Failed to load asset",asset);return callback(asset)});document.getElementsByTagName("head")[0].appendChild(elem);return setTimeout(function(){var img;if(!_this.loadedAssets.hasOwnProperty(asset)&&!_this.imgAssets.hasOwnProperty(asset)){_this.imgAssets[asset]=true;img=document.createElement("img");img.onerror=function(){return callback(asset)};return img.src=url}},200)}else{if(ext==="js"){elem=document.createElement("script");elem.setAttribute("src",url);elem.setAttribute("type","text/javascript");elem.addEventListener("load",function(){return callback(asset)});elem.addEventListener("error",function(){this.error("Assets: Failed to load asset",asset);return callback(asset)});return document.getElementsByTagName("head")[0].appendChild(elem)}else{this.error("Assets: Do not know how to load",asset);return callback(asset)}}};return Base_Impl})();var Base_Resizer;Base_Resizer=(function(){Base_Resizer.prototype.chart=null;Base_Resizer.prototype.oh=0;Base_Resizer.prototype.sy=0;Base_Resizer.prototype.barVisible=false;Base_Resizer.prototype.resizing=false;Base_Resizer.prototype.enabled=false;function Base_Resizer(chart){this.chart=chart;this.scene=this.chart.scene;this.layers=this.chart.layers}Base_Resizer.prototype.onSceneChange=function(ev){if(Base_Helpers.hasProp(ev,"changes/settings")){return this.enabled=this.scene.settings.interaction.resizing.enabled}};Base_Resizer.prototype.onPointerOut=function(ev){if(!this.enabled){return}return this.hideUI()};Base_Resizer.prototype.onPointerMove=function(ev){var dy;if(!this.enabled){return}dy=this.scene.chartHeight-ev.y;if(dy<this.scene.settings.interaction.resizing.advanced.resizerHandleVisibilityTolerance){if(!this.barVisible){this.showUI()}if(dy<this.scene.settings.interaction.resizing.advanced.resizerHandleEnableTolerance){ev.consumed=true;return ev.cursor="ns-resize"}}else{if(this.barVisible){return this.hideUI()}}};Base_Resizer.prototype.onPointerDown=function(ev){var dy;if(!this.enabled){return}this.sy=ev.y;dy=this.scene.chartHeight-ev.y;this.resizing=dy<this.scene.settings.interaction.resizing.advanced.resizerHandleEnableTolerance&&ev.y<=this.scene.chartHeight;if(this.resizing){this.oh=this.scene.chartHeight;this.showUI();ev.cursor="ns-resize";return ev.consumed=true}};Base_Resizer.prototype.onDoubleClick=function(ev){var dy,h,s;if(!this.enabled){return}this.sy=ev.y;dy=this.scene.chartHeight-ev.y;if(dy<this.scene.settings.interaction.resizing.advanced.resizerHandleEnableTolerance&&ev.y<=this.scene.chartHeight){ev.consumed=true;if(this.wasMaximized){h=this.originalHeight;this.wasMaximized=false}else{this.originalHeight=this.oh;this.wasMaximized=true;s=Base_Helpers.getScroll();h=this.oh+s[1]+window.innerHeight-ev.pageY-dy-10}this.scene.settings.height=Math.min(this.scene.settings.maxHeight,Math.max(this.scene.settings.minHeight,h));return this.chart.updateSize()}};Base_Resizer.prototype.onPointerDrag=function(ev){if(!this.enabled){return}if(this.resizing){ev.consumed=true;this.wasMaximized=false;this.scene.settings.height=Math.min(this.scene.settings.maxHeight,Math.max(this.scene.settings.minHeight,this.oh+(ev.y-this.sy)));return this.chart.updateSize()}};Base_Resizer.prototype.showUI=function(){if(this.barVisible){return}this.barVisible=true;return Base_Helpers.fadeIn(this.layers.resizerBar)};Base_Resizer.prototype.hideUI=function(){if(!this.barVisible){return}this.barVisible=false;this.resizing=false;return Base_Helpers.fadeOut(this.layers.resizerBar)};return Base_Resizer})();var Base_MessagesOverlay;Base_MessagesOverlay=(function(){Base_MessagesOverlay.prototype.animationPriority=0;Base_MessagesOverlay.prototype.scene=null;Base_MessagesOverlay.prototype.loadingTime=null;function Base_MessagesOverlay(chart){this.chart=chart;this.scene=chart.scene}Base_MessagesOverlay.prototype.doAnimations=function(event){if(this.scene.loading){return event.animating=true}};Base_MessagesOverlay.prototype.paintScene=function(event){var a,arcStyle,g,grad,height,loading,msg,r,scene,w,width,x,y,yy;scene=this.scene;msg=this.scene.getMessage();loading=this.scene.loading;if(!loading){this.loadingTime=null}if(!((msg!=null)||loading)){return}if(this.loadingTime==null){this.loadingTime=event.time}arcStyle=this.scene.settings.advanced.style.loadingArcStyle;g=event.context;if(arcStyle.location==="corner"){x=scene.x0+scene.width;y=scene.y0}else{x=scene.x0+scene.width/2;y=scene.y0+scene.height/2}if(msg!=null){Base_Graphics.textStyle(g,this.scene.settings.advanced.style.messageTextStyle);g.textBaseline="middle";g.textAlign="center";height=g.measureText("M").width*1.5;width=g.measureText(msg).width;if(arcStyle.location==="corner"){x-=width;y+=height*1.5}if(this.scene.loading){y-=height;yy=y+arcStyle.r+height}else{yy=y}g.fillText(msg,x,yy)}if(this.scene.loading){r=arcStyle.r;w=arcStyle.lineWidth;if(!msg&&arcStyle.location==="corner"){x-=(r+w)*1.2;y+=(r+w)*1.2}g.save();g.lineCap="round";g.lineWidth=w;a=(event.time-this.loadingTime)/700*Math.PI;grad=g.createLinearGradient(x+r*Math.cos(a+Math.PI),y+r*Math.sin(a+Math.PI),x+r*Math.cos(a),y+r*Math.sin(a));grad.addColorStop(0,arcStyle.lineColor);grad.addColorStop(1,"transparent");g.strokeStyle=grad;g.beginPath();g.arc(x,y,r,a,a+Math.PI);g.stroke();return g.restore()}};return Base_MessagesOverlay})();var Base_Title;Base_Title=(function(){function Base_Title(chart){this.chart=chart;this.scene=chart.scene;this.lines=[];this.lineSpacing=0}Base_Title.prototype.computeSize=function(g){var availableWidth,h,i,line,line1,line1Width,lineWidth,m,text,title,w,width,words,_i,_ref;title=this.scene.settings.title;this.lines=[];if(!((title.enabled||title.enabledOnExport)&&title.text)){return[0,0]}m=2*title.margin;text=title.text;g.save();Base_Graphics.textStyle(g,title.style);w=g.measureText(text).width;h=g.measureText("M").width;this.lineSpacing=h*1.4;availableWidth=this.scene.chartWidth;if(w+m>availableWidth){width=0;words=text.split(" ");line=words[0];lineWidth=g.measureText(line).width;for(i=_i=1,_ref=words.length-1;_i<=_ref;i=_i+=1){line1=line+" "+words[i];line1Width=g.measureText(line1).width;if(line1Width<=availableWidth){line=line1;lineWidth=line1Width}else{this.lines.push(line);w=Math.max(w,lineWidth);line=words[i];lineWidth=g.measureText(line).width}}this.lines.push(line);w=Math.max(width,lineWidth)}else{this.lines.push(text)}g.restore();w+=m;h=m+(this.lines.length-1)*this.lineSpacing+h;return[w,h]};Base_Title.prototype.paintScene=function(event){var enabled,g,h,left,line,margin,right,title,top,w,x,y,_i,_len,_ref,_ref1,_results;title=this.scene.settings.title;enabled=event["export"]?title.enabledOnExport:title.enabled;if(!(enabled&&title.text)){return}g=event.context;_ref=this.computeSize(g),w=_ref[0],h=_ref[1];left=0;top=0;right=this.scene.chartWidth;margin=title.margin;Base_Graphics.textStyle(g,title.style);y=top+margin;g.textBaseline="top";if(title.align==="left"){g.textAlign="start";x=left+margin}else{if(title.align==="right"){g.textAlign="end";x=right-margin}else{g.textAlign="center";x=(left+right)/2}}_ref1=this.lines;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){line=_ref1[_i];g.fillText(line,x,y);_results.push(y+=this.lineSpacing)}return _results};return Base_Title})();var Piechart_Navigator;Piechart_Navigator=(function(){Piechart_Navigator.prototype.animationPriority=1001;function Piechart_Navigator(chart){this.chart=chart;this.scene=chart.scene;this.events=chart.events}Piechart_Navigator.prototype.setPie=function(id,offset,origin){var changes,loading,pie,pieId;if(!Base_Helpers.isArray(id)){id=[id]}changes=0;while(this.scene.length()>id.length){this.scene.pop();changes++}while(this.scene.length()>0&&this.scene.peek().id!==id[this.scene.length()-1]){this.scene.pop();changes++}while(this.scene.length()<id.length){pieId=id[this.scene.length()];this.drillDown(pieId,null);changes++}pie=this.scene.peek();if(pie.offset!==offset){loading=this.scroll(pie,offset);changes++}else{if(changes&&pie){loading=this.scene.view.updatePie(pie)}}if(changes){this.chart.notifyPieChange(pie,origin);if(!loading){this.chart.notifyPieReady(pie,origin)}return this.events.notifySceneChanges({pie:true})}};Piechart_Navigator.prototype.getPie=function(){var pie,_i,_len,_ref,_results;_ref=this.scene.stack;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];_results.push(pie.id)}return _results};Piechart_Navigator.prototype.getPieOffset=function(){return this.scene.peek().offset};Piechart_Navigator.prototype.goBack=function(origin){if(!(this.scene.length()>1)){return}this.scene.pop();return this.updateAndNotifyCurrent(origin)};Piechart_Navigator.prototype.goToPie=function(pie,origin){var changes;if(!pie){return}changes=0;while(this.scene.peek()!==pie){this.scene.pop();changes++}if(changes){return this.updateAndNotifyCurrent(origin)}};Piechart_Navigator.prototype.drillDown=function(pieId,origin){var pie;pie=new Piechart_Pie();pie.id=pieId;pie.offset=0;this.scene.push(pie);return this.updateAndNotifyCurrent(origin)};Piechart_Navigator.prototype.goOthers=function(pie,origin){var loading;if(!pie.othersStack){pie.othersStack=[]}pie.othersStack.push(pie.offset);loading=this.scene.view.scrollForward(pie,pie.offset+pie.count);this.chart.notifyPieChange(pie,origin);if(!loading){this.chart.notifyPieReady(pie,origin)}return this.events.notifySceneChanges({pie:true})};Piechart_Navigator.prototype.goPrevious=function(pie,origin){var loading;if(!(pie.offset>0)){return}loading=this.scene.view.scrollBackward(pie);this.chart.notifyPieChange(pie,origin);if(!loading){this.chart.notifyPieReady(pie,origin)}return this.events.notifySceneChanges({pie:true})};Piechart_Navigator.prototype.scroll=function(pie,offset){var loading;if(pie.offset>offset){loading=this.scene.view.scrollBackward(pie,offset)}else{if(pie.offset<offset){loading=this.scene.view.scrollForward(pie,offset)}else{loading=false}}return loading};Piechart_Navigator.prototype.updateAndNotifyCurrent=function(origin){var loading,pie;pie=this.scene.peek();loading=this.scene.view.updatePie(pie);this.chart.notifyPieChange(pie,origin);if(!loading){this.chart.notifyPieReady(pie,origin)}return this.events.notifySceneChanges({pie:true})};Piechart_Navigator.prototype.expandSlice=function(slice,origin){var id,pie;pie=slice.pie;if(pie===this.scene.peek()){if(slice===pie.othersSlice){this.chart.setSelection([]);this.goOthers(pie,origin);return true}else{if(slice===pie.previousSlice){this.chart.setSelection([]);this.goPrevious(pie,origin);return true}else{id=slice.id;if(slice.expandable&&this.scene.data.canExapnd(id)){this.chart.setSelection([]);this.drillDown(id,origin);return true}}}}else{this.chart.setSelection([]);this.goBack(origin);return true}return false};Piechart_Navigator.prototype.onSceneChange=function(event){var activePie,activePieReady,ids,loading,pie,_i,_j,_len,_len1,_ref,_ref1;activePieReady=false;activePie=this.scene.peek();if(event.changes.dataArrived){ids=event.changes.dataArrivedIds;_ref=this.scene.pies;for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];if(ids.hasOwnProperty(pie.id)){loading=this.scene.view.updatePie(pie);event.changes.pie=true;activePieReady||(activePieReady=pie===activePie&&!loading)}}}if(event.changes.data){_ref1=this.scene.stack;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){pie=_ref1[_j];if(!pie.data||pie===activePie||event.changes.dataDeep){loading=this.scene.view.updatePie(pie);event.changes.pie=true;if(pie===activePie){activePieReady=!loading}}}}if(activePieReady){return this.chart.notifyPieReady(activePie,"data")}};return Piechart_Navigator})();var Piechart_InfoPopup;Piechart_InfoPopup=(function(){function Piechart_InfoPopup(chart){this.chart=chart;this.scene=chart.scene;this.options=this.scene.settings;this.events=chart.events;this.currentSlice=null;this.x=null;this.y=null;this.popup=new Base_InfoPopup(chart)}Piechart_InfoPopup.prototype.previewPointerMove=function(event){return this.onMove(event.x,event.y)};Piechart_InfoPopup.prototype.doAnimations=function(event){if(this.x!==null&&this.y!==null){return this.onMove(this.x,this.y)}};Piechart_InfoPopup.prototype.previewPointerDown=function(event){this.x=this.y=null;return this.setCurrentObject(0,0,null)};Piechart_InfoPopup.prototype.previewPointerDrag=function(event){this.x=this.y=null;return this.setCurrentObject(0,0,null)};Piechart_InfoPopup.prototype.onPointerOut=function(event){this.x=this.y=null;return this.setCurrentObject(0,0,null)};Piechart_InfoPopup.prototype.onMove=function(x,y){var pie,slice;this.x=x;this.y=y;if(!this.options.info.enabled){return}slice=this.scene.findSliceAt(x,y,this.scene.settings.interaction.selection.tolerance);pie=this.scene.findPieAt(x,y,this.scene.settings.interaction.selection.tolerance);if(pie&&!slice){slice=pie.getActiveSlice()}return this.setCurrentObject(x,y,slice)};Piechart_InfoPopup.prototype.setCurrentObject=function(x,y,obj){var contents;if(!obj){this.currentSlice=null;return this.popup.hide()}else{if(obj!==this.currentSlice){contents=this.buildContents(obj);this.popup.show(x,y,contents)}else{this.popup.updateXY(x,y)}return this.currentSlice=obj}};Piechart_InfoPopup.prototype.buildContents=function(slice){var callback,_this=this;if(this.options.info.contentsFunction){callback=function(contents){if(slice===_this.currentSlice){return _this.popup.updateContents(contents)}};return this.options.info.contentsFunction.call(this.scene.api,slice.data,slice,callback())}else{return slice.label}};return Piechart_InfoPopup})();var Piechart_PieView,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_PieView=(function(_super){__extends(Piechart_PieView,_super);function Piechart_PieView(chart){this.chart=chart;this.scene=this.chart.scene;this.renderer=new Piechart_PieRenderer(chart);this.animator=new Piechart_Animations(chart);this.layout=new Piechart_PieLayout(chart,this);this.builder=new Piechart_PieBuilder(chart)}Piechart_PieView.prototype.updatePie=function(pie){return this.builder.updatePie(pie)};Piechart_PieView.prototype.scrollForward=function(pie,offset){return this.builder.scrollForward(pie,offset)};Piechart_PieView.prototype.scrollBackward=function(pie,offset){return this.builder.scrollBackward(pie,offset)};Piechart_PieView.prototype.onSceneChange=function(event){return this.renderer.onSceneChange(event)};Piechart_PieView.prototype.doAnimations=function(event){var changedPies,pie,pieChanges,_i,_len;if(event.changes.settings||event.changes.pie||event.changes.bounds){pieChanges=false;pie=this.scene.peek();if(pie!=null){pieChanges||(pieChanges=this.layout.placeStack(pie))}}changedPies=this.animator.doAnimations(event);for(_i=0,_len=changedPies.length;_i<_len;_i++){pie=changedPies[_i];this.layout.placeLabels(pie,event.context)}return this.renderer.doAnimations(event)};Piechart_PieView.prototype.paintScene=function(event){return this.renderer.paintScene(event)};Piechart_PieView.prototype.getMovement=function(pie,event){var a0,a1,d0,d1,dd,df,x0,x1,y0,y1;x0=event.x-event.dx-pie.x;y0=event.y-event.dy-pie.y;x1=event.x-pie.x;y1=event.y-pie.y;a0=Math.atan2(y0,x0);a1=Math.atan2(y1,x1);if(a0-a1>Math.PI){a1+=Math.PI*2}if(a1-a0>Math.PI){a0+=Math.PI*2}df=(a1-a0)/(pie.currentEndAngle-pie.currentStartAngle);d0=Math.sqrt(x0*x0+y0*y0);d1=Math.sqrt(x1*x1+y1*y1);dd=d1-d0;return[df,dd]};Piechart_PieView.prototype.findPieAt=function(px,py,tolerance){var distSq,dx,dy,i,pie,r0,r0sq,r1,r1sq,x,xx,y,_i,_ref;for(i=_i=_ref=this.scene.pies.length-1;_i>=0;i=_i+=-1){pie=this.scene.pies[i];x=pie.x;y=pie.y;r0=pie.currentInnerRadius;r1=pie.currentRadius;xx=Math.max(0,r0-tolerance);r0sq=xx*xx;xx=r1+tolerance;r1sq=xx*xx;dx=px-x;dy=py-y;distSq=dx*dx+dy*dy;if(pie.background){if(distSq<=r1sq){return pie}}}return null};Piechart_PieView.prototype.findSliceAt=function(px,py,tolerance){var a1,ad,cosa0,cosa1,dist,distSq,dp1,dp2,dx,dy,i,pie,r0,r0sq,r1,r1sq,selectionDistance,sina0,sina1,slice,x,xx,y,_i,_j,_len,_ref,_ref1;selectionDistance=this.scene.settings.interaction.selection.cutoutDistance;for(i=_i=_ref=this.scene.pies.length-1;_i>=0;i=_i+=-1){pie=this.scene.pies[i];if(pie.background){continue}x=pie.x;y=pie.y;r0=pie.currentInnerRadius;r1=pie.currentRadius;xx=Math.max(0,r0-tolerance);r0sq=xx*xx;xx=r1+tolerance+selectionDistance;r1sq=xx*xx;dx=px-x;dy=py-y;distSq=dx*dx+dy*dy;if(distSq<r0sq||distSq>r1sq){continue}dist=Math.sqrt(distSq);dx/=dist;dy/=dist;a1=pie.currentStartAngle;ad=pie.currentEndAngle-a1;a1+=ad*pie.scrollOffset;cosa1=Math.cos(a1);sina1=Math.sin(a1);_ref1=pie.allSlices;for(_j=0,_len=_ref1.length;_j<_len;_j++){slice=_ref1[_j];cosa0=cosa1;sina0=sina1;a1+=ad*slice.currentFraction;cosa1=Math.cos(a1);sina1=Math.sin(a1);if(dist>=r0+slice.cutoutDistance&&dist<=r1+slice.cutoutDistance){dp1=sina0*dx-cosa0*dy;dp2=sina1*dx-cosa1*dy;if(dp1<0&&dp2>0){return slice}if(Math.abs(ad*slice.currentFraction)>Math.PI){if((dp1<0&&dp2<0)||(dp1>0&&dp2>0)){return slice}}}}}return this.findLabelAt(px,py,tolerance)[0]};Piechart_PieView.prototype.findLabelAt=function(px,py,tolerance){var i,l,pie,slice,x,y,_i,_j,_len,_ref,_ref1;for(i=_i=_ref=this.scene.pies.length-1;_i>=0;i=_i+=-1){pie=this.scene.pies[i];x=px-pie.x;y=py-pie.y;_ref1=pie.allSlices;for(_j=0,_len=_ref1.length;_j<_len;_j++){slice=_ref1[_j];if(slice.currentLabel){l=slice.currentLabel;if(l.visible&&l.x-l.hwidth<=x&&l.x+l.hwidth>=x&&l.y-l.hheight<=y&&l.y+l.hheight>=y){return[slice,l]}}if(slice.currentInsideLabel){l=slice.currentInsideLabel;if(l.visible&&l.x-l.hwidth<=x&&l.x+l.hwidth>=x&&l.y-l.hheight<=y&&l.y+l.hheight>=y){return[slice,l]}}}}return[null,null]};return Piechart_PieView})(Piechart_View);var Piechart_ColumnView;Piechart_ColumnView=(function(){Piechart_ColumnView.prototype.animationPriority=1007;function Piechart_ColumnView(chart){this.chart=chart;this.scene=this.chart.scene;this.renderer=new Piechart_ColumnRenderer(chart,this);this.animator=new Piechart_Animations(chart);this.layout=new Piechart_ColumnLayout(chart,this);this.builder=new Piechart_ColumnBuilder(chart,this)}Piechart_ColumnView.prototype.updatePie=function(pie){return this.builder.updatePie(pie)};Piechart_ColumnView.prototype.scrollForward=function(pie,offset){return this.builder.scrollForward(pie,offset)};Piechart_ColumnView.prototype.scrollBackward=function(pie,offset){return this.builder.scrollBackward(pie,offset)};Piechart_ColumnView.prototype.onSceneChange=function(event){};Piechart_ColumnView.prototype.doAnimations=function(event){var changedPies,pie,pieChanges,_i,_len,_results;if(event.changes.settings||event.changes.pie||event.changes.bounds){pieChanges=false;pie=this.scene.peek();if(pie){pieChanges||(pieChanges=this.layout.placeColumns(pie));if(pieChanges){event.changes.pie=true}}}changedPies=this.animator.doAnimations(event);this.renderer.doAnimations(event);_results=[];for(_i=0,_len=changedPies.length;_i<_len;_i++){pie=changedPies[_i];_results.push(this.layout.placeLabels(pie,this.renderer.valueAxis["default"],event.context))}return _results};Piechart_ColumnView.prototype.paintScene=function(event){return this.renderer.paintScene(event)};Piechart_ColumnView.prototype.getMovement=function(pie,event){var bottom,dfraction,doffset,x0,x1,y0,y1;bottom=this.scene.y0+this.scene.height;x0=event.x-event.dx-this.scene.x0;y0=bottom-(event.y-event.dy);x1=event.x-this.scene.x0;y1=bottom-event.y;dfraction=(x1-x0)/this.scene.width/(pie.currentEndAngle-pie.currentStartAngle);doffset=y1-y0;return[dfraction,doffset]};Piechart_ColumnView.prototype.findSliceAt=function(px,py,tolerance){var index,pie,tradd,trmul,_i,_len,_ref,_ref1;if((px<this.scene.x0)||(px>(this.scene.x0+this.scene.width))||(py<this.scene.y0)||(py>(this.scene.y0+this.scene.height))){return null}_ref=this.scene.pies;for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];if(pie.background){continue}_ref1=this.getColumnTransform(pie),tradd=_ref1[0],trmul=_ref1[1];index=Math.floor((px-tradd)/trmul);if(index>=0&&index<pie.allSlices.length){return pie.allSlices[index]}}return this.findLabelAt(px,py,tolerance)[0]};Piechart_ColumnView.prototype.findPieAt=function(px,py,tolerance){if((px<this.scene.x0)||(px>(this.scene.x0+this.scene.width))||(py<this.scene.y0)||(py>(this.scene.y0+this.scene.height))){return null}return this.scene.peek()};Piechart_ColumnView.prototype.findLabelAt=function(x,y,tolerance){var index,l,pie,slice,tradd,trmul,x0,y0,_i,_j,_len,_len1,_ref,_ref1,_ref2;_ref=this.scene.pies;for(_i=0,_len=_ref.length;_i<_len;_i++){pie=_ref[_i];if(pie.background){continue}_ref1=this.getColumnTransform(pie),tradd=_ref1[0],trmul=_ref1[1];y0=this.scene.y0+this.scene.height;_ref2=pie.allSlices;for(index=_j=0,_len1=_ref2.length;_j<_len1;index=++_j){slice=_ref2[index];x0=tradd+trmul*index;if(slice.currentLabel){l=slice.currentLabel;if(l.visible&&x0+l.x-l.hwidth<=x&&x0+l.x+l.hwidth>=x&&y0+l.y-l.hheight<=y&&y0+l.y+l.hheight>=y){return[slice,l]}}if(slice.currentInsideLabel){l=slice.currentInsideLabel;if(l.visible&&x0+l.x-l.hwidth<=x&&x0+l.x+l.hwidth>=x&&y0+l.y-l.hheight<=y&&y0+l.y+l.hheight>=y){return[slice,l]}}}}return[null,null]};Piechart_ColumnView.prototype.getColumnTransform=function(pie){var add,dangle,mul,x0,x1;dangle=pie.currentEndAngle-pie.currentStartAngle;x0=this.scene.x0+this.scene.width*(pie.currentStartAngle+pie.scrollOffset*dangle);x1=this.scene.x0+this.scene.width*(pie.currentEndAngle+pie.scrollOffset*dangle);add=x0;mul=(x1-x0)/pie.columnsInScreen;return[add,mul]};return Piechart_ColumnView})();var Piechart_Impl,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Piechart_Impl=(function(_super){__extends(Piechart_Impl,_super);"use strict";Piechart_Impl.prototype.api=null;function Piechart_Impl(settings,api){this.defaultDoubleClick=__bind(this.defaultDoubleClick,this);this.defaultClick=__bind(this.defaultClick,this);this.onSizeChanged=__bind(this.onSizeChanged,this);Piechart_Impl.__super__.constructor.call(this,settings);this.settings=new Piechart_Settings(settings);this.scene=new Piechart_Scene();this.scene.settings=this.settings;this.scene.selectionIds=this.settings.area.initialSelectionIds;this.scene.loading=false;this.layers=new Piechart_Layers(this,this.scene);this.initialize(api);this.scene.view=this.getView();this.events.addElement(new Piechart_InfoPopup(this));this.selection=this.events.addElement(new Piechart_Selection(this));this.navigator=this.events.addElement(new Piechart_Scrolling(this));this.navigator=this.events.addElement(new Piechart_Navigator(this));this.events.addElement(new Piechart_Styles(this));this.events.addElement(this.scene.view);this.title=this.events.addElement(new Base_Title(this));this.events.addElement(new Base_Resizer(this));this.events.addElement(new Base_MessagesOverlay(this));this.scene.data=new Piechart_Data(this);this.updateSize();this.events.notifySceneChanges({settings:true,data:true,bounds:true});this.updateEvents({},this.settings.events,this.EVENT_NAMES);this.navigator.setPie(this.settings.area.initialPieId,this.settings.area.initialPieOffset,"init")}Piechart_Impl.prototype.EVENT_NAMES={selectionChange:"onSelectionChange",hoverChange:"onHoverChange",click:"onClick",doubleClick:"onDoubleClick",error:"onError",animationDone:"onAnimationDone",settingsChange:"onSettingsChange",pieChange:"onPieChange",pieReadyStateChanged:"onPieReadyStateChanged"};Piechart_Impl.prototype.onAssetsLoaded=function(){return this.updateSize()};Piechart_Impl.prototype.onRemove=function(){this.layers=null;this.renderer=null;this.scene.data=null;return this.scene=null};Piechart_Impl.prototype.getView=function(){if(this.settings.area.type==="pie"){return new Piechart_PieView(this)}else{if(this.settings.area.type==="columns"){return new Piechart_ColumnView(this)}}};Piechart_Impl.prototype.onSettingsChanged=function(changes){var ch;this.layers.updateSettings(changes);ch={};if(changes.data){this.scene.data.remove();this.scene.data=new Piechart_Data(this);ch.data=true}if(changes.area){if(changes.area.type){this.log("Switching type to "+this.settings.area.type);this.events.removeElement(this.scene.view);this.scene.view=this.getView();this.events.addElement(this.scene.view);ch.data=true;ch.dataDeep=true}if(changes.area.initialPieId||changes.area.initialPieOffset){this.navigator.setPie(this.settings.area.initialPieId,this.settings.area.initialPieOffset)}if(changes.area.initialSelectionIds){this.setSelection(changes.area.initialSelectionIds)}}if(changes.labels||changes.pie||changes.slice||changes.interaction){ch.pie=true}if(changes.title||changes.area){this.onSizeChanged(this.scene.chartWidth,this.scene.chartHeight)}return this.events.notifySceneChanges(ch)};Piechart_Impl.prototype.onSizeChanged=function(clientWidth,clientHeight){var bottomMargin,height,leftMargin,leftPadding,rightMargin,rightPadding,th,topMargin,tw,width,_ref,_ref1;leftMargin=0;rightMargin=0;bottomMargin=0;topMargin=0;if(this.settings.area.type==="columns"){_ref=Linearchart_ValueAxis.computeMargins(this.settings.getValueAxisList()),leftMargin=_ref[0],rightMargin=_ref[1],leftPadding=_ref[2],rightPadding=_ref[3];this.scene.leftValueAxisSize=leftMargin+leftPadding;this.scene.rightValueAxisSize=rightMargin+rightPadding;bottomMargin=this.settings.columns.labelsHeight}_ref1=this.title.computeSize(this.layers.canvas.getContext("2d")),tw=_ref1[0],th=_ref1[1];topMargin=th;height=clientHeight;width=clientWidth;this.scene.x0=leftMargin;this.scene.y0=topMargin;this.scene.width=width-leftMargin-rightMargin;this.scene.height=height-topMargin-bottomMargin;this.layers.updateSize();if(this.events!=null){return this.events.notifySceneChanges({bounds:true})}};Piechart_Impl.prototype.save=function(){var s,selectionIds,_i,_len,_ref;selectionIds=this.scene.selectionIds.splice(0);_ref=this.scene.selection;for(_i=0,_len=_ref.length;_i<_len;_i++){s=_ref[_i];selectionIds.push(s.id)}return JSON.stringify({pie:this.navigator.getPie(),offset:this.navigator.getPieOffset(),selection:selectionIds})};Piechart_Impl.prototype.restore=function(stateStr,animate){var pie;if(!stateStr){return}pie=JSON.parse(stateStr);this.setPie(pie.pie,pie.offset,animate);return this.setSelection(pie.selection)};Piechart_Impl.prototype.reloadData=function(deep){this.log("Reload data");this.scene.data.remove();this.scene.data=new Piechart_Data(this);return this.events.notifySceneChanges({data:true,dataDeep:deep})};Piechart_Impl.prototype.updateFilter=function(deep){this.log("Update filter");return this.events.notifySceneChanges({data:true,dataDeep:deep})};Piechart_Impl.prototype.setSelection=function(selection){var n,realSelection,selectionIds,_i,_len;this.log("Set selection");realSelection=[];selectionIds=[];for(_i=0,_len=selection.length;_i<_len;_i++){n=selection[_i];if(n instanceof Piechart_Slice){realSelection.push(n)}else{if(Base_Helpers.isString(n)){selectionIds.push(n)}else{this.error("SetSelection: Selection contents must be Piechart_Slice object or string, got "+n)}}}return this.selection.setSelection(realSelection,selectionIds,false,"api")};Piechart_Impl.prototype.setPie=function(root,offset,animate){if(animate==null){animate=true}this.log("Set pie");return this.navigator.setPie(root,offset,"api")};Piechart_Impl.prototype.getPie=function(){return this.navigator.getPie()};Piechart_Impl.prototype.expandSlice=function(slice,origin){return this.navigator.expandSlice(slice,origin)};Piechart_Impl.prototype.notifySelectionChanged=function(origin){return this.dispatchEventParams("selectionChange",this.extendEventParams({origin:origin}),null)};Piechart_Impl.prototype.notifyHoverChanged=function(e){return this.dispatchEventParams("hoverChange",this.extendEventParams(e),null)};Piechart_Impl.prototype.notifyDoubleClick=function(e){return this.dispatchEvent("doubleClick",this.extendEventParams(e),this.defaultDoubleClick)};Piechart_Impl.prototype.notifyClick=function(e){return this.dispatchEvent("click",this.extendEventParams(e),this.defaultClick)};Piechart_Impl.prototype.notifyPieChange=function(newPie,origin){return this.dispatchEventParams("pieChange",this.extendEventParams({pie:newPie,origin:origin}),null)};Piechart_Impl.prototype.notifyPieReady=function(pie,origin){return this.dispatchEventParams("pieReadyStateChanged",this.extendEventParams({pie:pie,origin:origin}),null)};Piechart_Impl.prototype.extendEventParams=function(p){return p};Piechart_Impl.prototype.defaultClick=function(event){var p,s;s=event.clickSlice;p=event.clickPie;if(s){if(s.url){Base_Helpers.openUrl(s.url);return event.preventDefault()}else{if(this.navigator.expandSlice(s,"user")){return event.preventDefault()}}}else{if(p){this.navigator.goToPie(p,"user");return event.preventDefault()}}};Piechart_Impl.prototype.defaultDoubleClick=function(event){};return Piechart_Impl})(Base_Impl);var PieChart,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};PieChart=(function(_super){__extends(PieChart,_super);"use strict";PieChart._impl=null;PieChart._scene=null;PieChart.settings=null;PieChart.themes={flat:Piechart_Settings.FlatTheme,bevel:Piechart_Settings.BevelTheme,gradient:Piechart_Settings.GradientTheme,raised:Piechart_Settings.CanTheme};function PieChart(settings){this._impl=new Piechart_Impl(settings,this);this.settings=this._impl.settings;this._scene=this._impl.scene;return this}PieChart.prototype.updateFilter=function(){this._impl.updateFilter();return this};PieChart.prototype.selection=function(selected){if(selected!=null){this._impl.setSelection(selected)}return this._scene.selection};PieChart.prototype.setPie=function(pieId,offset){if(offset==null){offset=0}return this._impl.setPie(pieId,offset,"api")};PieChart.prototype.getPie=function(){return this._impl.getPie()};PieChart.prototype.getPieOffset=function(){return this._impl.navigator.getPieOffset()};PieChart.prototype.expandSlice=function(slice){return this._impl.expandSlice(slice,"api")};PieChart.prototype.closePopup=function(){return this._impl.closePopup()};return PieChart})(Base_Api);this.PieChart=PieChart}).call(this);